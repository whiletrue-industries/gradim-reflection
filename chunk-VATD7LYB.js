import{A as J,C as ee,D as te,E as ne,F as j,H as ie,K as oe,M as se,a as x,b as H,c as E,d as m,e as v,g as _,h as W,i as B,j as K,k as G,l as u,m as z,n as R,o as A,p as Z,q as Q,r as C,s as d,t as h,u as O,v as D,w,x as r,y as f,z as q}from"./chunk-ZQLLVUB7.js";var de=(p,e)=>e.id;function he(p,e){if(p&1&&O(0,"img",6),p&2){let t=r().$implicit;C("src",t.content,K)}}function pe(p,e){if(p&1){let t=D();d(0,"iframe",8),w("load",function(i){m(t);let o=r().$implicit,s=r();return v(s.onIframeLoad(i,o.id))}),h()}if(p&2){let t=r().$implicit;C("src",t.safeUrl||t.content,G)}}function ue(p,e){if(p&1){let t=D();O(0,"div",9),d(1,"div",10),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"scale-nw"))}),h(),d(2,"div",11),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"scale-ne"))}),h(),d(3,"div",12),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"scale-sw"))}),h(),d(4,"div",13),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"scale-se"))}),h(),d(5,"div",14),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"scale-w"))}),h(),d(6,"div",15),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"scale-e"))}),h(),d(7,"div",16),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"scale-n"))}),h(),d(8,"div",17),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"scale-s"))}),h(),d(9,"div",18),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"rotate-nw"))}),h(),d(10,"div",19),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"rotate-ne"))}),h(),d(11,"div",20),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"rotate-sw"))}),h(),d(12,"div",21),w("mousedown",function(i){m(t);let o=r().$implicit,s=r();return v(s.onHandleMouseDown(i,o.id,"rotate-se"))}),h()}if(p&2){let t=r().$implicit,n=r();u(),f("cursor",n.getCursorForHandle(t,"scale-nw")),u(),f("cursor",n.getCursorForHandle(t,"scale-ne")),u(),f("cursor",n.getCursorForHandle(t,"scale-sw")),u(),f("cursor",n.getCursorForHandle(t,"scale-se")),u(),f("cursor",n.getCursorForHandle(t,"scale-w")),u(),f("cursor",n.getCursorForHandle(t,"scale-e")),u(),f("cursor",n.getCursorForHandle(t,"scale-n")),u(),f("cursor",n.getCursorForHandle(t,"scale-s")),u(),f("cursor",n.getRotateCursor(t,"nw")),u(),f("cursor",n.getRotateCursor(t,"ne")),u(),f("cursor",n.getRotateCursor(t,"sw")),u(),f("cursor",n.getRotateCursor(t,"se"))}}function ge(p,e){if(p&1){let t=D();d(0,"div",5),w("click",function(i){let o=m(t).$implicit,s=r();return v(s.onObjectClick(i,o.id))})("mousedown",function(i){let o=m(t).$implicit,s=r();return v(s.onObjectMouseDown(i,o.id))}),R(1,he,1,1,"img",6)(2,pe,1,1,"iframe",7),R(3,ue,13,24),h()}if(p&2){let t=e.$implicit,n=r();q("selected",n.selectedObjectId()===t.id),C("ngStyle",n.getObjectStyle(t)),u(),A(t.type==="image"?1:t.type==="iframe"?2:-1),u(2),A(n.selectedObjectId()===t.id?3:-1)}}var k=class p{platformId=E(B);sanitizer=E(ie);baseSize=200;dataTokenPrefix="data-token-";dataFilePrefix="file-data-";hashUpdateHandle=null;hashThrottleMs=80;lastSerializedHash="";suppressHash=!1;hashDirty=!1;wheelFlushHandle=null;ephemeralTokens=new Map;transparentPixel="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMB/hsrLxkAAAAASUVORK5CYII=";objects=_([]);selectedObjectId=_(null);selectedObject=ee(()=>{let e=this.selectedObjectId();return e?this.objects().find(t=>t.id===e):null});viewportX=_(0);viewportY=_(0);zoom=_(1);isDragging=!1;isTransforming=!1;isPanningCanvas=!1;dragStartX=0;dragStartY=0;transformStartX=0;transformStartY=0;transformHandle=null;originalObject=null;panStartViewportX=0;panStartViewportY=0;rotateStartAngle=0;rotateStartRotation=0;transformHandles=[{type:"scale-nw",cursor:"nw-resize"},{type:"scale-ne",cursor:"ne-resize"},{type:"scale-sw",cursor:"sw-resize"},{type:"scale-se",cursor:"se-resize"},{type:"scale-w",cursor:"w-resize"},{type:"scale-e",cursor:"e-resize"},{type:"scale-n",cursor:"n-resize"},{type:"scale-s",cursor:"s-resize"},{type:"rotate",cursor:"grab"}];constructor(){j(this.platformId)&&(this.setupEventListeners(),this.applyHashState(window.location.hash),window.addEventListener("hashchange",this.onHashChange),window.addEventListener("keydown",e=>this.onKeyDown(e)),W(()=>{this.viewportX(),this.viewportY(),this.zoom(),this.objects(),this.scheduleHashUpdate()}))}onHashChange=()=>{j(this.platformId)&&window.location.hash!==this.lastSerializedHash&&(this.applyHashState(window.location.hash),this.lastSerializedHash=window.location.hash)};setupEventListeners(){window.addEventListener("paste",e=>this.onPaste(e)),window.addEventListener("dragover",e=>e.preventDefault()),window.addEventListener("wheel",e=>this.onWheel(e),{passive:!1})}onDrop(e){e.preventDefault(),e.stopPropagation();let t=e.dataTransfer?.files;if(t&&t.length>0){let n=t[0];if(n.type.startsWith("image/")){let i=new FileReader;i.onload=()=>{let o=e.currentTarget,s=o?o.getBoundingClientRect():{left:0,top:0},c=e.clientX-s.left-this.viewportX(),l=e.clientY-s.top-this.viewportY(),a=i.result,g=this.deriveSourceRef(a,n.name),b=new Image;b.onload=()=>{let y=b.naturalHeight/b.naturalWidth||1;this.addObject({id:this.generateId(),type:"image",x:c/this.zoom(),y:l/this.zoom(),width:this.baseSize,height:this.baseSize*y,rotation:0,content:a,sourceRef:g,originalAspectRatio:y})},b.onerror=()=>{this.addObject({id:this.generateId(),type:"image",x:c/this.zoom(),y:l/this.zoom(),width:this.baseSize,height:this.baseSize,rotation:0,content:a,sourceRef:g,originalAspectRatio:1})},b.src=a},i.readAsDataURL(n)}}}onDragOver(e){e.preventDefault(),e.stopPropagation()}onPaste(e){let t=e.clipboardData?.getData("text");if(t&&this.isValidUrl(t)){let n=this.deriveSourceRef(t);this.addObject({id:this.generateId(),type:"iframe",x:(window.innerWidth/2-this.viewportX())/this.zoom(),y:(window.innerHeight/2-this.viewportY())/this.zoom(),width:600,height:400,rotation:0,content:t,sourceRef:n,originalAspectRatio:400/600,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(t)}),e.preventDefault()}}isValidUrl(e){try{return new URL(e),!0}catch{return!1}}addObject(e){this.objects.update(t=>[...t,e]),this.selectedObjectId.set(e.id),this.scheduleHashUpdate()}onKeyDown(e){if(e.key!=="Backspace")return;let t=e.target;if(t&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable))return;let n=this.selectedObjectId();if(!n)return;e.preventDefault(),this.suppressHash=!0;let i=this.objects().find(o=>o.id===n);i&&this.cleanupObjectStorage(i),this.objects.update(o=>o.filter(s=>s.id!==n)),this.selectedObjectId.set(null),this.scheduleHashUpdate()}onObjectClick(e,t){e.stopPropagation(),this.selectedObjectId.set(t)}onCanvasClick(e){let t=e.target,n=t===e.currentTarget||t.classList.contains("dot-grid")||t.classList.contains("canvas-objects");this.hashDirty&&this.scheduleHashUpdate(),n&&this.selectedObjectId.set(null)}onCanvasMouseDown(e){if(e.target===e.currentTarget||e.target.classList.contains("dot-grid")){this.suppressHash=!0,this.selectedObjectId.set(null),this.isPanningCanvas=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.panStartViewportX=this.viewportX(),this.panStartViewportY=this.viewportY();let t=i=>{if(!this.isPanningCanvas)return;let o=i.clientX-this.dragStartX,s=i.clientY-this.dragStartY;this.viewportX.set(this.panStartViewportX+o),this.viewportY.set(this.panStartViewportY+s)},n=()=>{this.isPanningCanvas=!1,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",n)};window.addEventListener("mousemove",t),window.addEventListener("mouseup",n)}}onObjectMouseMove(e,t){}onObjectMouseLeave(e){}onWheel(e){e.preventDefault(),this.suppressHash=!0;let n=e.deltaY>0?.9:1.1,i=Math.max(.1,Math.min(5,this.zoom()*n)),o=e.clientX,s=e.clientY,c=(o-this.viewportX())/this.zoom(),l=(s-this.viewportY())/this.zoom();this.zoom.set(i),this.viewportX.set(o-c*i),this.viewportY.set(s-l*i),this.wheelFlushHandle&&window.clearTimeout(this.wheelFlushHandle),this.wheelFlushHandle=window.setTimeout(()=>{this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),this.wheelFlushHandle=null},150)}onObjectMouseDown(e,t){e.preventDefault(),e.stopPropagation();let n=this.objects().find(s=>s.id===t);if(!n)return;this.isDragging=!0,this.suppressHash=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.originalObject=x({},n),this.selectedObjectId.set(t);let i=s=>{if(!this.isDragging||!this.originalObject)return;let c=(s.clientX-this.dragStartX)/this.zoom(),l=(s.clientY-this.dragStartY)/this.zoom();this.objects.update(a=>a.map(g=>g.id===t?H(x({},g),{x:this.originalObject.x+c,y:this.originalObject.y+l}):g))},o=()=>{this.isDragging=!1,this.originalObject=null,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",o)};window.addEventListener("mousemove",i),window.addEventListener("mouseup",o)}onHandleMouseDown(e,t,n){e.preventDefault(),e.stopPropagation();let i=this.objects().find(c=>c.id===t);if(!i)return;this.isTransforming=!0,this.suppressHash=!0,this.transformStartX=e.clientX,this.transformStartY=e.clientY,this.transformHandle=n,this.originalObject=x({},i),this.rotateStartRotation=i.rotation,this.rotateStartAngle=this.getPointerAngle(i,e.clientX,e.clientY);let o=c=>{if(!this.isTransforming||!this.originalObject)return;let l=(c.clientX-this.transformStartX)/this.zoom(),a=(c.clientY-this.transformStartY)/this.zoom();this.transformHandle?.startsWith("rotate-")?this.handleRotate(t,c.clientX,c.clientY):this.transformHandle==="rotate"?this.handleRotate(t,c.clientX,c.clientY):this.transformHandle?.startsWith("scale-")&&this.handleScale(t,l,a,this.transformHandle)},s=()=>{this.isTransforming=!1,this.originalObject=null,this.transformHandle=null,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",s)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",s)}handleScale(e,t,n,i){if(!this.originalObject)return;let o=this.originalObject.width,s=this.originalObject.height,c=0,l=0;if(i==="scale-nw"){let a=(-t-n)/2;o=Math.max(50,this.originalObject.width+a),s=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+a),c=this.originalObject.width-o,l=this.originalObject.height-s}else if(i==="scale-ne"){let a=(t-n)/2;o=Math.max(50,this.originalObject.width+a),s=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+a),l=this.originalObject.height-s}else if(i==="scale-sw"){let a=(-t+n)/2;o=Math.max(50,this.originalObject.width+a),s=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+a),c=this.originalObject.width-o}else if(i==="scale-se"){let a=(t+n)/2;o=Math.max(50,this.originalObject.width+a),s=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+a)}else i==="scale-w"?(o=Math.max(50,this.originalObject.width-t),s=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:this.originalObject.height,c=this.originalObject.width-o,this.originalObject.type==="image"&&(l=(this.originalObject.height-s)/2)):i==="scale-e"?(o=Math.max(50,this.originalObject.width+t),s=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:this.originalObject.height,this.originalObject.type==="image"&&(l=(this.originalObject.height-s)/2)):i==="scale-n"?(s=Math.max(50,this.originalObject.height-n),o=this.originalObject.type==="image"?s/this.originalObject.originalAspectRatio:this.originalObject.width,l=this.originalObject.height-s,this.originalObject.type==="image"&&(c=(this.originalObject.width-o)/2)):i==="scale-s"&&(s=Math.max(50,this.originalObject.height+n),o=this.originalObject.type==="image"?s/this.originalObject.originalAspectRatio:this.originalObject.width,this.originalObject.type==="image"&&(c=(this.originalObject.width-o)/2));this.objects.update(a=>a.map(g=>g.id===e?H(x({},g),{width:o,height:s,x:this.originalObject.x+c,y:this.originalObject.y+l}):g))}handleRotate(e,t,n){if(!this.originalObject)return;let i=this.objects().find(a=>a.id===e);if(!i)return;let s=this.getPointerAngle(i,t,n)-this.rotateStartAngle,c=this.rotateStartRotation+s,l=this.snapAngleWithin(c,45,2);this.objects.update(a=>a.map(g=>g.id===e?H(x({},g),{rotation:l}):g))}getPointerAngle(e,t,n){let i=(e.x+e.width/2)*this.zoom()+this.viewportX(),o=(e.y+e.height/2)*this.zoom()+this.viewportY();return Math.atan2(n-o,t-i)*(180/Math.PI)}getObjectStyle(e){return{left:`${e.x}px`,top:`${e.y}px`,width:`${e.width}px`,height:`${e.height}px`,transform:`rotate(${e.rotation}deg)`}}snapAngle(e,t=45){return Math.round(e/t)*t}snapAngleWithin(e,t=45,n=2){let i=Math.round(e/t)*t;return Math.abs(e-i)<=n?i:e}getHandlePosition(e,t){return{"scale-nw":{top:"-5px",left:"-5px"},"scale-ne":{top:"-5px",right:"-5px"},"scale-sw":{bottom:"-5px",left:"-5px"},"scale-se":{bottom:"-5px",right:"-5px"},rotate:{top:"-30px",left:"50%",transform:"translateX(-50%)"}}[t.type]||{}}getCanvasObjectsStyle(){return{transform:`translate(${this.viewportX()}px, ${this.viewportY()}px) scale(${this.zoom()})`,"transform-origin":"0 0"}}onIframeLoad(e,t){let n=e.target;if(n)try{let i=n.contentDocument||n.contentWindow?.document||null;if(!i)return;i.documentElement&&(i.documentElement.style.overflow="hidden"),i.body&&(i.body.style.overflow="hidden");let o=i.createElement("style");o.textContent="::-webkit-scrollbar{display:none} html,body{overflow:hidden!important}",i.head?.appendChild(o)}catch{}}normalizeAngle180(e){let t=e%180;return t<0&&(t+=180),t}getCursorForHandle(e,t){let n=this.normalizeAngle180(e.rotation),i=n>=45&&n<=135,o=n<45||n>135;if(t.startsWith("scale-"))switch(t){case"scale-nw":case"scale-se":return o?"nwse-resize":"nesw-resize";case"scale-ne":case"scale-sw":return o?"nesw-resize":"nwse-resize";case"scale-w":case"scale-e":return i?"ns-resize":"ew-resize";case"scale-n":case"scale-s":return i?"ew-resize":"ns-resize"}return"move"}buildRotateCursorSvg(e){let t=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<g transform="rotate(${e} 12 12)">
<g clip-path="url(#clip0_325_17)">
<g filter="url(#filter0_d_325_17)">
<path d="M11 6C11.9193 6 12.8295 6.18106 13.6788 6.53284C14.5281 6.88463 15.2997 7.40024 15.9497 8.05025C16.5998 8.70026 17.1154 9.47194 17.4672 10.3212C17.8189 11.1705 18 12.0807 18 13V16H22L16 22L10 16H14V13C14 12.606 13.9224 12.2159 13.7716 11.8519C13.6209 11.488 13.3999 11.1573 13.1213 10.8787C12.8427 10.6001 12.512 10.3791 12.1481 10.2284C11.7841 10.0776 11.394 10 11 10H8V14L2 8L8 2V6H11Z" fill="white"/>
<path d="M11 9H7V11.5L3.5 8L7 4.5L7 7H11C11.7879 7 12.5682 7.15519 13.2961 7.45672C14.0241 7.75825 14.6855 8.20021 15.2426 8.75736C15.7998 9.31451 16.2418 9.97594 16.5433 10.7039C16.8448 11.4319 17 12.2121 17 13V17L19.5 17L16 20.5L12.5 17H15V13C15 12.4747 14.8965 11.9546 14.6955 11.4693C14.4945 10.984 14.1999 10.543 13.8284 10.1716C13.457 9.80014 13.016 9.5055 12.5307 9.30448C12.0454 9.10346 11.5253 9 11 9Z" fill="black"/>
</g>
</g>
<defs>
<filter id="filter0_d_325_17" x="0.2" y="1.2" width="23.6" height="23.6" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
<feOffset dy="1"/>
<feGaussianBlur stdDeviation="0.9"/>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.65 0"/>
<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_325_17"/>
<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_325_17" result="shape"/>
</filter>
<clipPath id="clip0_325_17">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>
</g>
</svg>`;return`url("data:image/svg+xml;utf8,${encodeURIComponent(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}") 12 12, auto`}getRotateCursor(e,t){let i={ne:0,nw:270,sw:180,se:90}[t]+e.rotation;return this.buildRotateCursorSvg(i)}scheduleHashUpdate(){if(j(this.platformId)){if(this.suppressHash){this.hashDirty=!0;return}this.hashUpdateHandle&&window.clearTimeout(this.hashUpdateHandle),this.hashUpdateHandle=window.setTimeout(()=>{let e=this.serializeStateToHash(),t=e?`#${e}`:"";t!==this.lastSerializedHash&&(window.location.hash=t,this.lastSerializedHash=t),this.hashDirty=!1,this.hashUpdateHandle=null},this.hashThrottleMs)}}serializeStateToHash(){let e=[];e.push(this.serializeCanvasSegment());for(let t of this.objects())e.push(this.serializeObjectSegment(t));return e.join("#")}serializeCanvasSegment(){let e=this.roundNumber(this.viewportX()),t=this.roundNumber(this.viewportY()),n=this.roundNumber(this.zoom());return`canvas/${e},${t},${n}`}serializeObjectSegment(e){let t=this.roundNumber(e.x),n=this.roundNumber(e.y),i=this.roundNumber(e.width/this.baseSize),o=this.roundNumber(e.rotation),s=e.width===0?1:e.height/e.width,c=[`type:${e.type}`,`ratio:${this.roundNumber(s)}`];return`${encodeURIComponent(e.sourceRef)}/${t},${n},${i},${o}/${c.join(",")}`}applyHashState(e){if(!j(this.platformId)||!e||e.length<=1)return;let t=e.substring(1).split("#").filter(Boolean);if(t.length===0)return;let n=[],i=this.viewportX(),o=this.viewportY(),s=this.zoom();for(let c of t){let[l,a,g]=c.split("/");if(!l||!a)continue;let b=decodeURIComponent(l);if(b==="canvas"){let[P,X,Y]=a.split(",").map(parseFloat);Number.isNaN(P)||(i=P),Number.isNaN(X)||(o=X),Number.isNaN(Y)||(s=Math.max(.1,Math.min(5,Y)));continue}let[y,V,F,$]=a.split(",").map(parseFloat);if([y,V,F,$].some(P=>Number.isNaN(P)))continue;let L=this.parseFlags(g),T=L.get("ratio")??1,I=typeof T=="number"?T:parseFloat(String(T)),N=Number.isNaN(I)?1:I,S=L.get("type")??"image",U=this.baseSize*F,ae=U*N,M=this.resolveContent(b,S);if(!M)if(S==="image")M=this.transparentPixel;else continue;n.push({id:this.generateId(),type:S,x:y,y:V,width:U,height:ae,rotation:$,content:M,sourceRef:b,originalAspectRatio:N,safeUrl:S==="iframe"&&this.isValidUrl(M)?this.sanitizer.bypassSecurityTrustResourceUrl(M):void 0})}this.viewportX.set(i),this.viewportY.set(o),this.zoom.set(s),this.objects.set(n),this.selectedObjectId.set(null),this.lastSerializedHash=e.startsWith("#")?e:`#${e}`}resolveContent(e,t){if(e.startsWith("token:")){let i=e.substring(6);return this.readDataToken(i)??null}let n=this.readFileContent(e);return n||(t==="iframe"?this.isValidUrl(e)?e:null:e.startsWith("http://")||e.startsWith("https://")?e:null)}parseFlags(e){let t=new Map;if(!e)return t;for(let n of e.split(",")){let[i,o]=n.split(":");if(!i||o===void 0)continue;let s=parseFloat(o);t.set(i,Number.isNaN(s)?o:s)}return t}deriveSourceRef(e,t){if(!j(this.platformId))return e;if(e.startsWith("data:")){if(t){let i=this.makeFileKey(t);try{return localStorage.setItem(i,e),t}catch{}}return this.createDataToken(e)}return t??e}roundNumber(e){return Math.round(e*1e3)/1e3}createDataToken(e){let t=`${this.dataTokenPrefix}${Date.now()}-${Math.random().toString(36).slice(2,8)}`;try{localStorage.setItem(t,e)}catch{this.ephemeralTokens.set(t,e)}return`token:${t}`}readDataToken(e){try{let t=localStorage.getItem(e);if(t)return t}catch{}return this.ephemeralTokens.get(e)??null}makeFileKey(e){return`${this.dataFilePrefix}${e}`}readFileContent(e){let t=this.makeFileKey(e);try{return localStorage.getItem(t)}catch{return null}}generateId(){return"obj-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}cleanupObjectStorage(e){if(e.sourceRef&&!e.sourceRef.startsWith("token:")&&!e.sourceRef.startsWith("http")){let t=this.makeFileKey(e.sourceRef);try{localStorage.removeItem(t)}catch{}}else if(e.sourceRef?.startsWith("token:")){let t=e.sourceRef.substring(6);try{localStorage.removeItem(t)}catch{}this.ephemeralTokens.delete(t)}}static \u0275fac=function(t){return new(t||p)};static \u0275cmp=z({type:p,selectors:[["app-canvas"]],decls:8,vars:1,consts:[[1,"canvas-container",3,"click","mousedown","drop","dragover"],[1,"dot-grid"],[1,"canvas-objects",3,"ngStyle"],[1,"canvas-object",3,"selected","ngStyle"],[1,"canvas-instructions"],[1,"canvas-object",3,"click","mousedown","ngStyle"],["alt","Canvas image",1,"object-content",3,"src"],["scrolling","no","sandbox","allow-scripts allow-same-origin allow-forms",1,"object-content",3,"src"],["scrolling","no","sandbox","allow-scripts allow-same-origin allow-forms",1,"object-content",3,"load","src"],[1,"selection-border"],[1,"handle","handle-corner","handle-nw",3,"mousedown"],[1,"handle","handle-corner","handle-ne",3,"mousedown"],[1,"handle","handle-corner","handle-sw",3,"mousedown"],[1,"handle","handle-corner","handle-se",3,"mousedown"],[1,"handle","handle-edge","handle-w",3,"mousedown"],[1,"handle","handle-edge","handle-e",3,"mousedown"],[1,"handle","handle-edge","handle-n",3,"mousedown"],[1,"handle","handle-edge","handle-s",3,"mousedown"],[1,"rotation-indicator","rotation-nw",3,"mousedown"],[1,"rotation-indicator","rotation-ne",3,"mousedown"],[1,"rotation-indicator","rotation-sw",3,"mousedown"],[1,"rotation-indicator","rotation-se",3,"mousedown"]],template:function(t,n){t&1&&(d(0,"div",0),w("click",function(o){return n.onCanvasClick(o)})("mousedown",function(o){return n.onCanvasMouseDown(o)})("drop",function(o){return n.onDrop(o)})("dragover",function(o){return n.onDragOver(o)}),O(1,"div",1),d(2,"div",2),Z(3,ge,4,5,"div",3,de),h(),d(5,"div",4)(6,"p"),J(7,"Drag and drop images here \u2022 Paste URLs (Ctrl/Cmd+V) \u2022 Drag canvas to pan \u2022 Scroll to zoom"),h()()()),t&2&&(u(2),C("ngStyle",n.getCanvasObjectsStyle()),u(),Q(n.objects()))},dependencies:[ne,te],styles:['[_nghost-%COMP%]{display:block;width:100%;height:100%}.canvas-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;overflow:hidden;background-color:#f5f5f5;cursor:grab}.canvas-container[_ngcontent-%COMP%]:active{cursor:grabbing}.dot-grid[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(circle,#ccc 1px,transparent 1px);background-size:20px 20px;background-position:0 0;pointer-events:none;z-index:1}.canvas-objects[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;pointer-events:none}.canvas-object[_ngcontent-%COMP%]{position:absolute;box-sizing:border-box;cursor:move;-webkit-user-select:none;user-select:none;pointer-events:auto}.canvas-object.selected[_ngcontent-%COMP%]   .selection-border[_ngcontent-%COMP%]{display:block}.canvas-object[_ngcontent-%COMP%]   .object-content[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain;pointer-events:none;display:block;border:none}.canvas-object[_ngcontent-%COMP%]   iframe.object-content[_ngcontent-%COMP%]{overflow:hidden;scrollbar-width:none}.canvas-object[_ngcontent-%COMP%]   iframe.object-content[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.canvas-object[_ngcontent-%COMP%]   .selection-border[_ngcontent-%COMP%]{display:none;position:absolute;top:0;left:0;width:100%;height:100%;border:1px solid #007bff;box-sizing:border-box;pointer-events:none}.canvas-object[_ngcontent-%COMP%]:hover   .selection-border[_ngcontent-%COMP%]{border-width:3px}.canvas-object[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{position:absolute;pointer-events:all;z-index:10;-webkit-user-select:none;user-select:none}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner[_ngcontent-%COMP%]{width:8px;height:8px;background-color:#007bff;border:1px solid white;box-sizing:border-box}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-nw[_ngcontent-%COMP%]{top:-4px;left:-4px;cursor:nw-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-ne[_ngcontent-%COMP%]{top:-4px;right:-4px;cursor:ne-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-sw[_ngcontent-%COMP%]{bottom:-4px;left:-4px;cursor:sw-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-se[_ngcontent-%COMP%]{bottom:-4px;right:-4px;cursor:se-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner[_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:scale(1.3)}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge[_ngcontent-%COMP%]{background-color:transparent;border:none}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-w[_ngcontent-%COMP%]{top:0;left:-4px;width:8px;height:100%;cursor:w-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-e[_ngcontent-%COMP%]{top:0;right:-4px;width:8px;height:100%;cursor:e-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-n[_ngcontent-%COMP%]{top:-4px;left:0;width:100%;height:8px;cursor:n-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-s[_ngcontent-%COMP%]{bottom:-4px;left:0;width:100%;height:8px;cursor:s-resize}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]{position:absolute;width:20px;height:20px;pointer-events:all;z-index:10;cursor:grab}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:hover{cursor:grab}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:active{cursor:grabbing}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:before{content:"";position:absolute;width:4px;height:4px;background-color:#28a745;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%)}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-nw[_ngcontent-%COMP%]{top:-30px;left:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-ne[_ngcontent-%COMP%]{top:-30px;right:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-sw[_ngcontent-%COMP%]{bottom:-30px;left:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-se[_ngcontent-%COMP%]{bottom:-30px;right:-30px}.canvas-instructions[_ngcontent-%COMP%]{position:absolute;top:20px;left:50%;transform:translate(-50%);background-color:#ffffffe6;padding:12px 24px;border-radius:8px;box-shadow:0 2px 8px #0000001a;z-index:100;pointer-events:none}.canvas-instructions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#333;font-size:14px;font-weight:500}'],changeDetection:0})};var re=class p{title=_("sample-reflect");static \u0275fac=function(t){return new(t||p)};static \u0275cmp=z({type:p,selectors:[["app-root"]],decls:3,vars:1,consts:[[3,"fullScreen"]],template:function(t,n){t&1&&(d(0,"lib-layout",0),O(1,"app-canvas")(2,"router-outlet"),h()),t&2&&C("fullScreen",!0)},dependencies:[oe,se,k],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"]})};export{re as App};
