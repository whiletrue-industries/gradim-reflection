import{Aa as f,Ba as U,Da as _,Ea as r,J as C,Ja as S,N as l,O as c,P as g,Ta as M,Ua as v,X as d,Xa as P,aa as x,ca as w,da as p,ia as y,pa as u,qa as h,xa as i,ya as s,za as m}from"./chunk-MEFDK25W.js";var k=["https://gradim-wall.netlify.app/FB_P_ITA_200021_5770_013","https://gradim-wall.netlify.app/FB_P_FRA_88009_0072_018","https://gradim-wall.netlify.app/FB_P_IND_84010_016_809","https://gradim-wall.netlify.app/FB_P_USA_82002_0211_036","https://gradim-wall.netlify.app/FB_P_SUN_89009_1275_031"];function V(){let o=Math.floor(Math.random()*k.length);return k[o]}function E(o,e){if(o&1&&m(0,"iframe",1),o&2){let t=r();U("src",t.safeContextUrl(),w)}}function W(o,e){if(o&1){let t=f();i(0,"button",10),_("click",function(){l(t);let a=r(2);return c(a.viewSavedComposition())})("touchstart",function(){l(t);let a=r(2);return c(a.viewSavedComposition())}),g(),i(1,"svg",7),m(2,"path",11),s()()}}function R(o,e){if(o&1){let t=f();i(0,"div",3)(1,"button",6),_("click",function(){l(t);let a=r();return c(a.shareToCanvas())})("touchstart",function(){l(t);let a=r();return c(a.shareToCanvas())}),g(),i(2,"svg",7),m(3,"path",8),s()(),u(4,W,3,0,"button",9),s()}if(o&2){let t=r();p(4),h(t.savedComposition()?4:-1)}}function L(o,e){if(o&1){let t=f();i(0,"button",12),_("click",function(){l(t);let a=r();return c(a.closeCanvas())})("touchstart",function(){l(t);let a=r();return c(a.closeCanvas())}),g(),i(1,"svg",7),m(2,"path",13),s()()}}function I(o,e){if(o&1&&(i(0,"div",14),m(1,"iframe",15),s()),o&2){let t=r();S("slide-in-left",!t.isClosing())("slide-out-left",t.isClosing()),p(),U("src",t.safeCanvasUrl(),w)}}var O=class o{sanitizer=C(P);platformId=C(x);currentUrl=d("");safeContextUrl=d(null);canvasVisible=d(!1);safeCanvasUrl=d(null);isClosing=d(!1);savedComposition=d(null);constructor(){let e=V();this.currentUrl.set(e),this.safeContextUrl.set(this.sanitizer.bypassSecurityTrustResourceUrl(e)),v(this.platformId)&&window.addEventListener("message",this.handleMessage)}ngOnDestroy(){v(this.platformId)&&window.removeEventListener("message",this.handleMessage)}handleMessage=e=>{if(e.data?.type==="closeCanvas"){if(e.data.compositionHash)try{this.savedComposition.set(e.data.compositionHash),sessionStorage.setItem("canvasComposition",e.data.compositionHash)}catch(t){console.error("Failed to store composition state:",t)}this.closeCanvas()}else e.data?.type==="shareImage"&&(console.log("[UrlWrapper] Received shareImage message, handling immediately"),this.handleShareImageImmediately(e.data.blobUrl,e.data.filename))};handleShareImageImmediately(e,t){v(this.platformId)&&(console.log("[UrlWrapper] handleShareImageImmediately called"),console.log("[UrlWrapper] navigator.share available:",!!navigator.share),navigator.share?(console.log("[UrlWrapper] Attempting navigator.share with blob URL"),fetch(e).then(n=>n.blob()).then(n=>{console.log("[UrlWrapper] Blob fetched, sharing");let a=new File([n],t,{type:"image/png"});return navigator.share({files:[a],title:"My Composition"})}).then(()=>{console.log("[UrlWrapper] Share completed"),URL.revokeObjectURL(e)}).catch(n=>{console.error("[UrlWrapper] Share error:",n?.message),URL.revokeObjectURL(e)})):(console.log("[UrlWrapper] navigator.share not available on this platform"),console.log('[UrlWrapper] On iOS Safari, try long-pressing the image in the canvas and selecting "Save Image"'),URL.revokeObjectURL(e)))}shareToCanvas(){console.log("[UrlWrapper] shareToCanvas clicked"),this.isClosing.set(!1);let e=this.currentUrl();if(!e){console.warn("[UrlWrapper] No URL to share");return}let t=this.buildUrlKey();console.log("[UrlWrapper] Generated URL key:",t);try{sessionStorage.setItem(t,e),console.log("[UrlWrapper] Stored URL in sessionStorage")}catch(b){console.error("[UrlWrapper] Failed to store URL in sessionStorage:",b);return}let a=`${window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")+1)}sample-reflect/?loadUrl=${t}`;console.log("[UrlWrapper] Opening canvas with URL:",a),this.safeCanvasUrl.set(this.sanitizer.bypassSecurityTrustResourceUrl(a)),this.canvasVisible.set(!0),console.log("[UrlWrapper] Canvas opened, canvasVisible:",this.canvasVisible())}buildUrlKey(){let e=globalThis.crypto;if(e?.randomUUID)return`pending-canvas-url-${e.randomUUID()}`;if(e?.getRandomValues){let n=new Uint8Array(16);return e.getRandomValues(n),`pending-canvas-url-${Array.from(n,b=>b.toString(16).padStart(2,"0")).join("")}`}return`pending-canvas-url-${Math.random().toString(36).slice(2)+Date.now().toString(36)}`}closeCanvas(){this.canvasVisible()&&(this.isClosing.set(!0),setTimeout(()=>{this.canvasVisible.set(!1),this.safeCanvasUrl.set(null),this.isClosing.set(!1)},240))}viewSavedComposition(){let e=this.savedComposition();if(!e)return;this.isClosing.set(!1);let n=`${window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")+1)}sample-reflect/${e}`;this.safeCanvasUrl.set(this.sanitizer.bypassSecurityTrustResourceUrl(n)),this.canvasVisible.set(!0)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["app-url-wrapper"]],decls:6,vars:3,consts:[[1,"url-wrapper-container"],["title","Context View","allow","publickey-credentials-create *; publickey-credentials-get *","sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-downloads",1,"wrapped-iframe",3,"src"],[1,"share-button-container"],[1,"button-group"],["type","button","title","Close canvas",1,"share-button","close"],[1,"canvas-overlay",3,"slide-in-left","slide-out-left"],["type","button","title","Share to canvas",1,"share-button",3,"click","touchstart"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"],["type","button","title","View saved composition",1,"share-button","saved"],["type","button","title","View saved composition",1,"share-button","saved",3,"click","touchstart"],["d","M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"],["type","button","title","Close canvas",1,"share-button","close",3,"click","touchstart"],["d","M14.7 5.3a1 1 0 0 1 0 1.4L10.41 11H19a1 1 0 1 1 0 2h-8.59l4.29 4.3a1 1 0 0 1-1.42 1.4l-6-6a1 1 0 0 1 0-1.4l6-6a1 1 0 0 1 1.42 0Z"],[1,"canvas-overlay"],["title","Canvas View","allow","publickey-credentials-create *; publickey-credentials-get *","sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-downloads",1,"canvas-iframe",3,"src"]],template:function(t,n){t&1&&(i(0,"div",0),u(1,E,1,1,"iframe",1),i(2,"div",2),u(3,R,5,1,"div",3)(4,L,3,0,"button",4),s(),u(5,I,2,5,"div",5),s()),t&2&&(p(),h(n.safeContextUrl()?1:-1),p(2),h(n.canvasVisible()?4:3),p(2),h(n.canvasVisible()&&n.safeCanvasUrl()?5:-1))},dependencies:[M],styles:[".url-wrapper-container[_ngcontent-%COMP%]{position:fixed;inset:0;width:100%;height:100%;overflow:hidden;background:#000}.wrapped-iframe[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%;border:none;display:block;z-index:1}.share-button-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;z-index:200;pointer-events:auto;display:flex;gap:8px;align-items:center}.button-group[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.share-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:48px;height:48px;padding:0;background-color:#141414f2;color:#e6e6e6;border:1px solid rgba(255,255,255,.1);border-radius:8px;cursor:pointer;box-shadow:0 2px 12px #00000080;transition:all .2s ease;touch-action:manipulation;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}.share-button[_ngcontent-%COMP%]:hover{background-color:#1e1e1efa;border-color:#fff3;transform:translateY(-2px);box-shadow:0 4px 16px #0009}.share-button[_ngcontent-%COMP%]:active{transform:translateY(0);box-shadow:0 2px 8px #0006}.share-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px;flex-shrink:0}.share-button.close[_ngcontent-%COMP%]{background-color:#1e1e1ef2}.share-button.saved[_ngcontent-%COMP%]{background-color:#287850e6;border-color:#64c8964d}.share-button.saved[_ngcontent-%COMP%]:hover{background-color:#328c64fa;border-color:#96ffc866}.canvas-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;width:100%;height:100%;z-index:10;background:#0000000d;overflow:hidden}.canvas-overlay.slide-in-left[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideFromLeft .36s ease-in-out}.canvas-overlay.slide-out-left[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideToLeft .36s ease-in-out}.canvas-iframe[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%;border:none;display:block;box-shadow:0 0 30px #0000004d}@keyframes _ngcontent-%COMP%_slideFromLeft{0%{clip-path:inset(0 100% 0 0)}to{clip-path:inset(0 0 0 0)}}@keyframes _ngcontent-%COMP%_slideToLeft{0%{clip-path:inset(0 0 0 0)}to{clip-path:inset(0 100% 0 0)}}"],changeDetection:0})};export{O as UrlWrapper};
