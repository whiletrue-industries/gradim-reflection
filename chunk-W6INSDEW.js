import{a as Se}from"./chunk-5PKAR4MF.js";import{Aa as j,Ca as _,Ea as c,Fa as we,Ga as xe,Ha as ne,Ia as k,J as U,Ja as A,Ka as I,La as ie,M as Q,Ma as Me,N as u,Na as Oe,O as g,P as S,Pa as F,Q as X,Qa as ye,R as _e,Ra as oe,Ua as re,Va as ae,Wa as O,X as M,Y as Z,Za as Pe,a as P,aa as N,b as D,ba as he,ca as ve,da as b,ea as L,ia as Y,oa as J,pa as V,qa as E,ra as ee,sa as te,ta as C,ua as h,va as p,wa as w,xa as be,ya as Ce}from"./chunk-NJ4HO3WV.js";var Ee=["*"];var je=(()=>{class l{platformId=U(N);fullScreen=oe(!1);isInIframe=M(!1);constructor(){O(this.platformId)&&(this.isInIframe.set(window!==window.parent),this.setupIframeCommunication())}setupIframeCommunication(){this.isInIframe()&&(window.addEventListener("message",t=>{this.handleParentMessage(t)}),this.postMessageToParent({type:"APP_READY",timestamp:Date.now()}))}handleParentMessage(t){let{type:n,data:i}=t.data;switch(n){case"REQUEST_DATA":this.handleDataRequest();break;case"CONFIG_UPDATE":this.handleConfigUpdate(i);break;default:console.warn("Unknown message type from parent:",n)}}handleDataRequest(){this.postMessageToParent({type:"DATA_RESPONSE",data:{title:"",description:"",link:"",imageUrl:"",imageBlob:null,metadata:{itemsUsed:[],tags:[],userId:"",username:"",email:""}}})}handleConfigUpdate(t){console.log("Config update received:",t)}postMessageToParent(t){this.isInIframe()&&O(this.platformId)&&window.parent.postMessage(t,"*")}sendDataToParent(t){this.postMessageToParent({type:"DATA_UPDATE",data:t})}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=Y({type:l,selectors:[["lib-layout"]],hostVars:4,hostBindings:function(n,i){n&2&&A("is-iframe",i.isInIframe())("full-screen",i.fullScreen())},inputs:{fullScreen:[1,"fullScreen"]},ngContentSelectors:Ee,decls:3,vars:0,consts:[[1,"layout-container"],[1,"layout-content"]],template:function(n,i){n&1&&(we(),be(0,"div",0)(1,"div",1),xe(2),Ce()())},styles:["[_nghost-%COMP%]{display:block;width:100%;min-height:100vh}.layout-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;width:100%}.layout-content[_ngcontent-%COMP%]{flex:1;width:100%;max-width:1200px;margin:0 auto;padding:16px}@media(min-width:1024px){.layout-content[_ngcontent-%COMP%]{padding:24px}}.is-iframe[_nghost-%COMP%]   .layout-content[_ngcontent-%COMP%]{max-width:100%;padding:8px}.full-screen[_nghost-%COMP%]   .layout-container[_ngcontent-%COMP%]{overflow:hidden}.full-screen[_nghost-%COMP%]   .layout-content[_ngcontent-%COMP%]{max-width:100%;padding:0;margin:0}"],changeDetection:0})}return l})();var se=[{id:"image",label:"Image",render:l=>l},{id:"gallery",label:"Gallery",render:l=>l},{id:"merge",label:"Merge",render:l=>l},{id:"map",label:"Map",render:l=>l},{id:"draw",label:"Draw",render:l=>l},{id:"shape",label:"Shape",render:l=>l},{id:"crop",label:"Crop",render:l=>l},{id:"target",label:"Target",render:l=>l}];var De=l=>({transform:l}),Le=(l,e)=>e.id;function Ae(l,e){l&1&&w(0,"i",6)}function Re(l,e){l&1&&(S(),h(0,"svg",7),w(1,"path",14)(2,"path",15)(3,"path",16)(4,"path",17),p())}function Ue(l,e){l&1&&w(0,"i",8)}function Xe(l,e){l&1&&w(0,"i",9)}function Ye(l,e){l&1&&w(0,"i",10)}function $e(l,e){l&1&&w(0,"i",11)}function Ne(l,e){l&1&&w(0,"i",12)}function We(l,e){l&1&&w(0,"i",13)}function Be(l,e){if(l&1){let t=j();h(0,"button",4),_("click",function(){let i=u(t).$index,o=c();return g(o.selectApp(i))}),h(1,"span",5),V(2,Ae,1,0,"i",6)(3,Re,5,0,":svg:svg",7)(4,Ue,1,0,"i",8)(5,Xe,1,0,"i",9)(6,Ye,1,0,"i",10)(7,$e,1,0,"i",11)(8,Ne,1,0,"i",12)(9,We,1,0,"i",13),p()()}if(l&2){let t,n=e.$implicit,i=e.$index,o=c();A("active",o.selectedAppIndex()===i),J("aria-label",n.label),b(2),E((t=i)===0?2:t===1?3:t===2?4:t===3?5:t===4?6:t===5?7:t===6?8:t===7?9:-1)}}function Ge(l,e){if(l&1&&(h(0,"div",3),I(1),p()),l&2){let t=c();b(),ie(t.apps[t.selectedAppIndex()].label)}}var ce=class l{platformId=U(N);apps=se;selectedAppIndex=oe(0);appChanged=ye();touchStartX=0;touchCurrentX=0;carouselOffset=M(0);viewportWidth=0;computedOffset=F(()=>{let e=this.selectedAppIndex(),t=84,n=this.viewportWidth/2,i=e*t+t/2;return n-i});constructor(){typeof window<"u"&&(this.viewportWidth=window.innerWidth,window.addEventListener("resize",()=>{this.viewportWidth=window.innerWidth})),this.carouselOffset.set(this.computedOffset()),Z(()=>{this.carouselOffset.set(this.computedOffset())}),O(this.platformId)&&L(()=>{this.replaceFeatherIcons()})}replaceFeatherIcons(){try{let e=window;if(e.feather&&typeof e.feather.replace=="function"){setTimeout(()=>{try{e.feather.replace()}catch{}},0);return}let t="feather-icons-cdn";if(document.getElementById(t))setTimeout(()=>{try{window.feather.replace()}catch{}},200);else{let n=document.createElement("script");n.id=t,n.src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js",n.async=!0,n.onload=()=>{try{window.feather.replace()}catch{}},document.head.appendChild(n)}}catch{}}onTouchStart(e){this.touchStartX=e.touches[0].clientX,this.touchCurrentX=this.touchStartX}onTouchMove(e){this.touchCurrentX=e.touches[0].clientX;let t=this.touchCurrentX-this.touchStartX;this.carouselOffset.set(this.computedOffset()+t)}onTouchEnd(e){let t=this.touchCurrentX-this.touchStartX,n=30,i=this.selectedAppIndex();t>n&&i>0?this.selectApp(i-1):t<-n&&i<this.apps.length-1?this.selectApp(i+1):this.carouselOffset.set(this.computedOffset())}selectApp(e){e>=0&&e<this.apps.length&&this.appChanged.emit(e)}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=Y({type:l,selectors:[["app-canvas-carousel"]],inputs:{selectedAppIndex:[1,"selectedAppIndex"]},outputs:{appChanged:"appChanged"},decls:5,vars:4,consts:[[1,"carousel-container",3,"touchstart","touchmove","touchend"],[1,"carousel-track",3,"ngStyle"],[1,"carousel-button",3,"active"],[1,"app-label"],[1,"carousel-button",3,"click"],[1,"circle"],["data-feather","image","aria-hidden","true"],["width","20","height","20","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["data-feather","git-merge","aria-hidden","true"],["data-feather","map","aria-hidden","true"],["data-feather","pen-tool","aria-hidden","true"],["data-feather","triangle","aria-hidden","true"],["data-feather","scissors","aria-hidden","true"],["data-feather","target","aria-hidden","true"],["d","M20 9H11C9.89543 9 9 9.89543 9 11V20C9 21.1046 9.89543 22 11 22H20C21.1046 22 22 21.1046 22 20V11C22 9.89543 21.1046 9 20 9Z","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M5 15H4C3.46957 15 2.96086 14.7893 2.58579 14.4142C2.21071 14.0391 2 13.5304 2 13V4C2 3.46957 2.21071 2.96086 2.58579 2.58579C2.96086 2.21071 3.46957 2 4 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V5","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M7.2207 8.12109C8.26595 8.12109 9.11328 7.27376 9.11328 6.22852C9.11328 5.18327 8.26595 4.33594 7.2207 4.33594C6.17546 4.33594 5.32812 5.18327 5.32812 6.22852C5.32812 7.27376 6.17546 8.12109 7.2207 8.12109Z","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M9.33211 10.2841L7.32145 8.27344L2.32812 13.2676","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"]],template:function(t,n){t&1&&(h(0,"div",0),_("touchstart",function(o){return n.onTouchStart(o)})("touchmove",function(o){return n.onTouchMove(o)})("touchend",function(o){return n.onTouchEnd(o)}),h(1,"div",1),ee(2,Be,10,4,"button",2,Le),p(),V(4,Ge,2,1,"div",3),p()),t&2&&(b(),C("ngStyle",Oe(2,De,"translateX("+n.carouselOffset()+"px)")),b(),te(n.apps),b(2),E(n.apps[n.selectedAppIndex()]?4:-1))},dependencies:[ae,re],styles:[".carousel-container[_ngcontent-%COMP%]{position:fixed;bottom:50px;left:0;right:0;padding:16px 0;z-index:100;touch-action:pan-x;display:flex;flex-direction:column;align-items:center;gap:8px;overflow:hidden}.carousel-track[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-start;width:100%;transition:transform .3s cubic-bezier(.25,.46,.45,.94)}.carousel-button[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer;width:72px;height:72px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;flex-shrink:0}.circle[_ngcontent-%COMP%]{width:60px;height:60px;border:2px solid rgba(255,255,255,.4);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff9;font-weight:700;font-size:20px;transition:all .2s ease}.circle[_ngcontent-%COMP%]   i[data-feather][_ngcontent-%COMP%], .circle[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px;flex:0 0 24px;stroke-width:1.5}.carousel-button.active[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%]{background:#ffffffe6;color:#000;border-color:#fff;box-shadow:0 0 12px #ffffff4d}.carousel-button[_ngcontent-%COMP%]:hover:not(.active)   .circle[_ngcontent-%COMP%]{border-color:#fff9;color:#fffc}.app-label[_ngcontent-%COMP%]{color:#fffc;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}@media(min-width:769px){.carousel-container[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:20px;background:#00000080;padding:12px 16px;border-radius:8px;width:auto;flex-direction:row;gap:12px}.carousel-track[_ngcontent-%COMP%]{gap:8px}.app-label[_ngcontent-%COMP%]{margin-left:8px}}"],changeDetection:0})};var Ze=(l,e)=>e.id;function qe(l,e){if(l&1){let t=j();h(0,"div",48),_("click",function(i){return u(t),ne(4).click(),g(i.stopPropagation())})("touchstart",function(i){return u(t),ne(4).click(),g(i.stopPropagation())}),h(1,"div",49),I(2,"+"),p(),h(3,"input",50,0),_("change",function(i){u(t);let o=c().$implicit,r=c();return g(r.onEmptyFrameUpload(i,o.id))}),p()()}}function Ke(l,e){if(l&1){let t=j();h(0,"img",51),_("load",function(i){u(t);let o=c().$implicit,r=c();return g(r.onUserImageLoad(i,o.id))}),p()}if(l&2){let t=c().$implicit;C("src",t.content,he)}}function Qe(l,e){if(l&1){let t=j();h(0,"img",52),_("load",function(i){u(t);let o=c().$implicit,r=c();return g(r.onOgImageLoad(i,o.id))}),p()}if(l&2){let t=c().$implicit;C("src",t.ogImage,he)}}function Je(l,e){if(l&1){let t=j();h(0,"div",56),_("click",function(i){u(t);let o=c(2).$implicit,r=c();return g(r.onIframeOverlayClick(i,o.id))}),h(1,"div",57),I(2," Click to interact "),p()()}}function et(l,e){if(l&1){let t=j();h(0,"div",53),_("mouseenter",function(){u(t);let i=c().$implicit,o=c();return g(o.onIframeMouseEnter(i.id))})("mouseleave",function(){u(t);let i=c().$implicit,o=c();return g(o.onIframeMouseLeave(i.id))}),h(1,"iframe",54),_("load",function(i){u(t);let o=c().$implicit,r=c();return g(r.onIframeLoad(i,o.id))}),p(),V(2,Je,3,0,"div",55),p()}if(l&2){let t=c().$implicit,n=c();b(),A("dimmed",n.hoveredIframeId()===t.id)("interactive",n.interactiveIframeId()===t.id),C("src",t.safeUrl||t.content,ve),J("scrolling",n.interactiveIframeId()===t.id?"yes":"no"),b(),E(n.hoveredIframeId()===t.id&&n.interactiveIframeId()!==t.id?2:-1)}}function tt(l,e){if(l&1){let t=j();h(0,"div",58)(1,"button",72),_("click",function(){u(t);let i=c(2).$implicit,o=c();return g(o.toggleDisplayMode(i.id))}),S(),h(2,"svg",15),w(3,"path",73)(4,"path",74),p()(),X(),h(5,"button",75),_("click",function(){u(t);let i=c(2).$implicit,o=c();return g(o.toggleDisplayMode(i.id))}),S(),h(6,"svg",15),w(7,"path",76),p()()()}if(l&2){let t=c(2).$implicit,n=c();C("ngStyle",n.getInverseScaleStyle(t)),b(),A("active",t.displayMode==="image"),b(4),A("active",t.displayMode==="iframe")}}function nt(l,e){if(l&1){let t=j();V(0,tt,8,5,"div",58),w(1,"div",59),h(2,"div",60),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"scale-nw"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"scale-nw"))}),p(),h(3,"div",61),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"scale-ne"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"scale-ne"))}),p(),h(4,"div",62),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"scale-sw"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"scale-sw"))}),p(),h(5,"div",63),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"scale-se"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"scale-se"))}),p(),h(6,"div",64),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"scale-w"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"scale-w"))}),p(),h(7,"div",65),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"scale-e"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"scale-e"))}),p(),h(8,"div",66),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"scale-n"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"scale-n"))}),p(),h(9,"div",67),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"scale-s"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"scale-s"))}),p(),h(10,"div",68),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"rotate-nw"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"rotate-nw"))}),p(),h(11,"div",69),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"rotate-ne"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"rotate-ne"))}),p(),h(12,"div",70),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"rotate-sw"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"rotate-sw"))}),p(),h(13,"div",71),_("mousedown",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleMouseDown(i,o.id,"rotate-se"))})("touchstart",function(i){u(t);let o=c().$implicit,r=c();return g(r.onHandleTouchStart(i,o.id,"rotate-se"))}),p()}if(l&2){let t=c().$implicit,n=c();E(t.type==="iframe"&&t.ogImage?0:-1),b(),C("ngStyle",n.getSelectionBorderStyle()),b(),k("cursor",n.getCursorForHandle(t,"scale-nw")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getCursorForHandle(t,"scale-ne")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getCursorForHandle(t,"scale-sw")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getCursorForHandle(t,"scale-se")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getCursorForHandle(t,"scale-w")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getCursorForHandle(t,"scale-e")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getCursorForHandle(t,"scale-n")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getCursorForHandle(t,"scale-s")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getRotateCursor(t,"nw")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getRotateCursor(t,"ne")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getRotateCursor(t,"sw")),C("ngStyle",n.getInverseScaleStyle(t)),b(),k("cursor",n.getRotateCursor(t,"se")),C("ngStyle",n.getInverseScaleStyle(t))}}function it(l,e){if(l&1){let t=j();h(0,"div",42),_("click",function(i){let o=u(t).$implicit,r=c();return g(r.onObjectClick(i,o.id))})("mousedown",function(i){let o=u(t).$implicit,r=c();return g(r.onObjectMouseDown(i,o.id))})("touchstart",function(i){let o=u(t).$implicit,r=c();return g(r.onObjectTouchStart(i,o.id))}),w(1,"div",43),V(2,qe,5,0,"div",44)(3,Ke,1,1,"img",45)(4,Qe,1,1,"img",46)(5,et,3,7,"div",47),V(6,nt,14,38),p()}if(l&2){let t=e.$implicit,n=c();A("selected",n.selectedObjectId()===t.id),C("ngStyle",n.getObjectStyle(t)),b(),C("ngStyle",n.getSelectionBorderStyle()),b(),E(t.isEmptyFrame?2:t.type==="image"?3:t.type==="iframe"?4:5),b(4),E(n.selectedObjectId()===t.id?6:-1)}}function ot(l,e){if(l&1){let t=j();h(0,"div",6)(1,"button",77),_("click",function(){u(t);let i=c();return g(i.returnToUrlWrapper())}),S(),h(2,"svg",78),w(3,"path",79),p()()()}}function rt(l,e){if(l&1){let t=j();h(0,"div",80),_("click",function(){u(t);let i=c();return g(i.cancelUrlModal())}),h(1,"div",81),_("click",function(i){return u(t),g(i.stopPropagation())}),h(2,"h3"),I(3,"Add URL"),p(),h(4,"input",82,1),_("input",function(){u(t);let i=ne(5),o=c();return g(o.urlInputValue.set(i.value))})("keydown.enter",function(){u(t);let i=c();return g(i.submitUrlModal())})("keydown.escape",function(){u(t);let i=c();return g(i.cancelUrlModal())}),p(),h(6,"div",83)(7,"button",84),_("click",function(){u(t);let i=c();return g(i.cancelUrlModal())}),I(8,"Cancel"),p(),h(9,"button",85),_("click",function(){u(t);let i=c();return g(i.submitUrlModal())}),I(10,"Add"),p()()()()}if(l&2){let t=c();b(4),C("value",t.urlInputValue())}}var le=class l{platformId=U(N);sanitizer=U(Pe);injector=U(_e);baseSize=200;dataTokenPrefix="data-token-";dataFilePrefix="file-data-";minZoom=.1;maxZoom=5;hashUpdateHandle=null;hashThrottleMs=300;lastSerializedHash="";suppressHash=!1;hashDirty=!1;skipNextHashWrite=!1;readyForHashWrites=!1;initialFitDone=!1;restoredFromHash=!1;wheelFlushHandle=null;ephemeralTokens=new Map;defaultIframeWidth=600;defaultIframeHeight=400;defaultViewportWidth=1920;defaultViewportHeight=1080;transparentPixel="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMB/hsrLxkAAAAASUVORK5CYII=";touchStartDistance=0;touchStartZoom=1;isTouchPinching=!1;activeTouches=0;isMobile=M(!1);instructionsText=F(()=>this.isMobile()?"Tap to select \u2022 Pinch to zoom \u2022 Two fingers to pan":"Drag & drop images \u2022 Paste URLs (Ctrl/Cmd+V) \u2022 Scroll to zoom");objects=M([]);selectedObjectId=M(null);selectedObject=F(()=>{let e=this.selectedObjectId();return e?this.objects().find(t=>t.id===e):null});viewportX=M(0);viewportY=M(0);zoom=M(1);shareMenuOpen=M(!1);addMenuOpen=M(!1);showUrlModal=M(!1);urlInputValue=M("");cameFromUrlWrapper=M(!1);urlWrapperUrl=M(null);selectedAppIndex=M(0);apps=se;hasCustomData=F(()=>this.objects().some(e=>e.type==="image"&&e.sourceRef?.startsWith("data:")));isShuffling=M(!1);hoveredIframeId=M(null);interactiveIframeId=M(null);hoverTimeoutHandle=null;iframeScrollUpdateMap=new WeakMap;baseGridSize=20;gridScaleLevels=[.25,.5,1,2,4,8,16];minVisibleGridSize=8;maxVisibleGridSize=50;gridScale=M(1);gridSize=F(()=>this.baseGridSize*this.gridScale());apparentGridSize=F(()=>this.gridSize()*this.zoom());gridOpacity=F(()=>{let e=this.apparentGridSize();return e<this.minVisibleGridSize?Math.max(0,e/this.minVisibleGridSize):e>this.maxVisibleGridSize?Math.max(0,1-(e-this.maxVisibleGridSize)/(this.maxVisibleGridSize*.5)):1});zoomPercentage=F(()=>Math.round(this.zoom()*100));isDragging=!1;isTransforming=!1;isPanningCanvas=!1;dragStartX=0;dragStartY=0;transformStartX=0;transformStartY=0;transformHandle=null;originalObject=null;panStartViewportX=0;panStartViewportY=0;rotateStartAngle=0;rotateStartRotation=0;viewAnimationFrame=null;pendingInitialFitTimeout=null;pendingFitAfterImageLoad=!1;safeInsetTop=20;safeInsetBottom=100;safeInsetLeft=20;safeInsetRight=20;getVisibleViewportMetrics(){let e=Math.max(0,window.innerWidth-this.safeInsetLeft-this.safeInsetRight),t=Math.max(0,window.innerHeight-this.safeInsetTop-this.safeInsetBottom),n=this.safeInsetLeft+e/2,i=this.safeInsetTop+t/2;return{width:e,height:t,centerX:n,centerY:i}}transformHandles=[{type:"scale-nw",cursor:"nw-resize"},{type:"scale-ne",cursor:"ne-resize"},{type:"scale-sw",cursor:"sw-resize"},{type:"scale-se",cursor:"se-resize"},{type:"scale-w",cursor:"w-resize"},{type:"scale-e",cursor:"e-resize"},{type:"scale-n",cursor:"n-resize"},{type:"scale-s",cursor:"s-resize"},{type:"rotate",cursor:"grab"}];constructor(){if(O(this.platformId)){this.setupEventListeners(),window.addEventListener("hashchange",this.onHashChange),window.addEventListener("keydown",t=>this.onKeyDown(t)),L(()=>{this.isMobile.set(this.detectMobile())}),Z(()=>{this.viewportX(),this.viewportY(),this.zoom(),this.objects(),this.readyForHashWrites?this.scheduleHashUpdate():this.hashDirty=!0}),Z(()=>{let t=this.zoom();this.updateGridScale(t)});let e="";try{sessionStorage.removeItem("canvasLastHash"),window.location.hash&&(e=window.location.hash)}catch{}this.restoredFromHash=!!e,this.suppressHash=!0,e&&this.applyHashState(e),this.suppressHash=!1,this.readyForHashWrites=!0,this.hashDirty&&this.scheduleHashUpdate(),L(()=>{this.cleanupOrphanedStorage();try{let t=new URLSearchParams(window.location.search),n=t.get("shareUrl");if(n){this.cameFromUrlWrapper.set(!0),this.urlWrapperUrl.set(n);try{localStorage.setItem("wall-url",n)}catch(r){console.warn("[Canvas] Could not store wall-url",r)}this.objects().some(r=>r.sourceRef===n)||this.addUrlObject(n),this.pendingInitialFitTimeout!==null&&window.clearTimeout(this.pendingInitialFitTimeout),this.pendingInitialFitTimeout=window.setTimeout(()=>{this.pendingInitialFitTimeout!==null&&(this.animateFitToContent(),this.pendingInitialFitTimeout=null)},1500),t.delete("shareUrl");let o=window.location.pathname+(t.toString()?"?"+t.toString():"")+window.location.hash;window.history.replaceState(null,"",o)}}catch{}})}}onAppChange(e){this.selectedAppIndex.set(e);let t=this.apps[e];if(t)switch(t.id!=="frame"&&this.objects.update(n=>n.filter(i=>!i.isFrameObject)),t.id){case"centered":{this.animateFitToContent(!0);break}case"frame":{let n=this.objects();n.length>0&&!n.some(i=>i.isEmptyFrame)&&this.createEmptyFrame(),Q(this.injector,()=>{L(()=>this.animateFitToContent(!0))});break}}}createEmptyFrame(){let e=this.objects().find(d=>!d.isFrameObject);if(!e)return;let t=e.width,n=e.height,i=Math.round(t*.7),o=Math.round(n*.3),r=e.x+i,s=e.y+o,a={id:this.generateId(),type:"image",x:r,y:s,width:t,height:n,rotation:0,content:"frame-placeholder",sourceRef:"frame-empty",originalAspectRatio:n/t,displayMode:"image",isEmptyFrame:!0,isFrameObject:!0};this.addObject(a),this.selectedObjectId.set(a.id)}addUrlObject(e){let t=this.defaultViewportWidth/2-this.defaultIframeWidth/2,n=this.defaultViewportHeight/2-this.defaultIframeHeight/2,i=this.defaultIframeWidth>0?this.defaultIframeHeight/this.defaultIframeWidth:1,o=this.zoom()||1,r={id:this.generateId(),type:"iframe",x:t/o,y:n/o,width:this.defaultIframeWidth,height:this.defaultIframeHeight,rotation:0,content:e,sourceRef:e,originalAspectRatio:i,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(e),displayMode:"image"};this.addObject(r),this.pendingFitAfterImageLoad=!0,this.fetchOgImage(e,r.id)}onEmptyFrameUpload(e,t){let i=e.target.files?.[0];if(!i)return;let o=new FileReader;o.onload=r=>{let s=r.target?.result;if(s){let a=new Image;a.onload=()=>{let d=a.naturalWidth||a.width,m=a.naturalHeight||a.height,f=m>0&&d>0?m/d:1,v=this.objects().find(H=>!H.isFrameObject),x=v?v.width*v.height:this.defaultIframeWidth*this.defaultIframeHeight,T=Math.round(Math.sqrt(x/(f||1))),z=Math.round(Math.sqrt(x*(f||1)));this.objects.update(H=>H.map(R=>R.id===t?D(P({},R),{content:s,sourceRef:i.name,displayMode:"image",isEmptyFrame:!1,isFrameObject:!0,width:T,height:z,originalAspectRatio:f||1,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(s)}):R)),Q(this.injector,()=>{L(()=>this.animateFitToContent(!0))})},a.src=s}},o.readAsDataURL(i)}fitOnceAfterLoad(){this.initialFitDone||(this.initialFitDone=!0,L(()=>this.animateFitToContent()))}animateFitToContent(e=!1){let t=this.computeFitToViewTargets();if(!e){let n=this.calculateCompositionBounds();if(n){let{centerY:i}=this.getVisibleViewportMetrics(),o=n.y+n.height/2;this.zoom.set(t.zoom*.5),this.viewportX.set(-n.width*t.zoom),this.viewportY.set(i-o*t.zoom*.5)}}this.animateToView(t.zoom,t.viewportX,t.viewportY,450)}animateToView(e,t,n,i=450){let o=this.zoom(),r=this.viewportX(),s=this.viewportY(),a=performance.now();this.viewAnimationFrame!==null&&(cancelAnimationFrame(this.viewAnimationFrame),this.viewAnimationFrame=null);let d=f=>1-Math.pow(1-f,3),m=()=>{let f=performance.now()-a,v=Math.min(1,f/i),x=d(v);this.zoom.set(o+(e-o)*x),this.viewportX.set(r+(t-r)*x),this.viewportY.set(s+(n-s)*x),v<1?this.viewAnimationFrame=requestAnimationFrame(m):this.viewAnimationFrame=null};this.viewAnimationFrame=requestAnimationFrame(m)}returnToUrlWrapper(){if(!O(this.platformId))return;let e=this.urlWrapperUrl()||localStorage.getItem("wall-url"),t=this.computeBasePath();e?window.location.href=`${t}?wallUrl=${encodeURIComponent(e)}`:window.location.href=t}shareVia(e){if(!O(this.platformId))return;let t=window.location.href,n=this.hasCustomData();switch(e){case"copy":n||this.copyToClipboard(t);break;case"whatsapp":n?this.shareImage():this.shareToWhatsApp(t);break;case"instagram":n?this.shareImage():this.shareToInstagram(t);break;case"upload":this.shareImage();break;case"download":this.downloadImage();break}}copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>{alert("Link copied to clipboard!")}).catch(()=>{let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy"),alert("Link copied to clipboard!")}catch(n){console.error("Failed to copy:",n)}document.body.removeChild(t)})}shareToWhatsApp(e){let n=`https://wa.me/?text=${encodeURIComponent("Check out this composition: "+e)}`;window.open(n,"_blank")}shareToInstagram(e){this.copyToClipboard(e),window.open("https://instagram.com","_blank")}shareToWeb(e){navigator.share?navigator.share({title:"Canvas Composition",text:"Check out this composition",url:e}).catch(t=>console.error("Share failed:",t)):this.copyToClipboard(e)}shareViaDownload(){this.downloadImage()}async shuffleImage(){if(O(this.platformId)&&!this.isShuffling()){this.isShuffling.set(!0);try{this.objects().filter(n=>n.type==="iframe").forEach(n=>{this.cleanupObjectStorage(n)}),this.objects.update(n=>n.filter(i=>i.type!=="iframe")),this.selectedObjectId.set(null);let t=await this.fetchRandomGradimUrl();if(t){this.addUrlObject(t),this.urlWrapperUrl.set(t);try{localStorage.setItem("wall-url",t)}catch(n){console.warn("[Canvas] Could not store wall-url",n)}}}catch(e){console.error("[Canvas] Error shuffling image:",e)}finally{this.isShuffling.set(!1)}}}async fetchRandomGradimUrl(){let e="https://gradim-wall.netlify.app",t="https://gradim.fh-potsdam.de/omeka-s/api/items?per_page=1&sort_by=random&fields[]=dcterms:identifier",n="https://gradim.fh-potsdam.de/omeka-s/api/items?per_page=1&sort_by=random";try{let i=await this.fetchIdentifierFromUrl(t)??await this.fetchIdentifierFromUrl(n);return i?`${e}/${i}`:null}catch{return null}}async fetchIdentifierFromUrl(e){try{let t=await fetch(e,{headers:{Accept:"application/json"}});if(!t.ok)return null;let n=await t.json();if(!Array.isArray(n)||n.length===0)return null;let i=n[0]?.["dcterms:identifier"]?.[0]?.["@value"];return typeof i=="string"?i:null}catch{return null}}computeBasePath(){let e=window.location.pathname,t=e.indexOf("/sample-reflect");return t>=0?e.substring(0,t+1):"/"}onHashChange=()=>{if(!O(this.platformId))return;let e=window.location.hash||"";if(!e||e==="#"){try{sessionStorage.removeItem("canvasLastHash")}catch{}this.lastSerializedHash="",this.suppressHash=!0,this.objects.set([]),this.selectedObjectId.set(null),this.viewportX.set(0),this.viewportY.set(0),this.zoom.set(1),this.suppressHash=!1,this.hashDirty=!1,this.skipNextHashWrite=!0;return}let t=this.serializeStateToHash(),n=t?`#${t}`:"";if(!(e===n||e===this.lastSerializedHash)){if(this.objects().length>0&&e.length<this.lastSerializedHash.length){this.lastSerializedHash=n;return}this.applyHashState(e),this.lastSerializedHash=e}};setupEventListeners(){window.addEventListener("paste",e=>this.onPaste(e)),window.addEventListener("dragover",e=>e.preventDefault()),window.addEventListener("wheel",e=>this.onWheel(e),{passive:!1}),window.addEventListener("touchstart",e=>this.onTouchStart(e),{passive:!1}),window.addEventListener("touchmove",e=>this.onTouchMove(e),{passive:!1}),window.addEventListener("touchend",e=>this.onTouchEnd(e),{passive:!1}),window.addEventListener("resize",()=>{this.isMobile.set(this.detectMobile())})}detectMobile(){if(!O(this.platformId))return!1;let e=window.innerWidth<=768,t="ontouchstart"in window||navigator.maxTouchPoints>0,n=navigator.userAgent.toLowerCase(),i=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(n);return e||t&&i}onDrop(e){e.preventDefault(),e.stopPropagation();let t=e.dataTransfer?.files;if(t&&t.length>0){let n=t[0];if(n.type.startsWith("image/")){let i=new FileReader;i.onload=()=>{let o=e.currentTarget,r=o?o.getBoundingClientRect():{left:0,top:0},s=e.clientX-r.left-this.viewportX(),a=e.clientY-r.top-this.viewportY(),d=i.result,m=this.deriveSourceRef(d,n.name),f=new Image;f.onload=()=>{let v=f.naturalHeight/f.naturalWidth||1;this.addObject({id:this.generateId(),type:"image",x:s/this.zoom(),y:a/this.zoom(),width:this.baseSize,height:this.baseSize*v,rotation:0,content:d,sourceRef:m,originalAspectRatio:v})},f.onerror=()=>{this.addObject({id:this.generateId(),type:"image",x:s/this.zoom(),y:a/this.zoom(),width:this.baseSize,height:this.baseSize,rotation:0,content:d,sourceRef:m,originalAspectRatio:1})},f.src=d},i.readAsDataURL(n)}}}onDragOver(e){e.preventDefault(),e.stopPropagation()}onPaste(e){let t=e.target,n=document.activeElement,i=r=>!!r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.isContentEditable||r.closest(".url-input")!==null);if(i(t)||i(n))return;let o=e.clipboardData?.getData("text");if(o&&this.isValidUrl(o)){let r=this.deriveSourceRef(o),s={id:this.generateId(),type:"iframe",x:(window.innerWidth/2-this.viewportX())/this.zoom(),y:(window.innerHeight/2-this.viewportY())/this.zoom(),width:600,height:400,rotation:0,content:o,sourceRef:r,originalAspectRatio:400/600,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(o),displayMode:"image"};this.addObject(s),this.fetchOgImage(o,s.id),e.preventDefault()}}onFileSelected(e){let t=e.target,n=t.files&&t.files[0];if(!n||!n.type.startsWith("image/"))return;let i=new FileReader;i.onload=()=>{let o=i.result,r=this.deriveSourceRef(o,n.name),s=new Image;s.onload=()=>{let a=s.naturalHeight/s.naturalWidth||1,d=(window.innerWidth/2-this.viewportX())/this.zoom(),m=(window.innerHeight/2-this.viewportY())/this.zoom();this.addObject({id:this.generateId(),type:"image",x:d-this.baseSize/2,y:m-this.baseSize*a/2,width:this.baseSize,height:this.baseSize*a,rotation:0,content:o,sourceRef:r,originalAspectRatio:a})},s.onerror=()=>{let a=(window.innerWidth/2-this.viewportX())/this.zoom(),d=(window.innerHeight/2-this.viewportY())/this.zoom();this.addObject({id:this.generateId(),type:"image",x:a-this.baseSize/2,y:d-this.baseSize/2,width:this.baseSize,height:this.baseSize,rotation:0,content:o,sourceRef:r,originalAspectRatio:1})},s.src=o},i.readAsDataURL(n),t.value=""}isValidUrl(e){try{return new URL(e),!0}catch{return!1}}async fetchOgImage(e,t){if(!O(this.platformId))return;let n=window.location.hostname.toLowerCase(),i=n==="localhost"||n==="127.0.0.1"||n==="::1",o=this.getGradimWallOgImage(e);if(o){this.updateObjectOgImage(t,o);return}if(!i){this.trySetDevelopmentOgImage(e,t);return}let r=!1;try{let s=`/api/url-metadata?url=${encodeURIComponent(e)}`,a=await fetch(s),d=a.headers.get("content-type");if(a.ok&&d?.includes("application/json")){let m=await a.json();m.ogImage&&(this.updateObjectOgImage(t,m.ogImage),r=!0)}}catch{}r||this.trySetDevelopmentOgImage(e,t)}trySetDevelopmentOgImage(e,t){try{let n=new URL(e),i=n.hostname.toLowerCase(),r={"github.com":"https://github.githubassets.com/images/modules/site/social-cards/github-social.png","www.github.com":"https://github.githubassets.com/images/modules/site/social-cards/github-social.png","youtube.com":"https://www.youtube.com/img/desktop/yt_1200.png","www.youtube.com":"https://www.youtube.com/img/desktop/yt_1200.png"}[i];!r&&i==="gradim-wall.netlify.app"&&(r=this.getGradimWallOgImage(n.toString())||void 0),r&&setTimeout(()=>{this.updateObjectOgImage(t,r)},500)}catch{}}getGradimWallOgImage(e){try{let t=new URL(e);if(t.hostname.toLowerCase()!=="gradim-wall.netlify.app")return null;let n=t.pathname.split("/").filter(Boolean),i=decodeURIComponent(n[n.length-1]||"");if(i&&/^[A-Za-z0-9_\-]+$/.test(i))return`https://gradim.fh-potsdam.de/omeka-s/files/large/${i}.jpg`}catch{}return null}extractOgImage(e){let t=e.match(/<meta[^>]*property=["']og:image["'][^>]*content=["']([^"']*)["'][^>]*>/i)||e.match(/<meta[^>]*content=["']([^"']*)["'][^>]*property=["']og:image["'][^>]*>/i);return t?t[1]:null}updateObjectOgImage(e,t){let n=new Image;n.onload=()=>{let i=n.naturalHeight/n.naturalWidth||1,o=600,r=o*i;this.objects.update(s=>s.map(a=>a.id===e?D(P({},a),{ogImage:t,width:o,height:r,originalAspectRatio:i,displayMode:"image"}):a)),this.scheduleHashUpdate(),this.pendingInitialFitTimeout!==null&&(window.clearTimeout(this.pendingInitialFitTimeout),this.pendingInitialFitTimeout=null),this.pendingFitAfterImageLoad&&(this.pendingFitAfterImageLoad=!1,this.animateFitToContent())},n.onerror=()=>{this.objects.update(i=>i.map(o=>o.id===e?D(P({},o),{ogImage:t}):o))},n.src=t}toggleDisplayMode(e){let t=this.objects().find(i=>i.id===e);if(!t||t.type!=="iframe"||!t.ogImage)return;let n=t.displayMode==="iframe"?"image":"iframe";this.objects.update(i=>i.map(o=>o.id===e?D(P({},o),{displayMode:n}):o)),this.scheduleHashUpdate()}setOgImageForTesting(e){if(!this.isValidUrl(e)){console.error("Invalid URL format:",e);return}let t=this.selectedObjectId();if(!t){console.warn("No object selected. Please select an iframe object first.");return}let n=this.objects().find(i=>i.id===t);if(!n||n.type!=="iframe"){console.warn("Selected object is not an iframe.");return}this.updateObjectOgImage(t,e),console.log("og:image set to:",e,"- toggle buttons should now be visible")}addObject(e){this.objects.update(t=>[...t,e]),this.selectedObjectId.set(e.id),this.scheduleHashUpdate()}onKeyDown(e){if(e.key!=="Backspace")return;let t=e.target;if(t&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable))return;let n=this.selectedObjectId();if(!n)return;e.preventDefault();let i=this.objects().find(o=>o.id===n);i&&this.cleanupObjectStorage(i),this.objects.update(o=>o.filter(r=>r.id!==n)),this.selectedObjectId.set(null)}onObjectClick(e,t){e.stopPropagation(),this.selectedObjectId.set(t),(this.objects().find(i=>i.id===t)?.type!=="iframe"||this.interactiveIframeId()!==t)&&(this.interactiveIframeId.set(null),this.updateAllIframeScrollStates())}onCanvasClick(e){let t=e.target,n=t===e.currentTarget||t.classList.contains("dot-grid")||t.classList.contains("canvas-objects");this.hashDirty&&this.scheduleHashUpdate(),n&&(this.selectedObjectId.set(null),this.interactiveIframeId.set(null),this.updateAllIframeScrollStates())}onCanvasMouseDown(e){if(e.target===e.currentTarget||e.target.classList.contains("dot-grid")){this.suppressHash=!0,this.selectedObjectId.set(null),this.isPanningCanvas=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.panStartViewportX=this.viewportX(),this.panStartViewportY=this.viewportY();let t=i=>{if(!this.isPanningCanvas)return;let o=i.clientX-this.dragStartX,r=i.clientY-this.dragStartY;this.viewportX.set(this.panStartViewportX+o),this.viewportY.set(this.panStartViewportY+r)},n=()=>{this.isPanningCanvas=!1,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",n)};window.addEventListener("mousemove",t),window.addEventListener("mouseup",n)}}onCanvasTouchStart(e){if(e.touches.length===2){let t=e.target;if(t===e.currentTarget||t?.classList&&(t.classList.contains("dot-grid")||t.classList.contains("canvas-objects"))){e.preventDefault(),this.suppressHash=!0,this.selectedObjectId.set(null),this.isPanningCanvas=!0;let i=e.touches[0],o=e.touches[1],r=(i.clientX+o.clientX)/2,s=(i.clientY+o.clientY)/2;this.dragStartX=r,this.dragStartY=s,this.panStartViewportX=this.viewportX(),this.panStartViewportY=this.viewportY();let a=m=>{if(!this.isPanningCanvas||m.touches.length!==2)return;let f=m.touches[0],v=m.touches[1],x=(f.clientX+v.clientX)/2,T=(f.clientY+v.clientY)/2,z=x-this.dragStartX,H=T-this.dragStartY;this.viewportX.set(this.panStartViewportX+z),this.viewportY.set(this.panStartViewportY+H)},d=()=>{this.isPanningCanvas=!1,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",d)};window.addEventListener("touchmove",a),window.addEventListener("touchend",d)}}}onObjectMouseMove(e,t){}onObjectMouseLeave(e){}updateAllIframeScrollStates(){setTimeout(()=>{document.querySelectorAll("iframe.object-content").forEach(t=>{let n=t,i=this.iframeScrollUpdateMap.get(n);i&&i()})},0)}clearHoverTimeout(){this.hoverTimeoutHandle&&(clearTimeout(this.hoverTimeoutHandle),this.hoverTimeoutHandle=null)}onIframeMouseEnter(e){this.clearHoverTimeout(),this.hoverTimeoutHandle=setTimeout(()=>{this.interactiveIframeId()!==e&&this.hoveredIframeId.set(e)},500)}onIframeMouseLeave(e){this.clearHoverTimeout(),this.hoveredIframeId()===e&&this.hoveredIframeId.set(null)}onIframeOverlayClick(e,t){e.stopPropagation(),this.interactiveIframeId.set(t),this.hoveredIframeId.set(null),this.clearHoverTimeout(),this.updateAllIframeScrollStates()}updateGridScale(e){let t=this.gridScaleLevels[0],n=1/0;for(let i of this.gridScaleLevels){let o=this.baseGridSize*i*e,r=(this.minVisibleGridSize+this.maxVisibleGridSize)/2,s=Math.abs(o-r);s<n&&(n=s,t=i)}this.gridScale.set(t)}computeFitToViewTargets(){if(this.objects().length===0)return{zoom:1,viewportX:0,viewportY:0};let t=this.calculateCompositionBounds();if(!t)return{zoom:1,viewportX:0,viewportY:0};let i=this.isMobile()?20:40,{width:o,height:r,centerX:s,centerY:a}=this.getVisibleViewportMetrics(),d=Math.max(0,o-2*i),m=Math.max(0,r-2*i),f=d/t.width,v=m/t.height,x=Math.min(f,v,this.maxZoom),T=t.x+t.width/2,z=t.y+t.height/2,H=s,R=a,q=H-T*x,$=R-z*x;return{zoom:x,viewportX:q,viewportY:$}}fitToView(){let{zoom:e,viewportX:t,viewportY:n}=this.computeFitToViewTargets();this.zoom.set(e),this.viewportX.set(t),this.viewportY.set(n)}onWheel(e){e.preventDefault(),this.suppressHash=!0;let n=e.deltaY>0?.9:1.1,i=Math.max(this.minZoom,Math.min(this.maxZoom,this.zoom()*n)),o=e.clientX,r=e.clientY,s=(o-this.viewportX())/this.zoom(),a=(r-this.viewportY())/this.zoom();this.zoom.set(i),this.viewportX.set(o-s*i),this.viewportY.set(r-a*i),this.wheelFlushHandle&&window.clearTimeout(this.wheelFlushHandle),this.wheelFlushHandle=window.setTimeout(()=>{this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),this.wheelFlushHandle=null},300)}async onShareClick(){try{await this.shareComposition()}catch(e){console.error("Failed to share composition:",e)}}toggleAddMenu(){this.addMenuOpen.update(e=>!e),this.addMenuOpen()&&this.shareMenuOpen.set(!1)}onAddImageClick(){document.querySelector('input[type="file"]')?.click(),this.addMenuOpen.set(!1)}onAddUrlClick(){this.addMenuOpen.set(!1),this.urlInputValue.set(""),this.showUrlModal.set(!0),setTimeout(()=>{document.querySelector(".url-input")?.focus()},100)}submitUrlModal(){let e=this.urlInputValue().trim();this.showUrlModal.set(!1),e&&this.addIframeFromUrl(e)}cancelUrlModal(){this.showUrlModal.set(!1),this.urlInputValue.set("")}addIframeFromUrl(e){if(!this.isValidUrl(e)){console.warn("Invalid URL:",e);return}let t=this.deriveSourceRef(e),n=this.getGradimWallOgImage(e),i={id:this.generateId(),type:"iframe",x:(window.innerWidth/2-this.viewportX())/this.zoom(),y:(window.innerHeight/2-this.viewportY())/this.zoom(),width:600,height:400,rotation:0,content:e,sourceRef:t,originalAspectRatio:400/600,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(e),displayMode:"image",ogImage:n??void 0};this.addObject(i),n||this.fetchOgImage(e,i.id)}onTouchStart(e){if(this.activeTouches=e.touches.length,e.touches.length===2){e.preventDefault(),this.isTouchPinching=!0,this.suppressHash=!0;let t=e.touches[0],n=e.touches[1];this.touchStartDistance=this.getTouchDistance(t,n),this.touchStartZoom=this.zoom()}else e.touches.length}onTouchMove(e){if(e.touches.length===2&&this.isTouchPinching){e.preventDefault();let t=e.touches[0],n=e.touches[1],i=this.getTouchDistance(t,n);if(this.touchStartDistance>0){let o=i/this.touchStartDistance,r=Math.max(this.minZoom,Math.min(this.maxZoom,this.touchStartZoom*o)),s=(t.clientX+n.clientX)/2,a=(t.clientY+n.clientY)/2,d=(s-this.viewportX())/this.zoom(),m=(a-this.viewportY())/this.zoom();this.zoom.set(r),this.viewportX.set(s-d*r),this.viewportY.set(a-m*r)}}}onTouchEnd(e){this.activeTouches=e.touches.length,e.touches.length<2&&(this.isTouchPinching=!1,this.touchStartDistance=0,e.touches.length===0&&(this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate()))}getTouchDistance(e,t){let n=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(n*n+i*i)}onObjectMouseDown(e,t){e.preventDefault(),e.stopPropagation();let n=this.objects().find(r=>r.id===t);if(!n)return;this.isDragging=!0,this.suppressHash=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.originalObject=P({},n),this.selectedObjectId.set(t);let i=r=>{if(!this.isDragging||!this.originalObject)return;let s=(r.clientX-this.dragStartX)/this.zoom(),a=(r.clientY-this.dragStartY)/this.zoom();this.objects.update(d=>d.map(m=>m.id===t?D(P({},m),{x:this.originalObject.x+s,y:this.originalObject.y+a}):m))},o=()=>{this.isDragging=!1,this.originalObject=null,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",o)};window.addEventListener("mousemove",i),window.addEventListener("mouseup",o)}onHandleMouseDown(e,t,n){e.preventDefault(),e.stopPropagation();let i=this.objects().find(s=>s.id===t);if(!i)return;this.isTransforming=!0,this.suppressHash=!0,this.transformStartX=e.clientX,this.transformStartY=e.clientY,this.transformHandle=n,this.originalObject=P({},i),this.rotateStartRotation=i.rotation,this.rotateStartAngle=this.getPointerAngle(i,e.clientX,e.clientY);let o=s=>{if(!this.isTransforming||!this.originalObject)return;let a=(s.clientX-this.transformStartX)/this.zoom(),d=(s.clientY-this.transformStartY)/this.zoom();this.transformHandle?.startsWith("rotate-")?this.handleRotate(t,s.clientX,s.clientY):this.transformHandle==="rotate"?this.handleRotate(t,s.clientX,s.clientY):this.transformHandle?.startsWith("scale-")&&this.handleScale(t,a,d,this.transformHandle)},r=()=>{this.isTransforming=!1,this.originalObject=null,this.transformHandle=null,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",r)}onObjectTouchStart(e,t){if(e.touches.length!==1)return;e.preventDefault(),e.stopPropagation();let n=this.objects().find(s=>s.id===t);if(!n)return;let i=e.touches[0];this.isDragging=!0,this.suppressHash=!0,this.dragStartX=i.clientX,this.dragStartY=i.clientY,this.originalObject=P({},n),this.selectedObjectId.set(t);let o=s=>{if(!this.isDragging||!this.originalObject||s.touches.length!==1)return;let a=s.touches[0],d=(a.clientX-this.dragStartX)/this.zoom(),m=(a.clientY-this.dragStartY)/this.zoom();this.objects.update(f=>f.map(v=>v.id===t?D(P({},v),{x:this.originalObject.x+d,y:this.originalObject.y+m}):v))},r=()=>{this.isDragging=!1,this.originalObject=null,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",r)};window.addEventListener("touchmove",o),window.addEventListener("touchend",r)}onHandleTouchStart(e,t,n){if(e.touches.length!==1)return;e.preventDefault(),e.stopPropagation();let i=this.objects().find(a=>a.id===t);if(!i)return;let o=e.touches[0];this.isTransforming=!0,this.suppressHash=!0,this.transformStartX=o.clientX,this.transformStartY=o.clientY,this.transformHandle=n,this.originalObject=P({},i),this.rotateStartRotation=i.rotation,this.rotateStartAngle=this.getPointerAngle(i,o.clientX,o.clientY);let r=a=>{if(!this.isTransforming||!this.originalObject||a.touches.length!==1)return;let d=a.touches[0],m=(d.clientX-this.transformStartX)/this.zoom(),f=(d.clientY-this.transformStartY)/this.zoom();this.transformHandle?.startsWith("rotate-")?this.handleRotate(t,d.clientX,d.clientY):this.transformHandle==="rotate"?this.handleRotate(t,d.clientX,d.clientY):this.transformHandle?.startsWith("scale-")&&this.handleScale(t,m,f,this.transformHandle)},s=()=>{this.isTransforming=!1,this.originalObject=null,this.transformHandle=null,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("touchmove",r),window.removeEventListener("touchend",s)};window.addEventListener("touchmove",r),window.addEventListener("touchend",s)}handleScale(e,t,n,i){if(!this.originalObject)return;let o=this.originalObject.width,r=this.originalObject.height,s=0,a=0;if(i==="scale-nw"){let d=(-t-n)/2;o=Math.max(50,this.originalObject.width+d),r=o*this.originalObject.originalAspectRatio,s=this.originalObject.width-o,a=this.originalObject.height-r}else if(i==="scale-ne"){let d=(t-n)/2;o=Math.max(50,this.originalObject.width+d),r=o*this.originalObject.originalAspectRatio,a=this.originalObject.height-r}else if(i==="scale-sw"){let d=(-t+n)/2;o=Math.max(50,this.originalObject.width+d),r=o*this.originalObject.originalAspectRatio,s=this.originalObject.width-o}else if(i==="scale-se"){let d=(t+n)/2;o=Math.max(50,this.originalObject.width+d),r=o*this.originalObject.originalAspectRatio}else i==="scale-w"?(o=Math.max(50,this.originalObject.width-t),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:this.originalObject.height,s=this.originalObject.width-o,this.originalObject.type==="image"&&(a=(this.originalObject.height-r)/2)):i==="scale-e"?(o=Math.max(50,this.originalObject.width+t),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:this.originalObject.height,this.originalObject.type==="image"&&(a=(this.originalObject.height-r)/2)):i==="scale-n"?(r=Math.max(50,this.originalObject.height-n),o=this.originalObject.type==="image"?r/this.originalObject.originalAspectRatio:this.originalObject.width,a=this.originalObject.height-r,this.originalObject.type==="image"&&(s=(this.originalObject.width-o)/2)):i==="scale-s"&&(r=Math.max(50,this.originalObject.height+n),o=this.originalObject.type==="image"?r/this.originalObject.originalAspectRatio:this.originalObject.width,this.originalObject.type==="image"&&(s=(this.originalObject.width-o)/2));this.objects.update(d=>d.map(m=>m.id===e?D(P({},m),{width:o,height:r,x:this.originalObject.x+s,y:this.originalObject.y+a}):m))}handleRotate(e,t,n){if(!this.originalObject)return;let i=this.objects().find(d=>d.id===e);if(!i)return;let r=this.getPointerAngle(i,t,n)-this.rotateStartAngle,s=this.rotateStartRotation+r,a=this.snapAngleWithin(s,45,2);this.objects.update(d=>d.map(m=>m.id===e?D(P({},m),{rotation:a}):m))}getPointerAngle(e,t,n){let i=(e.x+e.width/2)*this.zoom()+this.viewportX(),o=(e.y+e.height/2)*this.zoom()+this.viewportY();return Math.atan2(n-o,t-i)*(180/Math.PI)}getObjectStyle(e){return{left:`${e.x}px`,top:`${e.y}px`,width:`${e.width}px`,height:`${e.height}px`,transform:`rotate(${e.rotation}deg)`}}snapAngle(e,t=45){return Math.round(e/t)*t}snapAngleWithin(e,t=45,n=2){let i=Math.round(e/t)*t;return Math.abs(e-i)<=n?i:e}getHandlePosition(e,t){return{"scale-nw":{top:"-5px",left:"-5px"},"scale-ne":{top:"-5px",right:"-5px"},"scale-sw":{bottom:"-5px",left:"-5px"},"scale-se":{bottom:"-5px",right:"-5px"},rotate:{top:"-30px",left:"50%",transform:"translateX(-50%)"}}[t.type]||{}}getCanvasObjectsStyle(){return{transform:`translate(${this.viewportX()}px, ${this.viewportY()}px) scale(${this.zoom()})`,"transform-origin":"0 0"}}getDotGridStyle(){let t=this.gridSize()*this.zoom(),n=this.viewportX()%t,i=this.viewportY()%t;return{"background-size":`${t}px ${t}px`,"background-position":`${n}px ${i}px`,opacity:this.gridOpacity().toString()}}getInverseScaleStyle(e){let t=1/this.zoom();return{transform:`scale(${t})`,"--inverse-scale":t.toString()}}getSelectionBorderStyle(){return{"--inverse-scale":(1/this.zoom()).toString()}}onOgImageLoad(e,t){this.pendingFitAfterImageLoad&&(this.pendingFitAfterImageLoad=!1,this.animateFitToContent(!0))}onUserImageLoad(e,t){Q(this.injector,()=>{L(()=>this.animateFitToContent(!0))})}onIframeLoad(e,t){let n=e.target;if(!n)return;let i=()=>{try{let o=n.contentDocument||n.contentWindow?.document||null;if(!o)return;let r=this.interactiveIframeId()===t,s=r?"auto":"hidden";o.documentElement&&(o.documentElement.style.overflow=s),o.body&&(o.body.style.overflow=s);let a=o.head?.querySelector("style[data-iframe-scroll]");if(a&&a.remove(),!r){let d=o.createElement("style");d.setAttribute("data-iframe-scroll","true"),d.textContent="::-webkit-scrollbar{display:none} html,body{overflow:hidden!important}",o.head?.appendChild(d)}}catch{}};i(),this.iframeScrollUpdateMap.set(n,i)}normalizeAngle180(e){let t=e%180;return t<0&&(t+=180),t}getCursorForHandle(e,t){let n=this.normalizeAngle180(e.rotation),i=n>=45&&n<=135,o=n<45||n>135;if(t.startsWith("scale-"))switch(t){case"scale-nw":case"scale-se":return o?"nwse-resize":"nesw-resize";case"scale-ne":case"scale-sw":return o?"nesw-resize":"nwse-resize";case"scale-w":case"scale-e":return i?"ns-resize":"ew-resize";case"scale-n":case"scale-s":return i?"ew-resize":"ns-resize"}return"move"}buildRotateCursorSvg(e){let t=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<g transform="rotate(${e} 12 12)">
<g clip-path="url(#clip0_325_17)">
<g filter="url(#filter0_d_325_17)">
<path d="M11 6C11.9193 6 12.8295 6.18106 13.6788 6.53284C14.5281 6.88463 15.2997 7.40024 15.9497 8.05025C16.5998 8.70026 17.1154 9.47194 17.4672 10.3212C17.8189 11.1705 18 12.0807 18 13V16H22L16 22L10 16H14V13C14 12.606 13.9224 12.2159 13.7716 11.8519C13.6209 11.488 13.3999 11.1573 13.1213 10.8787C12.8427 10.6001 12.512 10.3791 12.1481 10.2284C11.7841 10.0776 11.394 10 11 10H8V14L2 8L8 2V6H11Z" fill="white"/>
<path d="M11 9H7V11.5L3.5 8L7 4.5L7 7H11C11.7879 7 12.5682 7.15519 13.2961 7.45672C14.0241 7.75825 14.6855 8.20021 15.2426 8.75736C15.7998 9.31451 16.2418 9.97594 16.5433 10.7039C16.8448 11.4319 17 12.2121 17 13V17L19.5 17L16 20.5L12.5 17H15V13C15 12.4747 14.8965 11.9546 14.6955 11.4693C14.4945 10.984 14.1999 10.543 13.8284 10.1716C13.457 9.80014 13.016 9.5055 12.5307 9.30448C12.0454 9.10346 11.5253 9 11 9Z" fill="black"/>
</g>
</g>
<defs>
<filter id="filter0_d_325_17" x="0.2" y="1.2" width="23.6" height="23.6" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
<feOffset dy="1"/>
<feGaussianBlur stdDeviation="0.9"/>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.65 0"/>
<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_325_17"/>
<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_325_17" result="shape"/>
</filter>
<clipPath id="clip0_325_17">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>
</g>
</svg>`;return`url("data:image/svg+xml;utf8,${encodeURIComponent(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}") 12 12, auto`}getRotateCursor(e,t){let i={ne:0,nw:270,sw:180,se:90}[t]+e.rotation;return this.buildRotateCursorSvg(i)}scheduleHashUpdate(){if(O(this.platformId)){if(this.skipNextHashWrite){this.skipNextHashWrite=!1,this.hashDirty=!1;return}if(!this.readyForHashWrites){this.hashDirty=!0;return}if(this.suppressHash){this.hashDirty=!0;return}this.hashUpdateHandle&&window.clearTimeout(this.hashUpdateHandle),this.hashUpdateHandle=window.setTimeout(()=>{let e=this.serializeStateToHash(),t=e?`#${e}`:"";if(t!==this.lastSerializedHash){window.location.hash=t,this.lastSerializedHash=t;try{sessionStorage.setItem("canvasLastHash",t)}catch{}}this.hashDirty=!1,this.hashUpdateHandle=null},this.hashThrottleMs)}}serializeStateToHash(){let e=[];e.push(this.serializeCanvasSegment());for(let t of this.objects())t.isFrameObject||t.isEmptyFrame||e.push(this.serializeObjectSegment(t));return e.join("#")}serializeCanvasSegment(){let e=this.roundNumber(this.viewportX()),t=this.roundNumber(this.viewportY()),n=this.roundNumber(this.zoom());return`canvas/${e},${t},${n}`}serializeObjectSegment(e){let t=this.roundNumber(e.x),n=this.roundNumber(e.y),i=this.roundNumber(e.width/this.baseSize),o=this.roundNumber(e.rotation),r=e.width===0?1:e.height/e.width,s=[`type:${e.type}`,`ratio:${this.roundNumber(r)}`];return e.displayMode&&s.push(`mode:${e.displayMode}`),e.ogImage&&s.push(`og:${encodeURIComponent(e.ogImage)}`),`${encodeURIComponent(e.sourceRef)}/${t},${n},${i},${o}/${s.join(",")}`}applyHashState(e){if(!O(this.platformId)||!e||e.length<=1)return;let t=e.substring(1).split("#").filter(Boolean);if(t.length===0)return;let n=[],i=new Set,o=this.viewportX(),r=this.viewportY(),s=this.zoom();for(let a of t){let d=[];for(let y=0;y<a.length;y++)a[y]==="/"&&d.push(y);if(d.length<2)continue;let m="",f="",v="";for(let y=d.length-2;y>=0;y--){let B=d[y],G=d[y+1];f=a.substring(B+1,G);let fe=f.split(",");if(fe.length===4&&fe.every(Ve=>!Number.isNaN(parseFloat(Ve)))){v=a.substring(0,B),m=a.substring(G+1);break}}if(!v||!v||!f)continue;let x=`${v}|${f}|${m??""}`;if(i.has(x))continue;i.add(x);let T=decodeURIComponent(v);if(T==="canvas"){let[y,B,G]=f.split(",").map(parseFloat);Number.isNaN(y)||(o=y),Number.isNaN(B)||(r=B),Number.isNaN(G)||(s=Math.max(this.minZoom,Math.min(this.maxZoom,G)));continue}let[z,H,R,q]=f.split(",").map(parseFloat);if([z,H,R,q].some(y=>Number.isNaN(y)))continue;let $=this.parseFlags(m),de=$.get("ratio")??1,ue=typeof de=="number"?de:parseFloat(String(de)),ge=Number.isNaN(ue)?1:ue,K=$.get("type")??"image",Te=$.get("mode")??"image",ze=$.get("og")?decodeURIComponent(String($.get("og"))):void 0,me=this.baseSize*R,He=me*ge,W=this.resolveContent(T,K);if(!W)if(K==="image")W=this.transparentPixel;else continue;n.push({id:this.generateId(),type:K,x:z,y:H,width:me,height:He,rotation:q,content:W,sourceRef:T,originalAspectRatio:ge,safeUrl:K==="iframe"&&this.isValidUrl(W)?this.sanitizer.bypassSecurityTrustResourceUrl(W):void 0,ogImage:ze,displayMode:Te})}this.viewportX.set(o),this.viewportY.set(r),this.zoom.set(s),this.objects.set(n),this.selectedObjectId.set(null),this.lastSerializedHash=e.startsWith("#")?e:`#${e}`;try{sessionStorage.setItem("canvasLastHash",this.lastSerializedHash)}catch{}!this.restoredFromHash&&n.length>0&&this.fitOnceAfterLoad();for(let a of n)a.type==="iframe"&&!a.ogImage&&this.isValidUrl(a.content)&&this.fetchOgImage(a.content,a.id)}resolveContent(e,t){if(e.startsWith("token:")){let i=e.substring(6);return this.readDataToken(i)??null}let n=this.readFileContent(e);return n||(t==="iframe"?this.isValidUrl(e)?e:null:e.startsWith("http://")||e.startsWith("https://")?e:null)}parseFlags(e){let t=new Map;if(!e)return t;for(let n of e.split(",")){let i=n.indexOf(":");if(i<=0)continue;let o=n.substring(0,i),r=n.substring(i+1);if(!o||r===void 0)continue;let s=parseFloat(r);t.set(o,Number.isNaN(s)?r:s)}return t}deriveSourceRef(e,t){if(!O(this.platformId))return e;if(e.startsWith("data:")){if(t){let i=this.makeFileKey(t);try{return localStorage.setItem(i,e),t}catch{}}return this.createDataToken(e)}return t??e}roundNumber(e){return Math.round(e*1e3)/1e3}createDataToken(e){let t=`${this.dataTokenPrefix}${Date.now()}-${Math.random().toString(36).slice(2,8)}`;try{localStorage.setItem(t,e)}catch{this.ephemeralTokens.set(t,e)}return`token:${t}`}readDataToken(e){try{let t=localStorage.getItem(e);if(t)return t}catch{}return this.ephemeralTokens.get(e)??null}makeFileKey(e){return`${this.dataFilePrefix}${e}`}readFileContent(e){let t=this.makeFileKey(e);try{return localStorage.getItem(t)}catch{return null}}generateId(){return"obj-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}cleanupObjectStorage(e){if(e.sourceRef&&!e.sourceRef.startsWith("token:")&&!e.sourceRef.startsWith("http")){let t=this.makeFileKey(e.sourceRef);try{localStorage.removeItem(t)}catch{}}else if(e.sourceRef?.startsWith("token:")){let t=e.sourceRef.substring(6);try{localStorage.removeItem(t)}catch{}this.ephemeralTokens.delete(t)}}cleanupOrphanedStorage(){if(O(this.platformId))try{let e=new Set;for(let n of this.objects())e.add(n.sourceRef);let t=[];for(let n=0;n<localStorage.length;n++){let i=localStorage.key(n);if(i){if(i.startsWith(this.dataTokenPrefix)){let o=`token:${i}`;e.has(o)||t.push(i)}else if(i.startsWith(this.dataFilePrefix)){let o=i.substring(this.dataFilePrefix.length);e.has(o)||t.push(i)}}}if(t.length>0)for(let n of t)localStorage.removeItem(n)}catch{}}async renderCompositionToBlob(){if(!O(this.platformId)||this.objects().length===0)return null;try{let e=this.calculateCompositionBounds();if(!e)return null;let t=1080,n=8,i=document.createElement("canvas");i.width=t,i.height=t;let o=i.getContext("2d");if(!o)return null;let r=t-2*n,s=r/e.width,a=r/e.height,d=Math.min(s,a),m=e.width*d,f=e.height*d,v=(t-m)/2,x=(t-f)/2;return await this.renderObjectsToCanvas(o,e,d,v,x),await new Promise(z=>{i.toBlob(z,"image/png")})}catch(e){return console.error("Error rendering composition:",e),null}}async shareComposition(){try{let e=await this.renderCompositionToBlob();if(!e)return;let t=navigator.canShare?.({files:[new File([],"probe",{type:"image/png"})]})??!1;if(navigator.share&&t){console.log("[Canvas] Share API available & canShare files, creating file...");let s={files:[new File([e],"composition.png",{type:"image/png"})]};console.log("[Canvas] Attempting to share with data:",s);try{await navigator.share(s),console.log("[Canvas] Share successful"),this.shareMenuOpen.set(!1);return}catch(a){let d=a instanceof Error?a.message:String(a);console.warn("[Canvas] Share failed, falling back:",d)}}else console.log("[Canvas] Share API not available or cannot share files; falling back to download");let n=URL.createObjectURL(e),i=document.createElement("a");i.href=n;let o=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);i.download=`composition-${o}.png`,i.click(),URL.revokeObjectURL(n),this.shareMenuOpen.set(!1)}catch(e){console.error("Error sharing composition:",e),this.shareMenuOpen.set(!1)}}async downloadImage(){try{let e=await this.renderCompositionToBlob();if(!e)return;if(this.isMobile()&&navigator.share){let r={files:[new File([e],"composition.png",{type:"image/png"})],title:"Composition"};try{await navigator.share(r);return}catch(s){console.log("Share cancelled or failed:",s)}}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let i=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);n.download=`composition-${i}.png`,n.click(),URL.revokeObjectURL(t)}catch(e){console.error("Error downloading image:",e)}}async shareImage(){try{console.log("[Canvas] shareImage() called");let e=await this.renderCompositionToBlob();if(!e){console.error("[Canvas] No blob generated");return}console.log("[Canvas] Blob created, size:",e.size);let t=navigator.canShare?.({files:[new File([],"probe",{type:"image/png"})]})??!1;if(navigator.share&&t)try{console.log("[Canvas] navigator.share available and canShare files, attempting to share blob directly");let i=new File([e],"composition.png",{type:"image/png"});await navigator.share({files:[i],title:"My Composition"}),console.log("[Canvas] Share successful");return}catch(i){let o=i;console.warn("[Canvas] Direct share failed (falling back):",o?.name,o?.message)}else console.log("[Canvas] navigator.share not available or cannot share files; falling back");let n=URL.createObjectURL(e);if(console.log("[Canvas] Created blob URL:",n),window.parent!==window)console.log("[Canvas] In iframe, sending to parent for share handling"),window.parent.postMessage({type:"shareImage",blobUrl:n,filename:"composition.png"},"*");else{console.log("[Canvas] Not in iframe, downloading directly");let i=document.createElement("a");i.href=n;let o=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);i.download=`composition-${o}.png`,i.click(),URL.revokeObjectURL(n)}}catch(e){console.error("[Canvas] Error in shareImage:",e)}}calculateCompositionBounds(){let e=this.objects();if(e.length===0)return null;let t=1/0,n=1/0,i=-1/0,o=-1/0;for(let r of e){let s=this.getObjectCorners(r);for(let a of s)t=Math.min(t,a.x),n=Math.min(n,a.y),i=Math.max(i,a.x),o=Math.max(o,a.y)}return{x:t,y:n,width:i-t,height:o-n}}getObjectCorners(e){let t=e.x+e.width/2,n=e.y+e.height/2,i=e.rotation*Math.PI/180,o=Math.cos(i),r=Math.sin(i);return[{x:-e.width/2,y:-e.height/2},{x:e.width/2,y:-e.height/2},{x:e.width/2,y:e.height/2},{x:-e.width/2,y:e.height/2}].map(a=>({x:t+a.x*o-a.y*r,y:n+a.x*r+a.y*o}))}async renderObjectsToCanvas(e,t,n,i,o){for(let r of this.objects()){e.save();let s=r.x-t.x,a=r.y-t.y,d=i+(s+r.width/2)*n,m=o+(a+r.height/2)*n;e.translate(d,m),e.rotate(r.rotation*Math.PI/180);let f=r.width*n,v=r.height*n;if(r.type==="image")try{let x=await this.loadImage(r.content);e.drawImage(x,-f/2,-v/2,f,v)}catch(x){console.warn("Failed to load image:",x),e.fillStyle="#ddd",e.fillRect(-f/2,-v/2,f,v)}else if(r.type==="iframe")if(r.ogImage&&r.displayMode!=="iframe")try{let x=await this.loadImage(r.ogImage);e.drawImage(x,-f/2,-v/2,f,v)}catch(x){console.warn("Failed to load og:image:",x),e.fillStyle="#ddd",e.fillRect(-f/2,-v/2,f,v)}else e.fillStyle="#fff",e.strokeStyle="#007bff",e.lineWidth=2,e.fillRect(-f/2,-v/2,f,v),e.strokeRect(-f/2,-v/2,f,v),e.fillStyle="#333",e.font=`${Math.max(12,v*.1)}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText("Web Content",0,0);e.restore()}}loadImage(e){return new Promise((t,n)=>{let i=new Image;(e.startsWith("http://")||e.startsWith("https://"))&&(i.crossOrigin="anonymous"),i.onload=()=>t(i),i.onerror=()=>n(new Error("Failed to load image")),i.src=e})}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=Y({type:l,selectors:[["app-canvas"]],decls:52,vars:9,consts:[["fileInput",""],["urlInput",""],[1,"canvas-container",3,"click","mousedown","touchstart","drop","dragover"],[1,"dot-grid",3,"ngStyle"],[1,"canvas-objects",3,"ngStyle"],[1,"canvas-object",3,"selected","ngStyle"],[1,"close-button-container"],[1,"shuffle-button-container"],["title","Shuffle image",1,"shuffle-button",3,"click","disabled"],["width","20","height","20","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M18 14L22 18L18 22M18 2L22 6L18 10","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M2 18.0001H3.973C4.61949 18.0045 5.25742 17.8522 5.83215 17.5561C6.40687 17.26 6.90127 16.829 7.273 16.3001L12.727 7.7001C13.0987 7.17114 13.5931 6.74018 14.1679 6.44411C14.7426 6.14803 15.3805 5.99568 16.027 6.0001H22M2 6.0001H3.972C4.71746 5.99491 5.44954 6.19814 6.08564 6.58687C6.72174 6.9756 7.23655 7.53436 7.572 8.2001M22 18.0001H15.959C15.3036 17.9934 14.6598 17.8258 14.0844 17.5119C13.509 17.198 13.0195 16.7475 12.659 16.2001L12.3 15.7501","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"zoom-controls"],[1,"zoom-counter"],["title","Fit to view",1,"zoom-reset",3,"click"],["width","16","height","16","viewBox","0 0 16 16","fill","currentColor"],["d","M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z"],[1,"canvas-instructions"],[1,"url-modal-overlay"],[3,"appChanged","selectedAppIndex"],[1,"share-menu-container"],[1,"share-menu"],["title","Copy link",1,"share-button","copy",3,"click","disabled"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M9.16854 14.8294L14.8255 9.17245M7.04654 11.2934L5.63254 12.7074C5.2611 13.0789 4.96645 13.5199 4.76543 14.0052C4.5644 14.4905 4.46094 15.0106 4.46094 15.5359C4.46094 16.0612 4.5644 16.5814 4.76543 17.0667C4.96645 17.552 5.2611 17.993 5.63254 18.3644C6.00398 18.7359 6.44495 19.0305 6.93027 19.2316C7.41558 19.4326 7.93574 19.536 8.46104 19.536C8.98634 19.536 9.5065 19.4326 9.99181 19.2316C10.4771 19.0305 10.9181 18.7359 11.2895 18.3644L12.7015 16.9504M11.2885 7.05045L12.7025 5.63645C13.074 5.265 13.515 4.97036 14.0003 4.76933C14.4856 4.56831 15.0057 4.46484 15.531 4.46484C16.0563 4.46484 16.5765 4.56831 17.0618 4.76933C17.5471 4.97036 17.9881 5.265 18.3595 5.63645C18.731 6.00789 19.0256 6.44886 19.2267 6.93417C19.4277 7.41949 19.5311 7.93965 19.5311 8.46495C19.5311 8.99025 19.4277 9.51041 19.2267 9.99572C19.0256 10.481 18.731 10.922 18.3595 11.2934L16.9455 12.7074","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["title","Share to...",1,"share-button","upload",3,"click"],["clip-path","url(#clip0_2892_191191)"],["d","M12 5V13.5M15 7L12 4L9 7M5 12V17C5 17.5304 5.21071 18.0391 5.58579 18.4142C5.96086 18.7893 6.46957 19 7 19H17C17.5304 19 18.0391 18.7893 18.4142 18.4142C18.7893 18.0391 19 17.5304 19 17V12","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["id","clip0_2892_191191"],["width","24","height","24","fill","white"],["title","Download",1,"share-button","download",3,"click"],["clip-path","url(#clip0_2892_191188)"],["d","M12 5V13.5M12 13.5L15 10.5M12 13.5L9 10.5M5 15V17C5 17.5304 5.21071 18.0391 5.58579 18.4142C5.96086 18.7893 6.46957 19 7 19H17C17.5304 19 18.0391 18.7893 18.4142 18.4142C18.7893 18.0391 19 17.5304 19 17V15","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["id","clip0_2892_191188"],["title","Share on WhatsApp",1,"share-button","whatsapp",3,"click"],["clip-path","url(#clip0_2892_191183)"],["d","M22.375 12.0195C22.375 17.5425 17.898 22.0195 12.375 22.0195C10.6195 22.022 8.89463 21.5604 7.375 20.6815L2.375 21.5195L3.207 16.0195C2.65735 14.7577 2.3741 13.3959 2.375 12.0195C2.375 6.49653 6.852 2.01953 12.375 2.01953C17.898 2.01953 22.375 6.49653 22.375 12.0195Z","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["d","M13.3354 13.8875L15.4154 13.4815L17.3754 14.2345V16.0575C17.3754 16.6645 16.8534 17.1275 16.2654 16.9975C14.7424 16.6635 11.9754 15.8235 10.0534 13.8875C8.22337 12.0445 7.59837 9.47753 7.38537 8.06053C7.30037 7.49353 7.74937 7.01953 8.31837 7.01953H10.2124L10.9474 8.98853L10.5584 11.0895","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["id","clip0_2892_191183"],["title","Share on Instagram",1,"share-button","instagram",3,"click"],["viewBox","0 0 24 24","fill","currentColor"],["d","M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.057-1.645.069-4.849.069-3.204 0-3.584-.012-4.849-.069-3.259-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1 1 12.324 0 6.162 6.162 0 0 1-12.324 0zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm4.965-10.322a1.44 1.44 0 1 1 2.881.001 1.44 1.44 0 0 1-2.881-.001z"],[1,"canvas-object",3,"click","mousedown","touchstart","ngStyle"],[1,"hover-border",3,"ngStyle"],[1,"empty-frame-button"],["alt","Canvas image",1,"object-content",3,"src"],["alt","URL preview",1,"object-content",3,"src"],[1,"iframe-wrapper"],[1,"empty-frame-button",3,"click","touchstart"],[1,"plus-icon-center"],["type","file","accept","image/*","hidden","",3,"change"],["alt","Canvas image",1,"object-content",3,"load","src"],["alt","URL preview",1,"object-content",3,"load","src"],[1,"iframe-wrapper",3,"mouseenter","mouseleave"],["sandbox","allow-scripts allow-forms",1,"object-content",3,"load","src"],[1,"iframe-overlay"],[1,"iframe-overlay",3,"click"],[1,"iframe-overlay-message"],[1,"display-mode-toggle",3,"ngStyle"],[1,"selection-border",3,"ngStyle"],[1,"handle","handle-corner","handle-nw",3,"mousedown","touchstart","ngStyle"],[1,"handle","handle-corner","handle-ne",3,"mousedown","touchstart","ngStyle"],[1,"handle","handle-corner","handle-sw",3,"mousedown","touchstart","ngStyle"],[1,"handle","handle-corner","handle-se",3,"mousedown","touchstart","ngStyle"],[1,"handle","handle-edge","handle-w",3,"mousedown","touchstart","ngStyle"],[1,"handle","handle-edge","handle-e",3,"mousedown","touchstart","ngStyle"],[1,"handle","handle-edge","handle-n",3,"mousedown","touchstart","ngStyle"],[1,"handle","handle-edge","handle-s",3,"mousedown","touchstart","ngStyle"],[1,"rotation-indicator","rotation-nw",3,"mousedown","touchstart","ngStyle"],[1,"rotation-indicator","rotation-ne",3,"mousedown","touchstart","ngStyle"],[1,"rotation-indicator","rotation-sw",3,"mousedown","touchstart","ngStyle"],[1,"rotation-indicator","rotation-se",3,"mousedown","touchstart","ngStyle"],["title","Show as image",1,"toggle-btn",3,"click"],["d","M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"],["d","M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"],["title","Show as website",1,"toggle-btn",3,"click"],["d","M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"],["title","Return to URL wrapper",1,"close-button",3,"click"],["width","20","height","20","viewBox","0 0 20 20","fill","currentColor"],["d","M15 10l-1.5-1.5L9 13V3H7v10L2.5 8.5 1 10l6 6z"],[1,"url-modal-overlay",3,"click"],[1,"url-modal",3,"click"],["type","url","placeholder","Paste URL here...",1,"url-input",3,"input","keydown.enter","keydown.escape","value"],[1,"url-modal-actions"],[1,"url-cancel",3,"click"],[1,"url-submit",3,"click"]],template:function(t,n){t&1&&(h(0,"div",2),_("click",function(o){return n.onCanvasClick(o)})("mousedown",function(o){return n.onCanvasMouseDown(o)})("touchstart",function(o){return n.onCanvasTouchStart(o)})("drop",function(o){return n.onDrop(o)})("dragover",function(o){return n.onDragOver(o)}),w(1,"div",3),h(2,"div",4),ee(3,it,7,6,"div",5,Ze),p(),V(5,ot,4,0,"div",6),h(6,"div",7)(7,"button",8),_("click",function(){return n.shuffleImage()}),S(),h(8,"svg",9),w(9,"path",10)(10,"path",11),p()()(),X(),h(11,"div",12)(12,"div",13),I(13),p(),h(14,"button",14),_("click",function(){return n.fitToView()}),S(),h(15,"svg",15),w(16,"path",16),p()()(),X(),h(17,"div",17)(18,"p"),I(19),p()(),V(20,rt,11,1,"div",18),h(21,"app-canvas-carousel",19),_("appChanged",function(o){return n.onAppChange(o)}),p()(),h(22,"div",20)(23,"div",21)(24,"button",22),_("click",function(){return n.shareVia("copy")}),S(),h(25,"svg",23),w(26,"path",24),p()(),X(),h(27,"button",25),_("click",function(){return n.shareVia("upload")}),S(),h(28,"svg",23)(29,"g",26),w(30,"path",27),p(),h(31,"defs")(32,"clipPath",28),w(33,"rect",29),p()()()(),X(),h(34,"button",30),_("click",function(){return n.shareVia("download")}),S(),h(35,"svg",23)(36,"g",31),w(37,"path",32),p(),h(38,"defs")(39,"clipPath",33),w(40,"rect",29),p()()()(),X(),h(41,"button",34),_("click",function(){return n.shareVia("whatsapp")}),S(),h(42,"svg",23)(43,"g",35),w(44,"path",36)(45,"path",37),p(),h(46,"defs")(47,"clipPath",38),w(48,"rect",29),p()()()(),X(),h(49,"button",39),_("click",function(){return n.shareVia("instagram")}),S(),h(50,"svg",40),w(51,"path",41),p()()()()),t&2&&(b(),C("ngStyle",n.getDotGridStyle()),b(),C("ngStyle",n.getCanvasObjectsStyle()),b(),te(n.objects()),b(2),E(n.cameFromUrlWrapper()?5:-1),b(2),C("disabled",n.isShuffling()),b(6),Me("",n.zoomPercentage(),"%"),b(6),ie(n.instructionsText()),b(),E(n.showUrlModal()?20:-1),b(),C("selectedAppIndex",n.selectedAppIndex()),b(3),C("disabled",n.hasCustomData()))},dependencies:[ae,re,ce],styles:['[_nghost-%COMP%]{display:block;width:100%;height:100%}@keyframes _ngcontent-%COMP%_fadeOutInstructions{0%{opacity:1;visibility:visible}to{opacity:0;visibility:hidden}}@keyframes _ngcontent-%COMP%_fadeInZoom{0%{opacity:0;visibility:hidden}to{opacity:1;visibility:visible}}.canvas-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;overflow:hidden;background-color:#121212;cursor:grab}.canvas-container[_ngcontent-%COMP%]:active{cursor:grabbing}.dot-grid[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(circle,rgba(255,255,255,.2) 1px,transparent 1px);background-size:20px 20px;background-position:0 0;pointer-events:none;z-index:1;transition:opacity .3s ease-in-out}.canvas-objects[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;pointer-events:none}.canvas-object[_ngcontent-%COMP%]{position:absolute;box-sizing:border-box;cursor:move;-webkit-user-select:none;user-select:none;pointer-events:auto}.canvas-object.selected[_ngcontent-%COMP%]   .selection-border[_ngcontent-%COMP%]{display:block}.canvas-object[_ngcontent-%COMP%]   .object-content[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain;pointer-events:none;display:block;border:none;position:relative;z-index:1}.canvas-object[_ngcontent-%COMP%]   .iframe-wrapper[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}.canvas-object[_ngcontent-%COMP%]   .empty-frame-button[_ngcontent-%COMP%]{width:100%;height:100%;background:#fff;border:8px solid white;box-shadow:0 4px 12px #00000026;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;position:relative;box-sizing:border-box}.canvas-object[_ngcontent-%COMP%]   .empty-frame-button[_ngcontent-%COMP%]:hover{box-shadow:0 6px 16px #0003}.canvas-object[_ngcontent-%COMP%]   .empty-frame-button[_ngcontent-%COMP%]:active{transform:scale(.98)}.canvas-object[_ngcontent-%COMP%]   .plus-icon-center[_ngcontent-%COMP%]{font-size:80px;color:#ccc;line-height:1;font-weight:300;-webkit-user-select:none;user-select:none;pointer-events:none}.canvas-object[_ngcontent-%COMP%]   iframe.object-content[_ngcontent-%COMP%]{overflow:hidden;scrollbar-width:none;transition:opacity .2s ease-in-out}.canvas-object[_ngcontent-%COMP%]   iframe.object-content.dimmed[_ngcontent-%COMP%]{opacity:.4}.canvas-object[_ngcontent-%COMP%]   iframe.object-content.interactive[_ngcontent-%COMP%]{pointer-events:auto;opacity:1;overflow:auto!important;scrollbar-width:auto}.canvas-object[_ngcontent-%COMP%]   iframe.object-content[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.canvas-object[_ngcontent-%COMP%]   iframe.object-content.interactive[_ngcontent-%COMP%]::-webkit-scrollbar{display:block;width:12px;height:12px}.canvas-object[_ngcontent-%COMP%]   iframe.object-content.interactive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#0000004d;border-radius:6px}.canvas-object[_ngcontent-%COMP%]   iframe.object-content.interactive[_ngcontent-%COMP%]::-webkit-scrollbar-track{background-color:#0000001a}.canvas-object[_ngcontent-%COMP%]   .iframe-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#00000059;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:1;pointer-events:auto}.canvas-object[_ngcontent-%COMP%]   .iframe-overlay[_ngcontent-%COMP%]   .iframe-overlay-message[_ngcontent-%COMP%]{background-color:#1e1e1ef2;color:#f0f0f0;padding:12px 24px;border-radius:8px;font-size:16px;font-weight:600;box-shadow:0 2px 12px #0006;-webkit-user-select:none;user-select:none;transition:transform .1s ease}.canvas-object[_ngcontent-%COMP%]   .iframe-overlay[_ngcontent-%COMP%]   .iframe-overlay-message[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.canvas-object[_ngcontent-%COMP%]   .selection-border[_ngcontent-%COMP%]{display:none;position:absolute;top:0;left:0;width:100%;height:100%;border-style:solid;border-color:#007bff;border-width:calc(1px * var(--inverse-scale, 1));box-sizing:border-box;pointer-events:none;transform-origin:0 0}.canvas-object[_ngcontent-%COMP%]:hover   .selection-border[_ngcontent-%COMP%]{border-width:calc(3px * var(--inverse-scale, 1))}.canvas-object[_ngcontent-%COMP%]   .hover-border[_ngcontent-%COMP%]{display:none;position:absolute;top:0;left:0;width:100%;height:100%;border-style:solid;border-color:#007bff;border-width:calc(1px * var(--inverse-scale, 1));box-sizing:border-box;pointer-events:none;transform-origin:0 0}.canvas-object[_ngcontent-%COMP%]:hover   .hover-border[_ngcontent-%COMP%]{display:block}.canvas-object[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{position:absolute;pointer-events:all;z-index:15;-webkit-user-select:none;user-select:none;transform-origin:center}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner[_ngcontent-%COMP%]{width:12px;height:12px;background-color:#007bff;border:1px solid white;box-sizing:border-box}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-nw[_ngcontent-%COMP%]{top:-6px;left:-6px;cursor:nwse-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-ne[_ngcontent-%COMP%]{top:-6px;right:-6px;cursor:nesw-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-sw[_ngcontent-%COMP%]{bottom:-6px;left:-6px;cursor:nesw-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-se[_ngcontent-%COMP%]{bottom:-6px;right:-6px;cursor:nwse-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner[_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:scale(1.3)}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge[_ngcontent-%COMP%]{background-color:transparent;border:none}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-w[_ngcontent-%COMP%]{top:0;left:-4px;width:8px;height:100%;cursor:w-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-e[_ngcontent-%COMP%]{top:0;right:-4px;width:8px;height:100%;cursor:e-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-n[_ngcontent-%COMP%]{top:-4px;left:0;width:100%;height:8px;cursor:n-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-s[_ngcontent-%COMP%]{bottom:-4px;left:0;width:100%;height:8px;cursor:s-resize}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]{position:absolute;transform-origin:center;width:20px;height:20px;pointer-events:all;z-index:15;cursor:grab}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:hover{cursor:grab}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:active{cursor:grabbing}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:before{content:"";position:absolute;width:4px;height:4px;background-color:#28a745;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%)}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-nw[_ngcontent-%COMP%]{top:-30px;left:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-ne[_ngcontent-%COMP%]{top:-30px;right:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-sw[_ngcontent-%COMP%]{bottom:-30px;left:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-se[_ngcontent-%COMP%]{bottom:-30px;right:-30px}.canvas-object[_ngcontent-%COMP%]   .display-mode-toggle[_ngcontent-%COMP%]{position:absolute;top:-50px;left:50%;transform:translate(-50%);transform-origin:center;display:flex;gap:4px;background-color:#1e1e1ef2;padding:4px;border-radius:6px;box-shadow:0 2px 8px #0006;pointer-events:all;z-index:20}.canvas-object[_ngcontent-%COMP%]   .display-mode-toggle[_ngcontent-%COMP%]   .toggle-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background-color:#1f1f1f;border:1px solid #3a3a3a;border-radius:4px;cursor:pointer;transition:all .2s;color:#cfcfcf;padding:0}.canvas-object[_ngcontent-%COMP%]   .display-mode-toggle[_ngcontent-%COMP%]   .toggle-btn[_ngcontent-%COMP%]:hover{background-color:#2a2a2a;border-color:#5a5a5a;color:#fff}.canvas-object[_ngcontent-%COMP%]   .display-mode-toggle[_ngcontent-%COMP%]   .toggle-btn.active[_ngcontent-%COMP%]{background-color:#007bff;border-color:#007bff;color:#fff}.canvas-object[_ngcontent-%COMP%]   .display-mode-toggle[_ngcontent-%COMP%]   .toggle-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.canvas-instructions[_ngcontent-%COMP%]{position:absolute;top:20px;left:50%;transform:translate(-50%);background-color:#141414e6;padding:12px 24px;border-radius:8px;box-shadow:0 2px 8px #0006;z-index:100;pointer-events:none;animation:_ngcontent-%COMP%_fadeOutInstructions .5s ease-out 3s forwards}.canvas-instructions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#e6e6e6;font-size:14px;font-weight:500}.url-modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000000b3;z-index:200;display:flex;align-items:center;justify-content:center;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.url-modal[_ngcontent-%COMP%]{background-color:#1e1e1efa;border:1px solid rgba(255,255,255,.2);border-radius:12px;padding:24px;max-width:500px;width:calc(100% - 40px);box-shadow:0 4px 20px #00000080}.url-modal[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;color:#fff;font-size:18px;font-weight:600}.url-input[_ngcontent-%COMP%]{width:100%;padding:12px 16px;background-color:#0006;border:1px solid rgba(255,255,255,.2);border-radius:8px;color:#fff;font-size:14px;outline:none;transition:all .2s;box-sizing:border-box;-webkit-text-fill-color:#fff;background-clip:padding-box}.url-input[_ngcontent-%COMP%]::placeholder{color:#999}.url-input[_ngcontent-%COMP%]:focus{border-color:#fff6;background-color:#0009}.url-modal-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:20px;justify-content:flex-end}.url-modal-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;border:none;transition:all .2s}.url-cancel[_ngcontent-%COMP%]{background-color:#ffffff1a;color:#fff;border:1px solid rgba(255,255,255,.2)}.url-cancel[_ngcontent-%COMP%]:hover{background-color:#fff3}.url-submit[_ngcontent-%COMP%]{background-color:#ffffff26;color:#fff;border:1px solid rgba(255,255,255,.25)}.url-submit[_ngcontent-%COMP%]:hover{background-color:#ffffff40;border-color:#fff6}.close-button-container[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:20px;z-index:100;pointer-events:auto}.shuffle-button-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;z-index:100;pointer-events:auto}.shuffle-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:48px;height:48px;padding:0;background-color:#141414f2;color:#e6e6e6;border:1px solid rgba(255,255,255,.1);border-radius:8px;cursor:pointer;box-shadow:0 2px 12px #00000080;transition:all .2s ease;animation:_ngcontent-%COMP%_fadeInZoom .5s ease-in 3s forwards}.shuffle-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.shuffle-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#1e1e1efa;border-color:#fff3;box-shadow:0 4px 16px #0009}.shuffle-button[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.95)}.shuffle-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.close-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:48px;height:48px;padding:0;background-color:#141414f2;color:#e6e6e6;border:1px solid rgba(255,255,255,.1);border-radius:8px;cursor:pointer;box-shadow:0 2px 12px #00000080;transition:all .2s ease}.close-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px;transform:rotate(180deg)}.close-button[_ngcontent-%COMP%]:hover{background-color:#1e1e1efa;border-color:#fff3;transform:translate(-2px);box-shadow:0 4px 16px #0009}.close-button[_ngcontent-%COMP%]:active{transform:translate(0);box-shadow:0 2px 8px #0006}.zoom-controls[_ngcontent-%COMP%]{position:absolute;top:8px;left:50%;transform:translate(-50%);display:flex;align-items:center;gap:8px;background-color:#141414f2;padding:8px 16px;border-radius:8px;box-shadow:0 2px 12px #00000080;z-index:100;pointer-events:auto;opacity:0;animation:_ngcontent-%COMP%_fadeInZoom .5s ease-in 3s forwards}.zoom-controls[_ngcontent-%COMP%]   .zoom-counter[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#e6e6e6;min-width:50px;text-align:center}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]{background-color:#000;color:#999;border:none;border-radius:4px;padding:6px 12px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;min-height:28px}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{display:block}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]:hover{background-color:#1a1a1a;color:#ccc}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]:active{background-color:#2a2a2a}.share-controls[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;display:flex;align-items:center;gap:8px;background-color:#141414f2;padding:8px 16px;border-radius:8px;box-shadow:0 2px 12px #00000080;z-index:100;pointer-events:auto}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%], .share-controls[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]{color:#fff;border:none;border-radius:4px;padding:8px 16px;font-size:13px;font-weight:500;cursor:pointer;transition:background-color .2s}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%]:disabled, .share-controls[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed;opacity:.6}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%]{background-color:#007bff}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%]:active:not(:disabled){background-color:#004085}.share-controls[_ngcontent-%COMP%]   .share-menu-container[_ngcontent-%COMP%]{position:relative}.share-controls[_ngcontent-%COMP%]   .share-menu-container[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]{background-color:#28a745}.share-controls[_ngcontent-%COMP%]   .share-menu-container[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838}.share-controls[_ngcontent-%COMP%]   .share-menu-container[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:active:not(:disabled){background-color:#1e7e34}.share-controls[_ngcontent-%COMP%]   .share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]{position:absolute;bottom:100%;right:0;background-color:#1e1e1efa;border:1px solid rgba(255,255,255,.15);border-radius:8px;box-shadow:0 -4px 16px #0009;margin-bottom:8px;min-width:160px;overflow:hidden;z-index:101}.share-controls[_ngcontent-%COMP%]   .share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-menu-item[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;color:#fff;border:none;background:none;padding:12px 16px;font-size:13px;cursor:pointer;transition:background-color .2s}.share-controls[_ngcontent-%COMP%]   .share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-menu-item[_ngcontent-%COMP%]:hover{background-color:#ffffff1a}.share-controls[_ngcontent-%COMP%]   .share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-menu-item[_ngcontent-%COMP%]:active{background-color:#ffffff26}.share-controls[_ngcontent-%COMP%]   .share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-menu-item[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid rgba(255,255,255,.08)}.visually-hidden-input[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.add-fab[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;z-index:110;display:block}.add-fab[_ngcontent-%COMP%]   .add-main[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;background-color:#ffffff26;color:#fff;border:1px solid rgba(255,255,255,.25);box-shadow:0 2px 12px #00000080;cursor:pointer;font-size:24px;display:flex;align-items:center;justify-content:center;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);transition:all .2s}.add-fab[_ngcontent-%COMP%]   .add-main[_ngcontent-%COMP%]:hover{background-color:#ffffff40;border-color:#fff6}.add-fab[_ngcontent-%COMP%]   .add-menu[_ngcontent-%COMP%]{position:absolute;bottom:68px;right:0;background:#1e1e1ef2;border:1px solid rgba(255,255,255,.2);border-radius:8px;box-shadow:0 2px 12px #00000080;padding:8px;display:flex;flex-direction:column;gap:6px;min-width:140px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.add-fab[_ngcontent-%COMP%]   .add-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#ffffff1a;color:#fff;border:1px solid rgba(255,255,255,.2);border-radius:6px;padding:10px 12px;font-size:14px;text-align:left;cursor:pointer;white-space:nowrap;transition:all .2s}.add-fab[_ngcontent-%COMP%]   .add-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#fff3;border-color:#fff6}.share-fab[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:20px;z-index:110;display:block}.share-fab[_ngcontent-%COMP%]   .share-main[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;background-color:#ffffff26;color:#fff;border:1px solid rgba(255,255,255,.25);box-shadow:0 2px 12px #00000080;cursor:pointer;display:flex;align-items:center;justify-content:center;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);transition:all .2s}.share-fab[_ngcontent-%COMP%]   .share-main[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#ffffff40;border-color:#fff6}.share-fab[_ngcontent-%COMP%]   .share-main[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.share-fab[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]{position:absolute;bottom:68px;left:0;background:#5a5a5a;border:1px solid rgba(255,255,255,.2);border-radius:8px;box-shadow:0 2px 12px #00000080;padding:8px;display:flex;flex-direction:column;gap:6px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.share-fab[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#ffffff1a;color:#fff;border:1px solid rgba(255,255,255,.2);border-radius:6px;padding:10px 12px;font-size:14px;text-align:left;cursor:pointer;transition:all .2s}.share-fab[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background:#fff3;border-color:#fff6}.share-fab[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}@media(max-width:768px){.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner[_ngcontent-%COMP%]{width:20px;height:20px}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-nw[_ngcontent-%COMP%]{top:-10px;left:-10px}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-ne[_ngcontent-%COMP%]{top:-10px;right:-10px}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-sw[_ngcontent-%COMP%]{bottom:-10px;left:-10px}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-se[_ngcontent-%COMP%]{bottom:-10px;right:-10px}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-w[_ngcontent-%COMP%], .canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-e[_ngcontent-%COMP%]{width:16px;left:-8px}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-e[_ngcontent-%COMP%]{right:-8px;left:auto}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-n[_ngcontent-%COMP%], .canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-s[_ngcontent-%COMP%]{height:16px;top:-8px}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-s[_ngcontent-%COMP%]{bottom:-8px;top:auto}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]{width:32px;height:32px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:before{width:8px;height:8px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-nw[_ngcontent-%COMP%]{top:-40px;left:-40px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-ne[_ngcontent-%COMP%]{top:-40px;right:-40px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-sw[_ngcontent-%COMP%]{bottom:-40px;left:-40px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-se[_ngcontent-%COMP%]{bottom:-40px;right:-40px}.canvas-object[_ngcontent-%COMP%]   .display-mode-toggle[_ngcontent-%COMP%]{top:-60px;padding:6px;gap:6px}.canvas-object[_ngcontent-%COMP%]   .display-mode-toggle[_ngcontent-%COMP%]   .toggle-btn[_ngcontent-%COMP%]{width:44px;height:44px}.canvas-object[_ngcontent-%COMP%]   .display-mode-toggle[_ngcontent-%COMP%]   .toggle-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.canvas-instructions[_ngcontent-%COMP%]{top:12px;left:12px;right:12px;transform:none;padding:10px 16px}.canvas-instructions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;line-height:1.4;text-align:center}.zoom-controls[_ngcontent-%COMP%]{padding:10px 16px;gap:12px}.zoom-controls[_ngcontent-%COMP%]   .zoom-counter[_ngcontent-%COMP%]{font-size:16px;min-width:60px}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]{padding:10px 16px;font-size:14px;min-height:44px}.share-controls[_ngcontent-%COMP%]{bottom:80px;right:16px;flex-direction:column;padding:10px;gap:8px}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%], .share-controls[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]{padding:12px 20px;font-size:14px;min-height:44px;min-width:100px}.add-fab[_ngcontent-%COMP%], .share-fab[_ngcontent-%COMP%]{display:block}.share-controls[_ngcontent-%COMP%]{display:none}}@media(max-width:375px){.canvas-instructions[_ngcontent-%COMP%]{top:8px;left:8px;right:8px;padding:8px 12px}.canvas-instructions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:11px}.zoom-controls[_ngcontent-%COMP%]{padding:8px 12px}.share-controls[_ngcontent-%COMP%]{bottom:70px;right:12px}}.share-menu-container[_ngcontent-%COMP%]{position:fixed;bottom:0;z-index:999;display:flex;justify-content:left;align-items:center;pointer-events:auto}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]{display:flex;gap:16px;background:#303030;padding:16px 20px;align-items:center;justify-content:center}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;border:none;background:#ffffff1a;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease;padding:0;flex-shrink:0}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:28px;height:28px}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:hover{background:#fff3;transform:scale(1.1)}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:active{transform:scale(.95)}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button.whatsapp[_ngcontent-%COMP%]{background:#25d36633}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button.whatsapp[_ngcontent-%COMP%]:hover:not(:disabled){background:#25d3664d}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:disabled{background:#ffffff0d!important;color:#fff6;cursor:not-allowed;opacity:.5}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:disabled:hover{background:#ffffff0d;transform:none}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:disabled:active{transform:none}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:disabled   svg[_ngcontent-%COMP%]{opacity:.6}@media(max-width:768px){.share-menu-container[_ngcontent-%COMP%]{bottom:0}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]{padding:12px 16px;gap:12px}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]{width:64px;height:64px}.share-menu-container[_ngcontent-%COMP%]   .share-menu[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px}}'],changeDetection:0})};var Ie=class l{title=M("sample-reflect");static \u0275fac=function(t){return new(t||l)};static \u0275cmp=Y({type:l,selectors:[["app-root"]],decls:3,vars:1,consts:[[3,"fullScreen"]],template:function(t,n){t&1&&(h(0,"lib-layout",0),w(1,"app-canvas")(2,"router-outlet"),p()),t&2&&C("fullScreen",!0)},dependencies:[Se,je,le],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"]})};export{Ie as App};
