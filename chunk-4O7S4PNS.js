import{A as j,C as te,D as P,E as ne,F as ie,G as O,I as oe,L as re,N as se,a as M,b as E,c as F,d as w,e as _,g as y,h as L,i as K,j as Z,k as Q,l as g,m as T,n as $,o as U,p as q,q as J,r as d,s as h,t as p,u as S,v as I,w as v,x as l,y as C,z as ee}from"./chunk-EXQZEGQL.js";var he=(b,e)=>e.id;function pe(b,e){if(b&1&&S(0,"img",13),b&2){let t=l().$implicit;d("src",t.content,Z)}}function ge(b,e){if(b&1){let t=I();h(0,"iframe",15),v("load",function(i){w(t);let o=l().$implicit,r=l();return _(r.onIframeLoad(i,o.id))}),p()}if(b&2){let t=l().$implicit;d("src",t.safeUrl||t.content,Q)}}function ue(b,e){if(b&1){let t=I();S(0,"div",16),h(1,"div",17),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"scale-nw"))}),p(),h(2,"div",18),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"scale-ne"))}),p(),h(3,"div",19),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"scale-sw"))}),p(),h(4,"div",20),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"scale-se"))}),p(),h(5,"div",21),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"scale-w"))}),p(),h(6,"div",22),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"scale-e"))}),p(),h(7,"div",23),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"scale-n"))}),p(),h(8,"div",24),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"scale-s"))}),p(),h(9,"div",25),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"rotate-nw"))}),p(),h(10,"div",26),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"rotate-ne"))}),p(),h(11,"div",27),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"rotate-sw"))}),p(),h(12,"div",28),v("mousedown",function(i){w(t);let o=l().$implicit,r=l();return _(r.onHandleMouseDown(i,o.id,"rotate-se"))}),p()}if(b&2){let t=l().$implicit,n=l();d("ngStyle",n.getSelectionBorderStyle()),g(),C("cursor",n.getCursorForHandle(t,"scale-nw")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getCursorForHandle(t,"scale-ne")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getCursorForHandle(t,"scale-sw")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getCursorForHandle(t,"scale-se")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getCursorForHandle(t,"scale-w")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getCursorForHandle(t,"scale-e")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getCursorForHandle(t,"scale-n")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getCursorForHandle(t,"scale-s")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getRotateCursor(t,"nw")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getRotateCursor(t,"ne")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getRotateCursor(t,"sw")),d("ngStyle",n.getInverseScaleStyle(t)),g(),C("cursor",n.getRotateCursor(t,"se")),d("ngStyle",n.getInverseScaleStyle(t))}}function me(b,e){if(b&1){let t=I();h(0,"div",11),v("click",function(i){let o=w(t).$implicit,r=l();return _(r.onObjectClick(i,o.id))})("mousedown",function(i){let o=w(t).$implicit,r=l();return _(r.onObjectMouseDown(i,o.id))}),S(1,"div",12),$(2,pe,1,1,"img",13)(3,ge,1,1,"iframe",14),$(4,ue,13,37),p()}if(b&2){let t=e.$implicit,n=l();ee("selected",n.selectedObjectId()===t.id),d("ngStyle",n.getObjectStyle(t)),g(),d("ngStyle",n.getSelectionBorderStyle()),g(),U(t.type==="image"?2:t.type==="iframe"?3:-1),g(2),U(n.selectedObjectId()===t.id?4:-1)}}var R=class b{platformId=F(K);sanitizer=F(oe);baseSize=200;dataTokenPrefix="data-token-";dataFilePrefix="file-data-";hashUpdateHandle=null;hashThrottleMs=80;lastSerializedHash="";suppressHash=!1;hashDirty=!1;wheelFlushHandle=null;ephemeralTokens=new Map;transparentPixel="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMB/hsrLxkAAAAASUVORK5CYII=";objects=y([]);selectedObjectId=y(null);selectedObject=P(()=>{let e=this.selectedObjectId();return e?this.objects().find(t=>t.id===e):null});viewportX=y(0);viewportY=y(0);zoom=y(1);baseGridSize=20;gridScaleLevels=[.25,.5,1,2,4,8,16];minVisibleGridSize=8;maxVisibleGridSize=50;gridScale=y(1);gridSize=P(()=>this.baseGridSize*this.gridScale());apparentGridSize=P(()=>this.gridSize()*this.zoom());gridOpacity=P(()=>{let e=this.apparentGridSize();return e<this.minVisibleGridSize?Math.max(0,e/this.minVisibleGridSize):e>this.maxVisibleGridSize?Math.max(0,1-(e-this.maxVisibleGridSize)/(this.maxVisibleGridSize*.5)):1});zoomPercentage=P(()=>Math.round(this.zoom()*100));isDragging=!1;isTransforming=!1;isPanningCanvas=!1;dragStartX=0;dragStartY=0;transformStartX=0;transformStartY=0;transformHandle=null;originalObject=null;panStartViewportX=0;panStartViewportY=0;rotateStartAngle=0;rotateStartRotation=0;transformHandles=[{type:"scale-nw",cursor:"nw-resize"},{type:"scale-ne",cursor:"ne-resize"},{type:"scale-sw",cursor:"sw-resize"},{type:"scale-se",cursor:"se-resize"},{type:"scale-w",cursor:"w-resize"},{type:"scale-e",cursor:"e-resize"},{type:"scale-n",cursor:"n-resize"},{type:"scale-s",cursor:"s-resize"},{type:"rotate",cursor:"grab"}];constructor(){O(this.platformId)&&(this.setupEventListeners(),this.applyHashState(window.location.hash),window.addEventListener("hashchange",this.onHashChange),window.addEventListener("keydown",e=>this.onKeyDown(e)),L(()=>{this.viewportX(),this.viewportY(),this.zoom(),this.objects(),this.scheduleHashUpdate()}),L(()=>{let e=this.zoom();this.updateGridScale(e)}))}onHashChange=()=>{O(this.platformId)&&window.location.hash!==this.lastSerializedHash&&(this.applyHashState(window.location.hash),this.lastSerializedHash=window.location.hash)};setupEventListeners(){window.addEventListener("paste",e=>this.onPaste(e)),window.addEventListener("dragover",e=>e.preventDefault()),window.addEventListener("wheel",e=>this.onWheel(e),{passive:!1})}onDrop(e){e.preventDefault(),e.stopPropagation();let t=e.dataTransfer?.files;if(t&&t.length>0){let n=t[0];if(n.type.startsWith("image/")){let i=new FileReader;i.onload=()=>{let o=e.currentTarget,r=o?o.getBoundingClientRect():{left:0,top:0},s=e.clientX-r.left-this.viewportX(),c=e.clientY-r.top-this.viewportY(),a=i.result,u=this.deriveSourceRef(a,n.name),m=new Image;m.onload=()=>{let f=m.naturalHeight/m.naturalWidth||1;this.addObject({id:this.generateId(),type:"image",x:s/this.zoom(),y:c/this.zoom(),width:this.baseSize,height:this.baseSize*f,rotation:0,content:a,sourceRef:u,originalAspectRatio:f})},m.onerror=()=>{this.addObject({id:this.generateId(),type:"image",x:s/this.zoom(),y:c/this.zoom(),width:this.baseSize,height:this.baseSize,rotation:0,content:a,sourceRef:u,originalAspectRatio:1})},m.src=a},i.readAsDataURL(n)}}}onDragOver(e){e.preventDefault(),e.stopPropagation()}onPaste(e){let t=e.clipboardData?.getData("text");if(t&&this.isValidUrl(t)){let n=this.deriveSourceRef(t);this.addObject({id:this.generateId(),type:"iframe",x:(window.innerWidth/2-this.viewportX())/this.zoom(),y:(window.innerHeight/2-this.viewportY())/this.zoom(),width:600,height:400,rotation:0,content:t,sourceRef:n,originalAspectRatio:400/600,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(t)}),e.preventDefault()}}isValidUrl(e){try{return new URL(e),!0}catch{return!1}}addObject(e){this.objects.update(t=>[...t,e]),this.selectedObjectId.set(e.id),this.scheduleHashUpdate()}onKeyDown(e){if(e.key!=="Backspace")return;let t=e.target;if(t&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable))return;let n=this.selectedObjectId();if(!n)return;e.preventDefault(),this.suppressHash=!0;let i=this.objects().find(o=>o.id===n);i&&this.cleanupObjectStorage(i),this.objects.update(o=>o.filter(r=>r.id!==n)),this.selectedObjectId.set(null),this.scheduleHashUpdate()}onObjectClick(e,t){e.stopPropagation(),this.selectedObjectId.set(t)}onCanvasClick(e){let t=e.target,n=t===e.currentTarget||t.classList.contains("dot-grid")||t.classList.contains("canvas-objects");this.hashDirty&&this.scheduleHashUpdate(),n&&this.selectedObjectId.set(null)}onCanvasMouseDown(e){if(e.target===e.currentTarget||e.target.classList.contains("dot-grid")){this.suppressHash=!0,this.selectedObjectId.set(null),this.isPanningCanvas=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.panStartViewportX=this.viewportX(),this.panStartViewportY=this.viewportY();let t=i=>{if(!this.isPanningCanvas)return;let o=i.clientX-this.dragStartX,r=i.clientY-this.dragStartY;this.viewportX.set(this.panStartViewportX+o),this.viewportY.set(this.panStartViewportY+r)},n=()=>{this.isPanningCanvas=!1,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",n)};window.addEventListener("mousemove",t),window.addEventListener("mouseup",n)}}onObjectMouseMove(e,t){}onObjectMouseLeave(e){}updateGridScale(e){let t=this.gridScaleLevels[0],n=1/0;for(let i of this.gridScaleLevels){let o=this.baseGridSize*i*e,r=(this.minVisibleGridSize+this.maxVisibleGridSize)/2,s=Math.abs(o-r);s<n&&(n=s,t=i)}this.gridScale.set(t)}resetZoom(){this.zoom.set(1),this.viewportX.set(0),this.viewportY.set(0)}onWheel(e){e.preventDefault(),this.suppressHash=!0;let n=e.deltaY>0?.9:1.1,i=Math.max(.1,Math.min(5,this.zoom()*n)),o=e.clientX,r=e.clientY,s=(o-this.viewportX())/this.zoom(),c=(r-this.viewportY())/this.zoom();this.zoom.set(i),this.viewportX.set(o-s*i),this.viewportY.set(r-c*i),this.wheelFlushHandle&&window.clearTimeout(this.wheelFlushHandle),this.wheelFlushHandle=window.setTimeout(()=>{this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),this.wheelFlushHandle=null},150)}onObjectMouseDown(e,t){e.preventDefault(),e.stopPropagation();let n=this.objects().find(r=>r.id===t);if(!n)return;this.isDragging=!0,this.suppressHash=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.originalObject=M({},n),this.selectedObjectId.set(t);let i=r=>{if(!this.isDragging||!this.originalObject)return;let s=(r.clientX-this.dragStartX)/this.zoom(),c=(r.clientY-this.dragStartY)/this.zoom();this.objects.update(a=>a.map(u=>u.id===t?E(M({},u),{x:this.originalObject.x+s,y:this.originalObject.y+c}):u))},o=()=>{this.isDragging=!1,this.originalObject=null,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",o)};window.addEventListener("mousemove",i),window.addEventListener("mouseup",o)}onHandleMouseDown(e,t,n){e.preventDefault(),e.stopPropagation();let i=this.objects().find(s=>s.id===t);if(!i)return;this.isTransforming=!0,this.suppressHash=!0,this.transformStartX=e.clientX,this.transformStartY=e.clientY,this.transformHandle=n,this.originalObject=M({},i),this.rotateStartRotation=i.rotation,this.rotateStartAngle=this.getPointerAngle(i,e.clientX,e.clientY);let o=s=>{if(!this.isTransforming||!this.originalObject)return;let c=(s.clientX-this.transformStartX)/this.zoom(),a=(s.clientY-this.transformStartY)/this.zoom();this.transformHandle?.startsWith("rotate-")?this.handleRotate(t,s.clientX,s.clientY):this.transformHandle==="rotate"?this.handleRotate(t,s.clientX,s.clientY):this.transformHandle?.startsWith("scale-")&&this.handleScale(t,c,a,this.transformHandle)},r=()=>{this.isTransforming=!1,this.originalObject=null,this.transformHandle=null,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",r)}handleScale(e,t,n,i){if(!this.originalObject)return;let o=this.originalObject.width,r=this.originalObject.height,s=0,c=0;if(i==="scale-nw"){let a=(-t-n)/2;o=Math.max(50,this.originalObject.width+a),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+a),s=this.originalObject.width-o,c=this.originalObject.height-r}else if(i==="scale-ne"){let a=(t-n)/2;o=Math.max(50,this.originalObject.width+a),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+a),c=this.originalObject.height-r}else if(i==="scale-sw"){let a=(-t+n)/2;o=Math.max(50,this.originalObject.width+a),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+a),s=this.originalObject.width-o}else if(i==="scale-se"){let a=(t+n)/2;o=Math.max(50,this.originalObject.width+a),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+a)}else i==="scale-w"?(o=Math.max(50,this.originalObject.width-t),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:this.originalObject.height,s=this.originalObject.width-o,this.originalObject.type==="image"&&(c=(this.originalObject.height-r)/2)):i==="scale-e"?(o=Math.max(50,this.originalObject.width+t),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:this.originalObject.height,this.originalObject.type==="image"&&(c=(this.originalObject.height-r)/2)):i==="scale-n"?(r=Math.max(50,this.originalObject.height-n),o=this.originalObject.type==="image"?r/this.originalObject.originalAspectRatio:this.originalObject.width,c=this.originalObject.height-r,this.originalObject.type==="image"&&(s=(this.originalObject.width-o)/2)):i==="scale-s"&&(r=Math.max(50,this.originalObject.height+n),o=this.originalObject.type==="image"?r/this.originalObject.originalAspectRatio:this.originalObject.width,this.originalObject.type==="image"&&(s=(this.originalObject.width-o)/2));this.objects.update(a=>a.map(u=>u.id===e?E(M({},u),{width:o,height:r,x:this.originalObject.x+s,y:this.originalObject.y+c}):u))}handleRotate(e,t,n){if(!this.originalObject)return;let i=this.objects().find(a=>a.id===e);if(!i)return;let r=this.getPointerAngle(i,t,n)-this.rotateStartAngle,s=this.rotateStartRotation+r,c=this.snapAngleWithin(s,45,2);this.objects.update(a=>a.map(u=>u.id===e?E(M({},u),{rotation:c}):u))}getPointerAngle(e,t,n){let i=(e.x+e.width/2)*this.zoom()+this.viewportX(),o=(e.y+e.height/2)*this.zoom()+this.viewportY();return Math.atan2(n-o,t-i)*(180/Math.PI)}getObjectStyle(e){return{left:`${e.x}px`,top:`${e.y}px`,width:`${e.width}px`,height:`${e.height}px`,transform:`rotate(${e.rotation}deg)`}}snapAngle(e,t=45){return Math.round(e/t)*t}snapAngleWithin(e,t=45,n=2){let i=Math.round(e/t)*t;return Math.abs(e-i)<=n?i:e}getHandlePosition(e,t){return{"scale-nw":{top:"-5px",left:"-5px"},"scale-ne":{top:"-5px",right:"-5px"},"scale-sw":{bottom:"-5px",left:"-5px"},"scale-se":{bottom:"-5px",right:"-5px"},rotate:{top:"-30px",left:"50%",transform:"translateX(-50%)"}}[t.type]||{}}getCanvasObjectsStyle(){return{transform:`translate(${this.viewportX()}px, ${this.viewportY()}px) scale(${this.zoom()})`,"transform-origin":"0 0"}}getDotGridStyle(){let t=this.gridSize()*this.zoom(),n=this.viewportX()%t,i=this.viewportY()%t;return{"background-size":`${t}px ${t}px`,"background-position":`${n}px ${i}px`,opacity:this.gridOpacity().toString()}}getInverseScaleStyle(e){let t=1/this.zoom();return{transform:`scale(${t})`,"--inverse-scale":t.toString()}}getSelectionBorderStyle(){return{"--inverse-scale":(1/this.zoom()).toString()}}onIframeLoad(e,t){let n=e.target;if(n)try{let i=n.contentDocument||n.contentWindow?.document||null;if(!i)return;i.documentElement&&(i.documentElement.style.overflow="hidden"),i.body&&(i.body.style.overflow="hidden");let o=i.createElement("style");o.textContent="::-webkit-scrollbar{display:none} html,body{overflow:hidden!important}",i.head?.appendChild(o)}catch{}}normalizeAngle180(e){let t=e%180;return t<0&&(t+=180),t}getCursorForHandle(e,t){let n=this.normalizeAngle180(e.rotation),i=n>=45&&n<=135,o=n<45||n>135;if(t.startsWith("scale-"))switch(t){case"scale-nw":case"scale-se":return o?"nwse-resize":"nesw-resize";case"scale-ne":case"scale-sw":return o?"nesw-resize":"nwse-resize";case"scale-w":case"scale-e":return i?"ns-resize":"ew-resize";case"scale-n":case"scale-s":return i?"ew-resize":"ns-resize"}return"move"}buildRotateCursorSvg(e){let t=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<g transform="rotate(${e} 12 12)">
<g clip-path="url(#clip0_325_17)">
<g filter="url(#filter0_d_325_17)">
<path d="M11 6C11.9193 6 12.8295 6.18106 13.6788 6.53284C14.5281 6.88463 15.2997 7.40024 15.9497 8.05025C16.5998 8.70026 17.1154 9.47194 17.4672 10.3212C17.8189 11.1705 18 12.0807 18 13V16H22L16 22L10 16H14V13C14 12.606 13.9224 12.2159 13.7716 11.8519C13.6209 11.488 13.3999 11.1573 13.1213 10.8787C12.8427 10.6001 12.512 10.3791 12.1481 10.2284C11.7841 10.0776 11.394 10 11 10H8V14L2 8L8 2V6H11Z" fill="white"/>
<path d="M11 9H7V11.5L3.5 8L7 4.5L7 7H11C11.7879 7 12.5682 7.15519 13.2961 7.45672C14.0241 7.75825 14.6855 8.20021 15.2426 8.75736C15.7998 9.31451 16.2418 9.97594 16.5433 10.7039C16.8448 11.4319 17 12.2121 17 13V17L19.5 17L16 20.5L12.5 17H15V13C15 12.4747 14.8965 11.9546 14.6955 11.4693C14.4945 10.984 14.1999 10.543 13.8284 10.1716C13.457 9.80014 13.016 9.5055 12.5307 9.30448C12.0454 9.10346 11.5253 9 11 9Z" fill="black"/>
</g>
</g>
<defs>
<filter id="filter0_d_325_17" x="0.2" y="1.2" width="23.6" height="23.6" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
<feOffset dy="1"/>
<feGaussianBlur stdDeviation="0.9"/>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.65 0"/>
<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_325_17"/>
<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_325_17" result="shape"/>
</filter>
<clipPath id="clip0_325_17">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>
</g>
</svg>`;return`url("data:image/svg+xml;utf8,${encodeURIComponent(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}") 12 12, auto`}getRotateCursor(e,t){let i={ne:0,nw:270,sw:180,se:90}[t]+e.rotation;return this.buildRotateCursorSvg(i)}scheduleHashUpdate(){if(O(this.platformId)){if(this.suppressHash){this.hashDirty=!0;return}this.hashUpdateHandle&&window.clearTimeout(this.hashUpdateHandle),this.hashUpdateHandle=window.setTimeout(()=>{let e=this.serializeStateToHash(),t=e?`#${e}`:"";t!==this.lastSerializedHash&&(window.location.hash=t,this.lastSerializedHash=t),this.hashDirty=!1,this.hashUpdateHandle=null},this.hashThrottleMs)}}serializeStateToHash(){let e=[];e.push(this.serializeCanvasSegment());for(let t of this.objects())e.push(this.serializeObjectSegment(t));return e.join("#")}serializeCanvasSegment(){let e=this.roundNumber(this.viewportX()),t=this.roundNumber(this.viewportY()),n=this.roundNumber(this.zoom());return`canvas/${e},${t},${n}`}serializeObjectSegment(e){let t=this.roundNumber(e.x),n=this.roundNumber(e.y),i=this.roundNumber(e.width/this.baseSize),o=this.roundNumber(e.rotation),r=e.width===0?1:e.height/e.width,s=[`type:${e.type}`,`ratio:${this.roundNumber(r)}`];return`${encodeURIComponent(e.sourceRef)}/${t},${n},${i},${o}/${s.join(",")}`}applyHashState(e){if(!O(this.platformId)||!e||e.length<=1)return;let t=e.substring(1).split("#").filter(Boolean);if(t.length===0)return;let n=[],i=this.viewportX(),o=this.viewportY(),r=this.zoom();for(let s of t){let[c,a,u]=s.split("/");if(!c||!a)continue;let m=decodeURIComponent(c);if(m==="canvas"){let[D,B,G]=a.split(",").map(parseFloat);Number.isNaN(D)||(i=D),Number.isNaN(B)||(o=B),Number.isNaN(G)||(r=Math.max(.1,Math.min(5,G)));continue}let[f,x,V,k]=a.split(",").map(parseFloat);if([f,x,V,k].some(D=>Number.isNaN(D)))continue;let X=this.parseFlags(u),A=X.get("ratio")??1,Y=typeof A=="number"?A:parseFloat(String(A)),N=Number.isNaN(Y)?1:Y,H=X.get("type")??"image",W=this.baseSize*V,ce=W*N,z=this.resolveContent(m,H);if(!z)if(H==="image")z=this.transparentPixel;else continue;n.push({id:this.generateId(),type:H,x:f,y:x,width:W,height:ce,rotation:k,content:z,sourceRef:m,originalAspectRatio:N,safeUrl:H==="iframe"&&this.isValidUrl(z)?this.sanitizer.bypassSecurityTrustResourceUrl(z):void 0})}this.viewportX.set(i),this.viewportY.set(o),this.zoom.set(r),this.objects.set(n),this.selectedObjectId.set(null),this.lastSerializedHash=e.startsWith("#")?e:`#${e}`}resolveContent(e,t){if(e.startsWith("token:")){let i=e.substring(6);return this.readDataToken(i)??null}let n=this.readFileContent(e);return n||(t==="iframe"?this.isValidUrl(e)?e:null:e.startsWith("http://")||e.startsWith("https://")?e:null)}parseFlags(e){let t=new Map;if(!e)return t;for(let n of e.split(",")){let[i,o]=n.split(":");if(!i||o===void 0)continue;let r=parseFloat(o);t.set(i,Number.isNaN(r)?o:r)}return t}deriveSourceRef(e,t){if(!O(this.platformId))return e;if(e.startsWith("data:")){if(t){let i=this.makeFileKey(t);try{return localStorage.setItem(i,e),t}catch{}}return this.createDataToken(e)}return t??e}roundNumber(e){return Math.round(e*1e3)/1e3}createDataToken(e){let t=`${this.dataTokenPrefix}${Date.now()}-${Math.random().toString(36).slice(2,8)}`;try{localStorage.setItem(t,e)}catch{this.ephemeralTokens.set(t,e)}return`token:${t}`}readDataToken(e){try{let t=localStorage.getItem(e);if(t)return t}catch{}return this.ephemeralTokens.get(e)??null}makeFileKey(e){return`${this.dataFilePrefix}${e}`}readFileContent(e){let t=this.makeFileKey(e);try{return localStorage.getItem(t)}catch{return null}}generateId(){return"obj-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}cleanupObjectStorage(e){if(e.sourceRef&&!e.sourceRef.startsWith("token:")&&!e.sourceRef.startsWith("http")){let t=this.makeFileKey(e.sourceRef);try{localStorage.removeItem(t)}catch{}}else if(e.sourceRef?.startsWith("token:")){let t=e.sourceRef.substring(6);try{localStorage.removeItem(t)}catch{}this.ephemeralTokens.delete(t)}}async renderCompositionToBlob(){if(!O(this.platformId)||this.objects().length===0)return null;try{let e=this.calculateCompositionBounds();if(!e)return null;let t=1080,n=8,i=document.createElement("canvas");i.width=t,i.height=t;let o=i.getContext("2d");if(!o)return null;let r=t-2*n,s=r/e.width,c=r/e.height,a=Math.min(s,c),u=e.width*a,m=e.height*a,f=(t-u)/2,x=(t-m)/2;return await this.renderObjectsToCanvas(o,e,a,f,x),await new Promise(k=>{i.toBlob(k,"image/png")})}catch(e){return console.error("Error rendering composition:",e),null}}async downloadImage(){try{let e=await this.renderCompositionToBlob();if(!e)return;let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let i=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);n.download=`composition-${i}.png`,n.click(),URL.revokeObjectURL(t)}catch(e){console.error("Error downloading image:",e)}}async shareImage(){try{let e=await this.renderCompositionToBlob();if(!e)return;if(navigator.share&&navigator.canShare){let r={files:[new File([e],"composition.png",{type:"image/png"})],title:"My Composition"};if(navigator.canShare(r)){await navigator.share(r);return}}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let i=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);n.download=`composition-${i}.png`,n.click(),URL.revokeObjectURL(t)}catch(e){console.error("Error sharing image:",e)}}calculateCompositionBounds(){let e=this.objects();if(e.length===0)return null;let t=1/0,n=1/0,i=-1/0,o=-1/0;for(let r of e){let s=this.getObjectCorners(r);for(let c of s)t=Math.min(t,c.x),n=Math.min(n,c.y),i=Math.max(i,c.x),o=Math.max(o,c.y)}return{x:t,y:n,width:i-t,height:o-n}}getObjectCorners(e){let t=e.x+e.width/2,n=e.y+e.height/2,i=e.rotation*Math.PI/180,o=Math.cos(i),r=Math.sin(i);return[{x:-e.width/2,y:-e.height/2},{x:e.width/2,y:-e.height/2},{x:e.width/2,y:e.height/2},{x:-e.width/2,y:e.height/2}].map(c=>({x:t+c.x*o-c.y*r,y:n+c.x*r+c.y*o}))}async renderObjectsToCanvas(e,t,n,i,o){for(let r of this.objects()){e.save();let s=r.x-t.x,c=r.y-t.y,a=i+(s+r.width/2)*n,u=o+(c+r.height/2)*n;e.translate(a,u),e.rotate(r.rotation*Math.PI/180);let m=r.width*n,f=r.height*n;if(r.type==="image")try{let x=await this.loadImage(r.content);e.drawImage(x,-m/2,-f/2,m,f)}catch(x){console.warn("Failed to load image:",x),e.fillStyle="#ddd",e.fillRect(-m/2,-f/2,m,f)}else r.type==="iframe"&&(e.fillStyle="#fff",e.strokeStyle="#007bff",e.lineWidth=2,e.fillRect(-m/2,-f/2,m,f),e.strokeRect(-m/2,-f/2,m,f),e.fillStyle="#333",e.font=`${Math.max(12,f*.1)}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText("Web Content",0,0));e.restore()}}loadImage(e){return new Promise((t,n)=>{let i=new Image;(e.startsWith("http://")||e.startsWith("https://"))&&(i.crossOrigin="anonymous"),i.onload=()=>t(i),i.onerror=()=>n(new Error("Failed to load image")),i.src=e})}static \u0275fac=function(t){return new(t||b)};static \u0275cmp=T({type:b,selectors:[["app-canvas"]],decls:18,vars:5,consts:[[1,"canvas-container",3,"click","mousedown","drop","dragover"],[1,"dot-grid",3,"ngStyle"],[1,"canvas-objects",3,"ngStyle"],[1,"canvas-object",3,"selected","ngStyle"],[1,"zoom-controls"],[1,"zoom-counter"],[1,"zoom-reset",3,"click"],[1,"share-controls"],[1,"download-button",3,"click","disabled"],[1,"share-button",3,"click","disabled"],[1,"canvas-instructions"],[1,"canvas-object",3,"click","mousedown","ngStyle"],[1,"hover-border",3,"ngStyle"],["alt","Canvas image",1,"object-content",3,"src"],["scrolling","no","sandbox","allow-scripts allow-same-origin allow-forms",1,"object-content",3,"src"],["scrolling","no","sandbox","allow-scripts allow-same-origin allow-forms",1,"object-content",3,"load","src"],[1,"selection-border",3,"ngStyle"],[1,"handle","handle-corner","handle-nw",3,"mousedown","ngStyle"],[1,"handle","handle-corner","handle-ne",3,"mousedown","ngStyle"],[1,"handle","handle-corner","handle-sw",3,"mousedown","ngStyle"],[1,"handle","handle-corner","handle-se",3,"mousedown","ngStyle"],[1,"handle","handle-edge","handle-w",3,"mousedown","ngStyle"],[1,"handle","handle-edge","handle-e",3,"mousedown","ngStyle"],[1,"handle","handle-edge","handle-n",3,"mousedown","ngStyle"],[1,"handle","handle-edge","handle-s",3,"mousedown","ngStyle"],[1,"rotation-indicator","rotation-nw",3,"mousedown","ngStyle"],[1,"rotation-indicator","rotation-ne",3,"mousedown","ngStyle"],[1,"rotation-indicator","rotation-sw",3,"mousedown","ngStyle"],[1,"rotation-indicator","rotation-se",3,"mousedown","ngStyle"]],template:function(t,n){t&1&&(h(0,"div",0),v("click",function(o){return n.onCanvasClick(o)})("mousedown",function(o){return n.onCanvasMouseDown(o)})("drop",function(o){return n.onDrop(o)})("dragover",function(o){return n.onDragOver(o)}),S(1,"div",1),h(2,"div",2),q(3,me,5,6,"div",3,he),p(),h(5,"div",4)(6,"div",5),j(7),p(),h(8,"button",6),v("click",function(){return n.resetZoom()}),j(9,"Reset"),p()(),h(10,"div",7)(11,"button",8),v("click",function(){return n.downloadImage()}),j(12," Download "),p(),h(13,"button",9),v("click",function(){return n.shareImage()}),j(14," Share "),p()(),h(15,"div",10)(16,"p"),j(17,"Drag and drop images here \u2022 Paste URLs (Ctrl/Cmd+V) \u2022 Drag canvas to pan \u2022 Scroll to zoom"),p()()()),t&2&&(g(),d("ngStyle",n.getDotGridStyle()),g(),d("ngStyle",n.getCanvasObjectsStyle()),g(),J(n.objects()),g(4),te("",n.zoomPercentage(),"%"),g(4),d("disabled",n.objects().length===0),g(2),d("disabled",n.objects().length===0))},dependencies:[ie,ne],styles:['[_nghost-%COMP%]{display:block;width:100%;height:100%}.canvas-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;overflow:hidden;background-color:#f5f5f5;cursor:grab}.canvas-container[_ngcontent-%COMP%]:active{cursor:grabbing}.dot-grid[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(circle,#ccc 1px,transparent 1px);background-size:20px 20px;background-position:0 0;pointer-events:none;z-index:1;transition:opacity .3s ease-in-out}.canvas-objects[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;pointer-events:none}.canvas-object[_ngcontent-%COMP%]{position:absolute;box-sizing:border-box;cursor:move;-webkit-user-select:none;user-select:none;pointer-events:auto}.canvas-object.selected[_ngcontent-%COMP%]   .selection-border[_ngcontent-%COMP%]{display:block}.canvas-object[_ngcontent-%COMP%]   .object-content[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain;pointer-events:none;display:block;border:none}.canvas-object[_ngcontent-%COMP%]   iframe.object-content[_ngcontent-%COMP%]{overflow:hidden;scrollbar-width:none}.canvas-object[_ngcontent-%COMP%]   iframe.object-content[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.canvas-object[_ngcontent-%COMP%]   .selection-border[_ngcontent-%COMP%]{display:none;position:absolute;top:0;left:0;width:100%;height:100%;border-style:solid;border-color:#007bff;border-width:calc(1px * var(--inverse-scale, 1));box-sizing:border-box;pointer-events:none;transform-origin:0 0}.canvas-object[_ngcontent-%COMP%]:hover   .selection-border[_ngcontent-%COMP%]{border-width:calc(3px * var(--inverse-scale, 1))}.canvas-object[_ngcontent-%COMP%]   .hover-border[_ngcontent-%COMP%]{display:none;position:absolute;top:0;left:0;width:100%;height:100%;border-style:solid;border-color:#007bff;border-width:calc(1px * var(--inverse-scale, 1));box-sizing:border-box;pointer-events:none;transform-origin:0 0}.canvas-object[_ngcontent-%COMP%]:hover   .hover-border[_ngcontent-%COMP%]{display:block}.canvas-object[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{position:absolute;pointer-events:all;z-index:10;-webkit-user-select:none;user-select:none;transform-origin:center}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner[_ngcontent-%COMP%]{width:12px;height:12px;background-color:#007bff;border:1px solid white;box-sizing:border-box}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-nw[_ngcontent-%COMP%]{top:-6px;left:-6px;cursor:nwse-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-ne[_ngcontent-%COMP%]{top:-6px;right:-6px;cursor:nesw-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-sw[_ngcontent-%COMP%]{bottom:-6px;left:-6px;cursor:nesw-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-se[_ngcontent-%COMP%]{bottom:-6px;right:-6px;cursor:nwse-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner[_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:scale(1.3)}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge[_ngcontent-%COMP%]{background-color:transparent;border:none}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-w[_ngcontent-%COMP%]{top:0;left:-4px;width:8px;height:100%;cursor:w-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-e[_ngcontent-%COMP%]{top:0;right:-4px;width:8px;height:100%;cursor:e-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-n[_ngcontent-%COMP%]{top:-4px;left:0;width:100%;height:8px;cursor:n-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-s[_ngcontent-%COMP%]{bottom:-4px;left:0;width:100%;height:8px;cursor:s-resize}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]{position:absolute;transform-origin:center;width:20px;height:20px;pointer-events:all;z-index:10;cursor:grab}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:hover{cursor:grab}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:active{cursor:grabbing}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:before{content:"";position:absolute;width:4px;height:4px;background-color:#28a745;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%)}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-nw[_ngcontent-%COMP%]{top:-30px;left:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-ne[_ngcontent-%COMP%]{top:-30px;right:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-sw[_ngcontent-%COMP%]{bottom:-30px;left:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-se[_ngcontent-%COMP%]{bottom:-30px;right:-30px}.canvas-instructions[_ngcontent-%COMP%]{position:absolute;top:20px;left:50%;transform:translate(-50%);background-color:#ffffffe6;padding:12px 24px;border-radius:8px;box-shadow:0 2px 8px #0000001a;z-index:100;pointer-events:none}.canvas-instructions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#333;font-size:14px;font-weight:500}.zoom-controls[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:50%;transform:translate(-50%);display:flex;align-items:center;gap:8px;background-color:#fffffff2;padding:8px 16px;border-radius:8px;box-shadow:0 2px 12px #00000026;z-index:100;pointer-events:auto}.zoom-controls[_ngcontent-%COMP%]   .zoom-counter[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#333;min-width:50px;text-align:center}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;border-radius:4px;padding:6px 12px;font-size:13px;font-weight:500;cursor:pointer;transition:background-color .2s}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]:hover{background-color:#0056b3}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]:active{background-color:#004085}.share-controls[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;display:flex;align-items:center;gap:8px;background-color:#fffffff2;padding:8px 16px;border-radius:8px;box-shadow:0 2px 12px #00000026;z-index:100;pointer-events:auto}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%], .share-controls[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]{color:#fff;border:none;border-radius:4px;padding:8px 16px;font-size:13px;font-weight:500;cursor:pointer;transition:background-color .2s}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%]:disabled, .share-controls[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed;opacity:.6}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%]{background-color:#007bff}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.share-controls[_ngcontent-%COMP%]   .download-button[_ngcontent-%COMP%]:active:not(:disabled){background-color:#004085}.share-controls[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]{background-color:#28a745}.share-controls[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838}.share-controls[_ngcontent-%COMP%]   .share-button[_ngcontent-%COMP%]:active:not(:disabled){background-color:#1e7e34}'],changeDetection:0})};var ae=class b{title=y("sample-reflect");static \u0275fac=function(t){return new(t||b)};static \u0275cmp=T({type:b,selectors:[["app-root"]],decls:3,vars:1,consts:[[3,"fullScreen"]],template:function(t,n){t&1&&(h(0,"lib-layout",0),S(1,"app-canvas")(2,"router-outlet"),p()),t&2&&d("fullScreen",!0)},dependencies:[re,se,R],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"]})};export{ae as App};
