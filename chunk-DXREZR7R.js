import{A as E,C as te,D as S,E as ne,F as ie,G as O,I as oe,L as re,N as se,a as y,b as H,c as R,d as f,e as b,g as C,h as A,i as K,j as Z,k as Q,l as g,m as D,n as I,o as F,p as q,q as J,r as l,s as d,t as p,u as x,v as k,w as m,x as s,y as w,z as ee}from"./chunk-EXQZEGQL.js";var he=(u,t)=>t.id;function pe(u,t){if(u&1&&x(0,"img",10),u&2){let e=s().$implicit;l("src",e.content,Z)}}function ge(u,t){if(u&1){let e=k();d(0,"iframe",12),m("load",function(i){f(e);let o=s().$implicit,r=s();return b(r.onIframeLoad(i,o.id))}),p()}if(u&2){let e=s().$implicit;l("src",e.safeUrl||e.content,Q)}}function ue(u,t){if(u&1){let e=k();x(0,"div",13),d(1,"div",14),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"scale-nw"))}),p(),d(2,"div",15),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"scale-ne"))}),p(),d(3,"div",16),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"scale-sw"))}),p(),d(4,"div",17),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"scale-se"))}),p(),d(5,"div",18),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"scale-w"))}),p(),d(6,"div",19),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"scale-e"))}),p(),d(7,"div",20),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"scale-n"))}),p(),d(8,"div",21),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"scale-s"))}),p(),d(9,"div",22),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"rotate-nw"))}),p(),d(10,"div",23),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"rotate-ne"))}),p(),d(11,"div",24),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"rotate-sw"))}),p(),d(12,"div",25),m("mousedown",function(i){f(e);let o=s().$implicit,r=s();return b(r.onHandleMouseDown(i,o.id,"rotate-se"))}),p()}if(u&2){let e=s().$implicit,n=s();l("ngStyle",n.getSelectionBorderStyle()),g(),w("cursor",n.getCursorForHandle(e,"scale-nw")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getCursorForHandle(e,"scale-ne")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getCursorForHandle(e,"scale-sw")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getCursorForHandle(e,"scale-se")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getCursorForHandle(e,"scale-w")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getCursorForHandle(e,"scale-e")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getCursorForHandle(e,"scale-n")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getCursorForHandle(e,"scale-s")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getRotateCursor(e,"nw")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getRotateCursor(e,"ne")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getRotateCursor(e,"sw")),l("ngStyle",n.getInverseScaleStyle(e)),g(),w("cursor",n.getRotateCursor(e,"se")),l("ngStyle",n.getInverseScaleStyle(e))}}function me(u,t){if(u&1){let e=k();d(0,"div",8),m("click",function(i){let o=f(e).$implicit,r=s();return b(r.onObjectClick(i,o.id))})("mousedown",function(i){let o=f(e).$implicit,r=s();return b(r.onObjectMouseDown(i,o.id))}),x(1,"div",9),I(2,pe,1,1,"img",10)(3,ge,1,1,"iframe",11),I(4,ue,13,37),p()}if(u&2){let e=t.$implicit,n=s();ee("selected",n.selectedObjectId()===e.id),l("ngStyle",n.getObjectStyle(e)),g(),l("ngStyle",n.getSelectionBorderStyle()),g(),F(e.type==="image"?2:e.type==="iframe"?3:-1),g(2),F(n.selectedObjectId()===e.id?4:-1)}}var T=class u{platformId=R(K);sanitizer=R(oe);baseSize=200;dataTokenPrefix="data-token-";dataFilePrefix="file-data-";hashUpdateHandle=null;hashThrottleMs=80;lastSerializedHash="";suppressHash=!1;hashDirty=!1;wheelFlushHandle=null;ephemeralTokens=new Map;transparentPixel="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMB/hsrLxkAAAAASUVORK5CYII=";objects=C([]);selectedObjectId=C(null);selectedObject=S(()=>{let t=this.selectedObjectId();return t?this.objects().find(e=>e.id===t):null});viewportX=C(0);viewportY=C(0);zoom=C(1);baseGridSize=20;gridScaleLevels=[.25,.5,1,2,4,8,16];minVisibleGridSize=8;maxVisibleGridSize=50;gridScale=C(1);gridSize=S(()=>this.baseGridSize*this.gridScale());apparentGridSize=S(()=>this.gridSize()*this.zoom());gridOpacity=S(()=>{let t=this.apparentGridSize();return t<this.minVisibleGridSize?Math.max(0,t/this.minVisibleGridSize):t>this.maxVisibleGridSize?Math.max(0,1-(t-this.maxVisibleGridSize)/(this.maxVisibleGridSize*.5)):1});zoomPercentage=S(()=>Math.round(this.zoom()*100));isDragging=!1;isTransforming=!1;isPanningCanvas=!1;dragStartX=0;dragStartY=0;transformStartX=0;transformStartY=0;transformHandle=null;originalObject=null;panStartViewportX=0;panStartViewportY=0;rotateStartAngle=0;rotateStartRotation=0;transformHandles=[{type:"scale-nw",cursor:"nw-resize"},{type:"scale-ne",cursor:"ne-resize"},{type:"scale-sw",cursor:"sw-resize"},{type:"scale-se",cursor:"se-resize"},{type:"scale-w",cursor:"w-resize"},{type:"scale-e",cursor:"e-resize"},{type:"scale-n",cursor:"n-resize"},{type:"scale-s",cursor:"s-resize"},{type:"rotate",cursor:"grab"}];constructor(){O(this.platformId)&&(this.setupEventListeners(),this.applyHashState(window.location.hash),window.addEventListener("hashchange",this.onHashChange),window.addEventListener("keydown",t=>this.onKeyDown(t)),A(()=>{this.viewportX(),this.viewportY(),this.zoom(),this.objects(),this.scheduleHashUpdate()}),A(()=>{let t=this.zoom();this.updateGridScale(t)}))}onHashChange=()=>{O(this.platformId)&&window.location.hash!==this.lastSerializedHash&&(this.applyHashState(window.location.hash),this.lastSerializedHash=window.location.hash)};setupEventListeners(){window.addEventListener("paste",t=>this.onPaste(t)),window.addEventListener("dragover",t=>t.preventDefault()),window.addEventListener("wheel",t=>this.onWheel(t),{passive:!1})}onDrop(t){t.preventDefault(),t.stopPropagation();let e=t.dataTransfer?.files;if(e&&e.length>0){let n=e[0];if(n.type.startsWith("image/")){let i=new FileReader;i.onload=()=>{let o=t.currentTarget,r=o?o.getBoundingClientRect():{left:0,top:0},a=t.clientX-r.left-this.viewportX(),h=t.clientY-r.top-this.viewportY(),c=i.result,v=this.deriveSourceRef(c,n.name),_=new Image;_.onload=()=>{let M=_.naturalHeight/_.naturalWidth||1;this.addObject({id:this.generateId(),type:"image",x:a/this.zoom(),y:h/this.zoom(),width:this.baseSize,height:this.baseSize*M,rotation:0,content:c,sourceRef:v,originalAspectRatio:M})},_.onerror=()=>{this.addObject({id:this.generateId(),type:"image",x:a/this.zoom(),y:h/this.zoom(),width:this.baseSize,height:this.baseSize,rotation:0,content:c,sourceRef:v,originalAspectRatio:1})},_.src=c},i.readAsDataURL(n)}}}onDragOver(t){t.preventDefault(),t.stopPropagation()}onPaste(t){let e=t.clipboardData?.getData("text");if(e&&this.isValidUrl(e)){let n=this.deriveSourceRef(e);this.addObject({id:this.generateId(),type:"iframe",x:(window.innerWidth/2-this.viewportX())/this.zoom(),y:(window.innerHeight/2-this.viewportY())/this.zoom(),width:600,height:400,rotation:0,content:e,sourceRef:n,originalAspectRatio:400/600,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(e)}),t.preventDefault()}}isValidUrl(t){try{return new URL(t),!0}catch{return!1}}addObject(t){this.objects.update(e=>[...e,t]),this.selectedObjectId.set(t.id),this.scheduleHashUpdate()}onKeyDown(t){if(t.key!=="Backspace")return;let e=t.target;if(e&&(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable))return;let n=this.selectedObjectId();if(!n)return;t.preventDefault(),this.suppressHash=!0;let i=this.objects().find(o=>o.id===n);i&&this.cleanupObjectStorage(i),this.objects.update(o=>o.filter(r=>r.id!==n)),this.selectedObjectId.set(null),this.scheduleHashUpdate()}onObjectClick(t,e){t.stopPropagation(),this.selectedObjectId.set(e)}onCanvasClick(t){let e=t.target,n=e===t.currentTarget||e.classList.contains("dot-grid")||e.classList.contains("canvas-objects");this.hashDirty&&this.scheduleHashUpdate(),n&&this.selectedObjectId.set(null)}onCanvasMouseDown(t){if(t.target===t.currentTarget||t.target.classList.contains("dot-grid")){this.suppressHash=!0,this.selectedObjectId.set(null),this.isPanningCanvas=!0,this.dragStartX=t.clientX,this.dragStartY=t.clientY,this.panStartViewportX=this.viewportX(),this.panStartViewportY=this.viewportY();let e=i=>{if(!this.isPanningCanvas)return;let o=i.clientX-this.dragStartX,r=i.clientY-this.dragStartY;this.viewportX.set(this.panStartViewportX+o),this.viewportY.set(this.panStartViewportY+r)},n=()=>{this.isPanningCanvas=!1,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)};window.addEventListener("mousemove",e),window.addEventListener("mouseup",n)}}onObjectMouseMove(t,e){}onObjectMouseLeave(t){}updateGridScale(t){let e=this.gridScaleLevels[0],n=1/0;for(let i of this.gridScaleLevels){let o=this.baseGridSize*i*t,r=(this.minVisibleGridSize+this.maxVisibleGridSize)/2,a=Math.abs(o-r);a<n&&(n=a,e=i)}this.gridScale.set(e)}resetZoom(){this.zoom.set(1),this.viewportX.set(0),this.viewportY.set(0)}onWheel(t){t.preventDefault(),this.suppressHash=!0;let n=t.deltaY>0?.9:1.1,i=Math.max(.1,Math.min(5,this.zoom()*n)),o=t.clientX,r=t.clientY,a=(o-this.viewportX())/this.zoom(),h=(r-this.viewportY())/this.zoom();this.zoom.set(i),this.viewportX.set(o-a*i),this.viewportY.set(r-h*i),this.wheelFlushHandle&&window.clearTimeout(this.wheelFlushHandle),this.wheelFlushHandle=window.setTimeout(()=>{this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),this.wheelFlushHandle=null},150)}onObjectMouseDown(t,e){t.preventDefault(),t.stopPropagation();let n=this.objects().find(r=>r.id===e);if(!n)return;this.isDragging=!0,this.suppressHash=!0,this.dragStartX=t.clientX,this.dragStartY=t.clientY,this.originalObject=y({},n),this.selectedObjectId.set(e);let i=r=>{if(!this.isDragging||!this.originalObject)return;let a=(r.clientX-this.dragStartX)/this.zoom(),h=(r.clientY-this.dragStartY)/this.zoom();this.objects.update(c=>c.map(v=>v.id===e?H(y({},v),{x:this.originalObject.x+a,y:this.originalObject.y+h}):v))},o=()=>{this.isDragging=!1,this.originalObject=null,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",o)};window.addEventListener("mousemove",i),window.addEventListener("mouseup",o)}onHandleMouseDown(t,e,n){t.preventDefault(),t.stopPropagation();let i=this.objects().find(a=>a.id===e);if(!i)return;this.isTransforming=!0,this.suppressHash=!0,this.transformStartX=t.clientX,this.transformStartY=t.clientY,this.transformHandle=n,this.originalObject=y({},i),this.rotateStartRotation=i.rotation,this.rotateStartAngle=this.getPointerAngle(i,t.clientX,t.clientY);let o=a=>{if(!this.isTransforming||!this.originalObject)return;let h=(a.clientX-this.transformStartX)/this.zoom(),c=(a.clientY-this.transformStartY)/this.zoom();this.transformHandle?.startsWith("rotate-")?this.handleRotate(e,a.clientX,a.clientY):this.transformHandle==="rotate"?this.handleRotate(e,a.clientX,a.clientY):this.transformHandle?.startsWith("scale-")&&this.handleScale(e,h,c,this.transformHandle)},r=()=>{this.isTransforming=!1,this.originalObject=null,this.transformHandle=null,this.suppressHash=!1,this.hashDirty&&this.scheduleHashUpdate(),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",r)}handleScale(t,e,n,i){if(!this.originalObject)return;let o=this.originalObject.width,r=this.originalObject.height,a=0,h=0;if(i==="scale-nw"){let c=(-e-n)/2;o=Math.max(50,this.originalObject.width+c),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+c),a=this.originalObject.width-o,h=this.originalObject.height-r}else if(i==="scale-ne"){let c=(e-n)/2;o=Math.max(50,this.originalObject.width+c),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+c),h=this.originalObject.height-r}else if(i==="scale-sw"){let c=(-e+n)/2;o=Math.max(50,this.originalObject.width+c),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+c),a=this.originalObject.width-o}else if(i==="scale-se"){let c=(e+n)/2;o=Math.max(50,this.originalObject.width+c),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:Math.max(50,this.originalObject.height+c)}else i==="scale-w"?(o=Math.max(50,this.originalObject.width-e),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:this.originalObject.height,a=this.originalObject.width-o,this.originalObject.type==="image"&&(h=(this.originalObject.height-r)/2)):i==="scale-e"?(o=Math.max(50,this.originalObject.width+e),r=this.originalObject.type==="image"?o*this.originalObject.originalAspectRatio:this.originalObject.height,this.originalObject.type==="image"&&(h=(this.originalObject.height-r)/2)):i==="scale-n"?(r=Math.max(50,this.originalObject.height-n),o=this.originalObject.type==="image"?r/this.originalObject.originalAspectRatio:this.originalObject.width,h=this.originalObject.height-r,this.originalObject.type==="image"&&(a=(this.originalObject.width-o)/2)):i==="scale-s"&&(r=Math.max(50,this.originalObject.height+n),o=this.originalObject.type==="image"?r/this.originalObject.originalAspectRatio:this.originalObject.width,this.originalObject.type==="image"&&(a=(this.originalObject.width-o)/2));this.objects.update(c=>c.map(v=>v.id===t?H(y({},v),{width:o,height:r,x:this.originalObject.x+a,y:this.originalObject.y+h}):v))}handleRotate(t,e,n){if(!this.originalObject)return;let i=this.objects().find(c=>c.id===t);if(!i)return;let r=this.getPointerAngle(i,e,n)-this.rotateStartAngle,a=this.rotateStartRotation+r,h=this.snapAngleWithin(a,45,2);this.objects.update(c=>c.map(v=>v.id===t?H(y({},v),{rotation:h}):v))}getPointerAngle(t,e,n){let i=(t.x+t.width/2)*this.zoom()+this.viewportX(),o=(t.y+t.height/2)*this.zoom()+this.viewportY();return Math.atan2(n-o,e-i)*(180/Math.PI)}getObjectStyle(t){return{left:`${t.x}px`,top:`${t.y}px`,width:`${t.width}px`,height:`${t.height}px`,transform:`rotate(${t.rotation}deg)`}}snapAngle(t,e=45){return Math.round(t/e)*e}snapAngleWithin(t,e=45,n=2){let i=Math.round(t/e)*e;return Math.abs(t-i)<=n?i:t}getHandlePosition(t,e){return{"scale-nw":{top:"-5px",left:"-5px"},"scale-ne":{top:"-5px",right:"-5px"},"scale-sw":{bottom:"-5px",left:"-5px"},"scale-se":{bottom:"-5px",right:"-5px"},rotate:{top:"-30px",left:"50%",transform:"translateX(-50%)"}}[e.type]||{}}getCanvasObjectsStyle(){return{transform:`translate(${this.viewportX()}px, ${this.viewportY()}px) scale(${this.zoom()})`,"transform-origin":"0 0"}}getDotGridStyle(){let e=this.gridSize()*this.zoom(),n=this.viewportX()%e,i=this.viewportY()%e;return{"background-size":`${e}px ${e}px`,"background-position":`${n}px ${i}px`,opacity:this.gridOpacity().toString()}}getInverseScaleStyle(t){let e=1/this.zoom();return{transform:`scale(${e})`,"--inverse-scale":e.toString()}}getSelectionBorderStyle(){return{"--inverse-scale":(1/this.zoom()).toString()}}onIframeLoad(t,e){let n=t.target;if(n)try{let i=n.contentDocument||n.contentWindow?.document||null;if(!i)return;i.documentElement&&(i.documentElement.style.overflow="hidden"),i.body&&(i.body.style.overflow="hidden");let o=i.createElement("style");o.textContent="::-webkit-scrollbar{display:none} html,body{overflow:hidden!important}",i.head?.appendChild(o)}catch{}}normalizeAngle180(t){let e=t%180;return e<0&&(e+=180),e}getCursorForHandle(t,e){let n=this.normalizeAngle180(t.rotation),i=n>=45&&n<=135,o=n<45||n>135;if(e.startsWith("scale-"))switch(e){case"scale-nw":case"scale-se":return o?"nwse-resize":"nesw-resize";case"scale-ne":case"scale-sw":return o?"nesw-resize":"nwse-resize";case"scale-w":case"scale-e":return i?"ns-resize":"ew-resize";case"scale-n":case"scale-s":return i?"ew-resize":"ns-resize"}return"move"}buildRotateCursorSvg(t){let e=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<g transform="rotate(${t} 12 12)">
<g clip-path="url(#clip0_325_17)">
<g filter="url(#filter0_d_325_17)">
<path d="M11 6C11.9193 6 12.8295 6.18106 13.6788 6.53284C14.5281 6.88463 15.2997 7.40024 15.9497 8.05025C16.5998 8.70026 17.1154 9.47194 17.4672 10.3212C17.8189 11.1705 18 12.0807 18 13V16H22L16 22L10 16H14V13C14 12.606 13.9224 12.2159 13.7716 11.8519C13.6209 11.488 13.3999 11.1573 13.1213 10.8787C12.8427 10.6001 12.512 10.3791 12.1481 10.2284C11.7841 10.0776 11.394 10 11 10H8V14L2 8L8 2V6H11Z" fill="white"/>
<path d="M11 9H7V11.5L3.5 8L7 4.5L7 7H11C11.7879 7 12.5682 7.15519 13.2961 7.45672C14.0241 7.75825 14.6855 8.20021 15.2426 8.75736C15.7998 9.31451 16.2418 9.97594 16.5433 10.7039C16.8448 11.4319 17 12.2121 17 13V17L19.5 17L16 20.5L12.5 17H15V13C15 12.4747 14.8965 11.9546 14.6955 11.4693C14.4945 10.984 14.1999 10.543 13.8284 10.1716C13.457 9.80014 13.016 9.5055 12.5307 9.30448C12.0454 9.10346 11.5253 9 11 9Z" fill="black"/>
</g>
</g>
<defs>
<filter id="filter0_d_325_17" x="0.2" y="1.2" width="23.6" height="23.6" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
<feOffset dy="1"/>
<feGaussianBlur stdDeviation="0.9"/>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.65 0"/>
<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_325_17"/>
<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_325_17" result="shape"/>
</filter>
<clipPath id="clip0_325_17">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>
</g>
</svg>`;return`url("data:image/svg+xml;utf8,${encodeURIComponent(e).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}") 12 12, auto`}getRotateCursor(t,e){let i={ne:0,nw:270,sw:180,se:90}[e]+t.rotation;return this.buildRotateCursorSvg(i)}scheduleHashUpdate(){if(O(this.platformId)){if(this.suppressHash){this.hashDirty=!0;return}this.hashUpdateHandle&&window.clearTimeout(this.hashUpdateHandle),this.hashUpdateHandle=window.setTimeout(()=>{let t=this.serializeStateToHash(),e=t?`#${t}`:"";e!==this.lastSerializedHash&&(window.location.hash=e,this.lastSerializedHash=e),this.hashDirty=!1,this.hashUpdateHandle=null},this.hashThrottleMs)}}serializeStateToHash(){let t=[];t.push(this.serializeCanvasSegment());for(let e of this.objects())t.push(this.serializeObjectSegment(e));return t.join("#")}serializeCanvasSegment(){let t=this.roundNumber(this.viewportX()),e=this.roundNumber(this.viewportY()),n=this.roundNumber(this.zoom());return`canvas/${t},${e},${n}`}serializeObjectSegment(t){let e=this.roundNumber(t.x),n=this.roundNumber(t.y),i=this.roundNumber(t.width/this.baseSize),o=this.roundNumber(t.rotation),r=t.width===0?1:t.height/t.width,a=[`type:${t.type}`,`ratio:${this.roundNumber(r)}`];return`${encodeURIComponent(t.sourceRef)}/${e},${n},${i},${o}/${a.join(",")}`}applyHashState(t){if(!O(this.platformId)||!t||t.length<=1)return;let e=t.substring(1).split("#").filter(Boolean);if(e.length===0)return;let n=[],i=this.viewportX(),o=this.viewportY(),r=this.zoom();for(let a of e){let[h,c,v]=a.split("/");if(!h||!c)continue;let _=decodeURIComponent(h);if(_==="canvas"){let[P,W,B]=c.split(",").map(parseFloat);Number.isNaN(P)||(i=P),Number.isNaN(W)||(o=W),Number.isNaN(B)||(r=Math.max(.1,Math.min(5,B)));continue}let[M,$,L,N]=c.split(",").map(parseFloat);if([M,$,L,N].some(P=>Number.isNaN(P)))continue;let X=this.parseFlags(v),V=X.get("ratio")??1,Y=typeof V=="number"?V:parseFloat(String(V)),U=Number.isNaN(Y)?1:Y,z=X.get("type")??"image",G=this.baseSize*L,ce=G*U,j=this.resolveContent(_,z);if(!j)if(z==="image")j=this.transparentPixel;else continue;n.push({id:this.generateId(),type:z,x:M,y:$,width:G,height:ce,rotation:N,content:j,sourceRef:_,originalAspectRatio:U,safeUrl:z==="iframe"&&this.isValidUrl(j)?this.sanitizer.bypassSecurityTrustResourceUrl(j):void 0})}this.viewportX.set(i),this.viewportY.set(o),this.zoom.set(r),this.objects.set(n),this.selectedObjectId.set(null),this.lastSerializedHash=t.startsWith("#")?t:`#${t}`}resolveContent(t,e){if(t.startsWith("token:")){let i=t.substring(6);return this.readDataToken(i)??null}let n=this.readFileContent(t);return n||(e==="iframe"?this.isValidUrl(t)?t:null:t.startsWith("http://")||t.startsWith("https://")?t:null)}parseFlags(t){let e=new Map;if(!t)return e;for(let n of t.split(",")){let[i,o]=n.split(":");if(!i||o===void 0)continue;let r=parseFloat(o);e.set(i,Number.isNaN(r)?o:r)}return e}deriveSourceRef(t,e){if(!O(this.platformId))return t;if(t.startsWith("data:")){if(e){let i=this.makeFileKey(e);try{return localStorage.setItem(i,t),e}catch{}}return this.createDataToken(t)}return e??t}roundNumber(t){return Math.round(t*1e3)/1e3}createDataToken(t){let e=`${this.dataTokenPrefix}${Date.now()}-${Math.random().toString(36).slice(2,8)}`;try{localStorage.setItem(e,t)}catch{this.ephemeralTokens.set(e,t)}return`token:${e}`}readDataToken(t){try{let e=localStorage.getItem(t);if(e)return e}catch{}return this.ephemeralTokens.get(t)??null}makeFileKey(t){return`${this.dataFilePrefix}${t}`}readFileContent(t){let e=this.makeFileKey(t);try{return localStorage.getItem(e)}catch{return null}}generateId(){return"obj-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}cleanupObjectStorage(t){if(t.sourceRef&&!t.sourceRef.startsWith("token:")&&!t.sourceRef.startsWith("http")){let e=this.makeFileKey(t.sourceRef);try{localStorage.removeItem(e)}catch{}}else if(t.sourceRef?.startsWith("token:")){let e=t.sourceRef.substring(6);try{localStorage.removeItem(e)}catch{}this.ephemeralTokens.delete(e)}}static \u0275fac=function(e){return new(e||u)};static \u0275cmp=D({type:u,selectors:[["app-canvas"]],decls:13,vars:3,consts:[[1,"canvas-container",3,"click","mousedown","drop","dragover"],[1,"dot-grid",3,"ngStyle"],[1,"canvas-objects",3,"ngStyle"],[1,"canvas-object",3,"selected","ngStyle"],[1,"zoom-controls"],[1,"zoom-counter"],[1,"zoom-reset",3,"click"],[1,"canvas-instructions"],[1,"canvas-object",3,"click","mousedown","ngStyle"],[1,"hover-border",3,"ngStyle"],["alt","Canvas image",1,"object-content",3,"src"],["scrolling","no","sandbox","allow-scripts allow-same-origin allow-forms",1,"object-content",3,"src"],["scrolling","no","sandbox","allow-scripts allow-same-origin allow-forms",1,"object-content",3,"load","src"],[1,"selection-border",3,"ngStyle"],[1,"handle","handle-corner","handle-nw",3,"mousedown","ngStyle"],[1,"handle","handle-corner","handle-ne",3,"mousedown","ngStyle"],[1,"handle","handle-corner","handle-sw",3,"mousedown","ngStyle"],[1,"handle","handle-corner","handle-se",3,"mousedown","ngStyle"],[1,"handle","handle-edge","handle-w",3,"mousedown","ngStyle"],[1,"handle","handle-edge","handle-e",3,"mousedown","ngStyle"],[1,"handle","handle-edge","handle-n",3,"mousedown","ngStyle"],[1,"handle","handle-edge","handle-s",3,"mousedown","ngStyle"],[1,"rotation-indicator","rotation-nw",3,"mousedown","ngStyle"],[1,"rotation-indicator","rotation-ne",3,"mousedown","ngStyle"],[1,"rotation-indicator","rotation-sw",3,"mousedown","ngStyle"],[1,"rotation-indicator","rotation-se",3,"mousedown","ngStyle"]],template:function(e,n){e&1&&(d(0,"div",0),m("click",function(o){return n.onCanvasClick(o)})("mousedown",function(o){return n.onCanvasMouseDown(o)})("drop",function(o){return n.onDrop(o)})("dragover",function(o){return n.onDragOver(o)}),x(1,"div",1),d(2,"div",2),q(3,me,5,6,"div",3,he),p(),d(5,"div",4)(6,"div",5),E(7),p(),d(8,"button",6),m("click",function(){return n.resetZoom()}),E(9,"Reset"),p()(),d(10,"div",7)(11,"p"),E(12,"Drag and drop images here \u2022 Paste URLs (Ctrl/Cmd+V) \u2022 Drag canvas to pan \u2022 Scroll to zoom"),p()()()),e&2&&(g(),l("ngStyle",n.getDotGridStyle()),g(),l("ngStyle",n.getCanvasObjectsStyle()),g(),J(n.objects()),g(4),te("",n.zoomPercentage(),"%"))},dependencies:[ie,ne],styles:['[_nghost-%COMP%]{display:block;width:100%;height:100%}.canvas-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;overflow:hidden;background-color:#f5f5f5;cursor:grab}.canvas-container[_ngcontent-%COMP%]:active{cursor:grabbing}.dot-grid[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(circle,#ccc 1px,transparent 1px);background-size:20px 20px;background-position:0 0;pointer-events:none;z-index:1;transition:opacity .3s ease-in-out}.canvas-objects[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;pointer-events:none}.canvas-object[_ngcontent-%COMP%]{position:absolute;box-sizing:border-box;cursor:move;-webkit-user-select:none;user-select:none;pointer-events:auto}.canvas-object.selected[_ngcontent-%COMP%]   .selection-border[_ngcontent-%COMP%]{display:block}.canvas-object[_ngcontent-%COMP%]   .object-content[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain;pointer-events:none;display:block;border:none}.canvas-object[_ngcontent-%COMP%]   iframe.object-content[_ngcontent-%COMP%]{overflow:hidden;scrollbar-width:none}.canvas-object[_ngcontent-%COMP%]   iframe.object-content[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.canvas-object[_ngcontent-%COMP%]   .selection-border[_ngcontent-%COMP%]{display:none;position:absolute;top:0;left:0;width:100%;height:100%;border-style:solid;border-color:#007bff;border-width:calc(1px * var(--inverse-scale, 1));box-sizing:border-box;pointer-events:none;transform-origin:0 0}.canvas-object[_ngcontent-%COMP%]:hover   .selection-border[_ngcontent-%COMP%]{border-width:calc(3px * var(--inverse-scale, 1))}.canvas-object[_ngcontent-%COMP%]   .hover-border[_ngcontent-%COMP%]{display:none;position:absolute;top:0;left:0;width:100%;height:100%;border-style:solid;border-color:#007bff;border-width:calc(1px * var(--inverse-scale, 1));box-sizing:border-box;pointer-events:none;transform-origin:0 0}.canvas-object[_ngcontent-%COMP%]:hover   .hover-border[_ngcontent-%COMP%]{display:block}.canvas-object[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{position:absolute;pointer-events:all;z-index:10;-webkit-user-select:none;user-select:none;transform-origin:center}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner[_ngcontent-%COMP%]{width:12px;height:12px;background-color:#007bff;border:1px solid white;box-sizing:border-box}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-nw[_ngcontent-%COMP%]{top:-6px;left:-6px;cursor:nwse-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-ne[_ngcontent-%COMP%]{top:-6px;right:-6px;cursor:nesw-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-sw[_ngcontent-%COMP%]{bottom:-6px;left:-6px;cursor:nesw-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner.handle-se[_ngcontent-%COMP%]{bottom:-6px;right:-6px;cursor:nwse-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-corner[_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:scale(1.3)}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge[_ngcontent-%COMP%]{background-color:transparent;border:none}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-w[_ngcontent-%COMP%]{top:0;left:-4px;width:8px;height:100%;cursor:w-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-e[_ngcontent-%COMP%]{top:0;right:-4px;width:8px;height:100%;cursor:e-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-n[_ngcontent-%COMP%]{top:-4px;left:0;width:100%;height:8px;cursor:n-resize}.canvas-object[_ngcontent-%COMP%]   .handle.handle-edge.handle-s[_ngcontent-%COMP%]{bottom:-4px;left:0;width:100%;height:8px;cursor:s-resize}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]{position:absolute;transform-origin:center;width:20px;height:20px;pointer-events:all;z-index:10;cursor:grab}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:hover{cursor:grab}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:active{cursor:grabbing}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator[_ngcontent-%COMP%]:before{content:"";position:absolute;width:4px;height:4px;background-color:#28a745;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%)}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-nw[_ngcontent-%COMP%]{top:-30px;left:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-ne[_ngcontent-%COMP%]{top:-30px;right:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-sw[_ngcontent-%COMP%]{bottom:-30px;left:-30px}.canvas-object[_ngcontent-%COMP%]   .rotation-indicator.rotation-se[_ngcontent-%COMP%]{bottom:-30px;right:-30px}.canvas-instructions[_ngcontent-%COMP%]{position:absolute;top:20px;left:50%;transform:translate(-50%);background-color:#ffffffe6;padding:12px 24px;border-radius:8px;box-shadow:0 2px 8px #0000001a;z-index:100;pointer-events:none}.canvas-instructions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#333;font-size:14px;font-weight:500}.zoom-controls[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:50%;transform:translate(-50%);display:flex;align-items:center;gap:8px;background-color:#fffffff2;padding:8px 16px;border-radius:8px;box-shadow:0 2px 12px #00000026;z-index:100;pointer-events:auto}.zoom-controls[_ngcontent-%COMP%]   .zoom-counter[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#333;min-width:50px;text-align:center}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;border-radius:4px;padding:6px 12px;font-size:13px;font-weight:500;cursor:pointer;transition:background-color .2s}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]:hover{background-color:#0056b3}.zoom-controls[_ngcontent-%COMP%]   .zoom-reset[_ngcontent-%COMP%]:active{background-color:#004085}'],changeDetection:0})};var ae=class u{title=C("sample-reflect");static \u0275fac=function(e){return new(e||u)};static \u0275cmp=D({type:u,selectors:[["app-root"]],decls:3,vars:1,consts:[[3,"fullScreen"]],template:function(e,n){e&1&&(d(0,"lib-layout",0),x(1,"app-canvas")(2,"router-outlet"),p()),e&2&&l("fullScreen",!0)},dependencies:[re,se,T],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"]})};export{ae as App};
